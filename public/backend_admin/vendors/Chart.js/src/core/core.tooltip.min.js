"use strict";module.exports=function(g){var c=g.helpers;g.defaults.global.tooltips={enabled:true,custom:null,mode:"single",backgroundColor:"rgba(0,0,0,0.8)",titleFontStyle:"bold",titleSpacing:2,titleMarginBottom:6,titleColor:"#fff",titleAlign:"left",bodySpacing:2,bodyColor:"#fff",bodyAlign:"left",footerFontStyle:"bold",footerSpacing:2,footerMarginTop:6,footerColor:"#fff",footerAlign:"left",yPadding:6,xPadding:6,yAlign:"center",xAlign:"center",caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",callbacks:{beforeTitle:c.noop,title:function(l,m){var n="";if(l.length>0){if(l[0].xLabel){n=l[0].xLabel}else{if(m.labels.length>0&&l[0].index<m.labels.length){n=m.labels[l[0].index]}}}return n},afterTitle:c.noop,beforeBody:c.noop,beforeLabel:c.noop,label:function(l,m){var n=m.datasets[l.datasetIndex].label||"";return n+": "+l.yLabel},afterLabel:c.noop,afterBody:c.noop,beforeFooter:c.noop,footer:c.noop,afterFooter:c.noop}};function e(m,l){if(l){if(c.isArray(l)){m=m.concat(l)}else{m.push(l)}}return m}g.Tooltip=g.Element.extend({initialize:function(){var l=g.defaults.global;var m=this._options;var n=m.tooltips;c.extend(this,{_model:{xPadding:n.xPadding,yPadding:n.yPadding,xAlign:n.yAlign,yAlign:n.xAlign,bodyColor:n.bodyColor,_bodyFontFamily:c.getValueOrDefault(n.bodyFontFamily,l.defaultFontFamily),_bodyFontStyle:c.getValueOrDefault(n.bodyFontStyle,l.defaultFontStyle),_bodyAlign:n.bodyAlign,bodyFontSize:c.getValueOrDefault(n.bodyFontSize,l.defaultFontSize),bodySpacing:n.bodySpacing,titleColor:n.titleColor,_titleFontFamily:c.getValueOrDefault(n.titleFontFamily,l.defaultFontFamily),_titleFontStyle:c.getValueOrDefault(n.titleFontStyle,l.defaultFontStyle),titleFontSize:c.getValueOrDefault(n.titleFontSize,l.defaultFontSize),_titleAlign:n.titleAlign,titleSpacing:n.titleSpacing,titleMarginBottom:n.titleMarginBottom,footerColor:n.footerColor,_footerFontFamily:c.getValueOrDefault(n.footerFontFamily,l.defaultFontFamily),_footerFontStyle:c.getValueOrDefault(n.footerFontStyle,l.defaultFontStyle),footerFontSize:c.getValueOrDefault(n.footerFontSize,l.defaultFontSize),_footerAlign:n.footerAlign,footerSpacing:n.footerSpacing,footerMarginTop:n.footerMarginTop,caretSize:n.caretSize,cornerRadius:n.cornerRadius,backgroundColor:n.backgroundColor,opacity:0,legendColorBackground:n.multiKeyBackground}})},getTitle:function(){var n=this._options.tooltips.callbacks.beforeTitle.apply(this,arguments),o=this._options.tooltips.callbacks.title.apply(this,arguments),l=this._options.tooltips.callbacks.afterTitle.apply(this,arguments);var m=[];m=e(m,n);m=e(m,o);m=e(m,l);return m},getBeforeBody:function(){var l=this._options.tooltips.callbacks.beforeBody.apply(this,arguments);return c.isArray(l)?l:l!==undefined?[l]:[]},getBody:function(m,n){var l=[];c.each(m,function(o){c.pushAllIfDefined(this._options.tooltips.callbacks.beforeLabel.call(this,o,n),l);c.pushAllIfDefined(this._options.tooltips.callbacks.label.call(this,o,n),l);c.pushAllIfDefined(this._options.tooltips.callbacks.afterLabel.call(this,o,n),l)},this);return l},getAfterBody:function(){var l=this._options.tooltips.callbacks.afterBody.apply(this,arguments);return c.isArray(l)?l:l!==undefined?[l]:[]},getFooter:function(){var n=this._options.tooltips.callbacks.beforeFooter.apply(this,arguments);var o=this._options.tooltips.callbacks.footer.apply(this,arguments);var m=this._options.tooltips.callbacks.afterFooter.apply(this,arguments);var l=[];l=e(l,n);l=e(l,o);l=e(l,m);return l},getAveragePosition:function(p){if(!p.length){return false}var m=[];var n=[];c.each(p,function(r){if(r&&r.hasValue()){var s=r.tooltipPosition();m.push(s.x);n.push(s.y)}});var l=0,q=0;for(var o=0;o<m.length;o++){l+=m[o];q+=n[o]}return{x:Math.round(l/m.length),y:Math.round(q/m.length)}},update:function(q){if(this._active.length){this._model.opacity=1;var n=this._active[0],r=[],p;var m=[];if(this._options.tooltips.mode==="single"){var o=n._yScale||n._scale;m.push({xLabel:n._xScale?n._xScale.getLabelForIndex(n._index,n._datasetIndex):"",yLabel:o?o.getLabelForIndex(n._index,n._datasetIndex):"",index:n._index,datasetIndex:n._datasetIndex});p=this.getAveragePosition(this._active)}else{c.each(this._data.datasets,function(v,w){if(!this._chartInstance.isDatasetVisible(w)){return}var u=this._chartInstance.getDatasetMeta(w);var s=u.data[n._index];if(s){var t=n._yScale||n._scale;m.push({xLabel:s._xScale?s._xScale.getLabelForIndex(s._index,s._datasetIndex):"",yLabel:t?t.getLabelForIndex(s._index,s._datasetIndex):"",index:n._index,datasetIndex:w})}},this);c.each(this._active,function(s){if(s){r.push({borderColor:s._view.borderColor,backgroundColor:s._view.backgroundColor})}},null);p=this.getAveragePosition(this._active)}c.extend(this._model,{title:this.getTitle(m,this._data),beforeBody:this.getBeforeBody(m,this._data),body:this.getBody(m,this._data),afterBody:this.getAfterBody(m,this._data),footer:this.getFooter(m,this._data)});c.extend(this._model,{x:Math.round(p.x),y:Math.round(p.y),caretPadding:c.getValueOrDefault(p.padding,2),labelColors:r});var l=this.getTooltipSize(this._model);this.determineAlignment(l);c.extend(this._model,this.getBackgroundPoint(this._model,l))}else{this._model.opacity=0}if(q&&this._options.tooltips.custom){this._options.tooltips.custom.call(this,this._model)}return this},getTooltipSize:function k(o){var l=this._chart.ctx;var n={height:o.yPadding*2,width:0};var m=o.body.length+o.beforeBody.length+o.afterBody.length;n.height+=o.title.length*o.titleFontSize;n.height+=(o.title.length-1)*o.titleSpacing;n.height+=o.title.length?o.titleMarginBottom:0;n.height+=m*o.bodyFontSize;n.height+=m?(m-1)*o.bodySpacing:0;n.height+=o.footer.length?o.footerMarginTop:0;n.height+=o.footer.length*(o.footerFontSize);n.height+=o.footer.length?(o.footer.length-1)*o.footerSpacing:0;l.font=c.fontString(o.titleFontSize,o._titleFontStyle,o._titleFontFamily);c.each(o.title,function(p){n.width=Math.max(n.width,l.measureText(p).width)});l.font=c.fontString(o.bodyFontSize,o._bodyFontStyle,o._bodyFontFamily);c.each(o.beforeBody.concat(o.afterBody),function(p){n.width=Math.max(n.width,l.measureText(p).width)});c.each(o.body,function(p){n.width=Math.max(n.width,l.measureText(p).width+(this._options.tooltips.mode!=="single"?(o.bodyFontSize+2):0))},this);l.font=c.fontString(o.footerFontSize,o._footerFontStyle,o._footerFontFamily);c.each(o.footer,function(p){n.width=Math.max(n.width,l.measureText(p).width)});n.width+=2*o.xPadding;return n},determineAlignment:function a(s){if(this._model.y<s.height){this._model.yAlign="top"}else{if(this._model.y>(this._chart.height-s.height)){this._model.yAlign="bottom"}}var t,r;var m,l;var n;var o=this;var q=(this._chartInstance.chartArea.left+this._chartInstance.chartArea.right)/2;var p=(this._chartInstance.chartArea.top+this._chartInstance.chartArea.bottom)/2;if(this._model.yAlign==="center"){t=function(u){return u<=q};r=function(u){return u>q}}else{t=function(u){return u<=(s.width/2)};r=function(u){return u>=(o._chart.width-(s.width/2))}}m=function(u){return u+s.width>o._chart.width};l=function(u){return u-s.width<0};n=function(u){return u<=p?"top":"bottom"};if(t(this._model.x)){this._model.xAlign="left";if(m(this._model.x)){this._model.xAlign="center";this._model.yAlign=n(this._model.y)}}else{if(r(this._model.x)){this._model.xAlign="right";if(l(this._model.x)){this._model.xAlign="center";this._model.yAlign=n(this._model.y)}}}},getBackgroundPoint:function d(m,l){var n={x:m.x,y:m.y};if(m.xAlign==="right"){n.x-=l.width}else{if(m.xAlign==="center"){n.x-=(l.width/2)}}if(m.yAlign==="top"){n.y+=m.caretPadding+m.caretSize}else{if(m.yAlign==="bottom"){n.y-=l.height+m.caretPadding+m.caretSize}else{n.y-=(l.height/2)}}if(m.yAlign==="center"){if(m.xAlign==="left"){n.x+=m.caretPadding+m.caretSize}else{if(m.xAlign==="right"){n.x-=m.caretPadding+m.caretSize}}}else{if(m.xAlign==="left"){n.x-=m.cornerRadius+m.caretPadding}else{if(m.xAlign==="right"){n.x+=m.cornerRadius+m.caretPadding}}}return n},drawCaret:function h(o,x,r,q){var p=this._view;var w=this._chart.ctx;var n,m,l;var v,t,s;if(p.yAlign==="center"){if(p.xAlign==="left"){n=o.x;m=n-p.caretSize;l=n}else{n=o.x+x.width;m=n+p.caretSize;l=n}t=o.y+(x.height/2);v=t-p.caretSize;s=t+p.caretSize}else{if(p.xAlign==="left"){n=o.x+p.cornerRadius;m=n+p.caretSize;l=m+p.caretSize}else{if(p.xAlign==="right"){n=o.x+x.width-p.cornerRadius;m=n-p.caretSize;l=m-p.caretSize}else{m=o.x+(x.width/2);n=m-p.caretSize;l=m+p.caretSize}}if(p.yAlign==="top"){v=o.y;t=v-p.caretSize;s=v}else{v=o.y+x.height;t=v+p.caretSize;s=v}}var u=c.color(p.backgroundColor);w.fillStyle=u.alpha(r*u.alpha()).rgbString();w.beginPath();w.moveTo(n,v);w.lineTo(m,t);w.lineTo(l,s);w.closePath();w.fill()},drawTitle:function i(p,n,l,m){if(n.title.length){l.textAlign=n._titleAlign;l.textBaseline="top";var o=c.color(n.titleColor);l.fillStyle=o.alpha(m*o.alpha()).rgbString();l.font=c.fontString(n.titleFontSize,n._titleFontStyle,n._titleFontFamily);c.each(n.title,function(r,q){l.fillText(r,p.x,p.y);p.y+=n.titleFontSize+n.titleSpacing;if(q+1===n.title.length){p.y+=n.titleMarginBottom-n.titleSpacing}})}},drawBody:function b(p,n,l,m){l.textAlign=n._bodyAlign;l.textBaseline="top";var o=c.color(n.bodyColor);l.fillStyle=o.alpha(m*o.alpha()).rgbString();l.font=c.fontString(n.bodyFontSize,n._bodyFontStyle,n._bodyFontFamily);c.each(n.beforeBody,function(q){l.fillText(q,p.x,p.y);p.y+=n.bodyFontSize+n.bodySpacing});c.each(n.body,function(q,r){if(this._options.tooltips.mode!=="single"){l.fillStyle=c.color(n.legendColorBackground).alpha(m).rgbaString();l.fillRect(p.x,p.y,n.bodyFontSize,n.bodyFontSize);l.strokeStyle=c.color(n.labelColors[r].borderColor).alpha(m).rgbaString();l.strokeRect(p.x,p.y,n.bodyFontSize,n.bodyFontSize);l.fillStyle=c.color(n.labelColors[r].backgroundColor).alpha(m).rgbaString();l.fillRect(p.x+1,p.y+1,n.bodyFontSize-2,n.bodyFontSize-2);l.fillStyle=c.color(n.bodyColor).alpha(m).rgbaString()}l.fillText(q,p.x+(this._options.tooltips.mode!=="single"?(n.bodyFontSize+2):0),p.y);p.y+=n.bodyFontSize+n.bodySpacing},this);c.each(n.afterBody,function(q){l.fillText(q,p.x,p.y);p.y+=n.bodyFontSize});p.y-=n.bodySpacing},drawFooter:function f(p,n,l,m){if(n.footer.length){p.y+=n.footerMarginTop;l.textAlign=n._footerAlign;l.textBaseline="top";var o=c.color(n.footerColor);l.fillStyle=o.alpha(m*o.alpha()).rgbString();l.font=c.fontString(n.footerFontSize,n._footerFontStyle,n._footerFontFamily);c.each(n.footer,function(q){l.fillText(q,p.x,p.y);p.y+=n.footerFontSize+n.footerSpacing})}},draw:function j(){var m=this._chart.ctx;var p=this._view;if(p.opacity===0){return}var l=p.caretPadding;var o=this.getTooltipSize(p);var r={x:p.x,y:p.y};var n=Math.abs(p.opacity<0.001)?0:p.opacity;if(this._options.tooltips.enabled){var q=c.color(p.backgroundColor);m.fillStyle=q.alpha(n*q.alpha()).rgbString();c.drawRoundedRectangle(m,r.x,r.y,o.width,o.height,p.cornerRadius);m.fill();this.drawCaret(r,o,n,l);r.x+=p.xPadding;r.y+=p.yPadding;this.drawTitle(r,p,m,n);this.drawBody(r,p,m,n);this.drawFooter(r,p,m,n)}}})};