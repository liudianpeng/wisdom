"use strict";module.exports=function(a){var c=a.helpers;a.defaults.scale={display:true,position:"left",gridLines:{display:true,color:"rgba(0, 0, 0, 0.1)",lineWidth:1,drawBorder:true,drawOnChartArea:true,drawTicks:true,tickMarkLength:10,zeroLineWidth:1,zeroLineColor:"rgba(0,0,0,0.25)",offsetGridLines:false},scaleLabel:{labelString:"",display:false},ticks:{beginAtZero:false,minRotation:0,maxRotation:50,mirror:false,padding:10,reverse:false,display:true,autoSkip:true,autoSkipPadding:0,labelOffset:0,callback:function(d){return""+d}}};a.Scale=a.Element.extend({beforeUpdate:function(){c.callCallback(this.options.beforeUpdate,[this])},update:function(e,d,f){this.beforeUpdate();this.maxWidth=e;this.maxHeight=d;this.margins=c.extend({left:0,right:0,top:0,bottom:0},f);this.beforeSetDimensions();this.setDimensions();this.afterSetDimensions();this.beforeDataLimits();this.determineDataLimits();this.afterDataLimits();this.beforeBuildTicks();this.buildTicks();this.afterBuildTicks();this.beforeTickToLabelConversion();this.convertTicksToLabels();this.afterTickToLabelConversion();this.beforeCalculateTickRotation();this.calculateTickRotation();this.afterCalculateTickRotation();this.beforeFit();this.fit();this.afterFit();this.afterUpdate();return this.minSize},afterUpdate:function(){c.callCallback(this.options.afterUpdate,[this])},beforeSetDimensions:function(){c.callCallback(this.options.beforeSetDimensions,[this])},setDimensions:function(){if(this.isHorizontal()){this.width=this.maxWidth;this.left=0;this.right=this.width}else{this.height=this.maxHeight;this.top=0;this.bottom=this.height}this.paddingLeft=0;this.paddingTop=0;this.paddingRight=0;this.paddingBottom=0},afterSetDimensions:function(){c.callCallback(this.options.afterSetDimensions,[this])},beforeDataLimits:function(){c.callCallback(this.options.beforeDataLimits,[this])},determineDataLimits:c.noop,afterDataLimits:function(){c.callCallback(this.options.afterDataLimits,[this])},beforeBuildTicks:function(){c.callCallback(this.options.beforeBuildTicks,[this])},buildTicks:c.noop,afterBuildTicks:function(){c.callCallback(this.options.afterBuildTicks,[this])},beforeTickToLabelConversion:function(){c.callCallback(this.options.beforeTickToLabelConversion,[this])},convertTicksToLabels:function(){this.ticks=this.ticks.map(function(f,d,e){if(this.options.ticks.userCallback){return this.options.ticks.userCallback(f,d,e)}return this.options.ticks.callback(f,d,e)},this)},afterTickToLabelConversion:function(){c.callCallback(this.options.afterTickToLabelConversion,[this])},beforeCalculateTickRotation:function(){c.callCallback(this.options.beforeCalculateTickRotation,[this])},calculateTickRotation:function(){var e=this.ctx;var j=a.defaults.global;var p=this.options.ticks;var q=c.getValueOrDefault(p.fontSize,j.defaultFontSize);var r=c.getValueOrDefault(p.fontStyle,j.defaultFontStyle);var i=c.getValueOrDefault(p.fontFamily,j.defaultFontFamily);var f=c.fontString(q,r,i);e.font=f;var o=e.measureText(this.ticks[0]).width;var d=e.measureText(this.ticks[this.ticks.length-1]).width;var l;this.labelRotation=p.minRotation||0;this.paddingRight=0;this.paddingLeft=0;if(this.options.display){if(this.isHorizontal()){this.paddingRight=d/2+3;this.paddingLeft=o/2+3;if(!this.longestTextCache){this.longestTextCache={}}var g=c.longestText(e,f,this.ticks,this.longestTextCache);var n=g;var h;var k;var m=this.getPixelForTick(1)-this.getPixelForTick(0)-6;while(n>m&&this.labelRotation<p.maxRotation){h=Math.cos(c.toRadians(this.labelRotation));k=Math.sin(c.toRadians(this.labelRotation));l=h*o;if(l+q/2>this.yLabelWidth){this.paddingLeft=l+q/2}this.paddingRight=q/2;if(k*g>this.maxHeight){this.labelRotation--;break}this.labelRotation++;n=h*g}}}if(this.margins){this.paddingLeft=Math.max(this.paddingLeft-this.margins.left,0);this.paddingRight=Math.max(this.paddingRight-this.margins.right,0)}},afterCalculateTickRotation:function(){c.callCallback(this.options.afterCalculateTickRotation,[this])},beforeFit:function(){c.callCallback(this.options.beforeFit,[this])},fit:function(){var d=this.minSize={width:0,height:0};var n=this.options;var l=a.defaults.global;var p=n.ticks;var x=n.scaleLabel;var s=n.display;var k=this.isHorizontal();var r=c.getValueOrDefault(p.fontSize,l.defaultFontSize);var t=c.getValueOrDefault(p.fontStyle,l.defaultFontStyle);var i=c.getValueOrDefault(p.fontFamily,l.defaultFontFamily);var y=c.fontString(r,t,i);var m=c.getValueOrDefault(x.fontSize,l.defaultFontSize);var e=c.getValueOrDefault(x.fontStyle,l.defaultFontStyle);var u=c.getValueOrDefault(x.fontFamily,l.defaultFontFamily);var A=c.fontString(m,e,u);var j=n.gridLines.tickMarkLength;if(k){d.width=this.isFullWidth()?this.maxWidth-this.margins.left-this.margins.right:this.maxWidth}else{d.width=s?j:0}if(k){d.height=s?j:0}else{d.height=this.maxHeight}if(x.display&&s){if(k){d.height+=(m*1.5)}else{d.width+=(m*1.5)}}if(p.display&&s){if(!this.longestTextCache){this.longestTextCache={}}var v=c.longestText(this.ctx,y,this.ticks,this.longestTextCache);if(k){this.longestLabelWidth=v;var g=(Math.sin(c.toRadians(this.labelRotation))*this.longestLabelWidth)+1.5*r;d.height=Math.min(this.maxHeight,d.height+g);this.ctx.font=y;var h=this.ctx.measureText(this.ticks[0]).width;var q=this.ctx.measureText(this.ticks[this.ticks.length-1]).width;var z=Math.cos(c.toRadians(this.labelRotation));var f=Math.sin(c.toRadians(this.labelRotation));this.paddingLeft=this.labelRotation!==0?(z*h)+3:h/2+3;this.paddingRight=this.labelRotation!==0?(f*(r/2))+3:q/2+3}else{var w=this.maxWidth-d.width;var o=p.mirror;if(!o){v+=this.options.ticks.padding}else{v=0}if(v<w){d.width+=v}else{d.width=this.maxWidth}this.paddingTop=r/2;this.paddingBottom=r/2}}if(this.margins){this.paddingLeft=Math.max(this.paddingLeft-this.margins.left,0);this.paddingTop=Math.max(this.paddingTop-this.margins.top,0);this.paddingRight=Math.max(this.paddingRight-this.margins.right,0);this.paddingBottom=Math.max(this.paddingBottom-this.margins.bottom,0)}this.width=d.width;this.height=d.height},afterFit:function(){c.callCallback(this.options.afterFit,[this])},isHorizontal:function(){return this.options.position==="top"||this.options.position==="bottom"},isFullWidth:function(){return(this.options.fullWidth)},getRightValue:function b(d){if(d===null||typeof(d)==="undefined"){return NaN}if(typeof(d)==="number"&&isNaN(d)){return NaN}if(typeof(d)==="object"){if((d instanceof Date)||(d.isValid)){return d}else{return b(this.isHorizontal()?d.x:d.y)}}return d},getLabelForIndex:c.noop,getPixelForValue:c.noop,getValueForPixel:c.noop,getPixelForTick:function(g,h){if(this.isHorizontal()){var e=this.width-(this.paddingLeft+this.paddingRight);var d=e/Math.max((this.ticks.length-((this.options.gridLines.offsetGridLines)?0:1)),1);var f=(d*g)+this.paddingLeft;if(h){f+=d/2}var i=this.left+Math.round(f);i+=this.isFullWidth()?this.margins.left:0;return i}else{var j=this.height-(this.paddingTop+this.paddingBottom);return this.top+(g*(j/(this.ticks.length-1)))}},getPixelForDecimal:function(e){if(this.isHorizontal()){var d=this.width-(this.paddingLeft+this.paddingRight);var g=(d*e)+this.paddingLeft;var f=this.left+Math.round(g);f+=this.isFullWidth()?this.margins.left:0;return f}else{return this.top+(e*this.height)}},getBasePixel:function(){var f=this;var e=f.min;var d=f.max;return f.getPixelForValue(f.beginAtZero?0:e<0&&d<0?d:e>0&&d>0?e:0)},draw:function(f){var t=this.options;if(!t.display){return}var M=this.ctx;var A=a.defaults.global;var K=t.ticks;var e=t.gridLines;var w=t.scaleLabel;var k;var H=this.labelRotation!==0;var L;var G;var E;var D=K.autoSkip;var j;if(K.maxTicksLimit){j=K.maxTicksLimit}var l=c.getValueOrDefault(K.fontColor,A.defaultFontColor);var p=c.getValueOrDefault(K.fontSize,A.defaultFontSize);var u=c.getValueOrDefault(K.fontStyle,A.defaultFontStyle);var y=c.getValueOrDefault(K.fontFamily,A.defaultFontFamily);var I=c.fontString(p,u,y);var d=e.tickMarkLength;var r=c.getValueOrDefault(w.fontColor,A.defaultFontColor);var s=c.getValueOrDefault(w.fontSize,A.defaultFontSize);var B=c.getValueOrDefault(w.fontStyle,A.defaultFontStyle);var J=c.getValueOrDefault(w.fontFamily,A.defaultFontFamily);var i=c.fontString(s,B,J);var O=c.toRadians(this.labelRotation);var q=Math.cos(O);var P=Math.sin(O);var g=this.longestLabelWidth*q;var n=p*P;M.fillStyle=l;if(this.isHorizontal()){k=true;var F=t.position==="bottom"?this.top:this.bottom-d;var C=t.position==="bottom"?this.top+d:this.bottom;L=false;if(H){g/=2}if((g+K.autoSkipPadding)*this.ticks.length>(this.width-(this.paddingLeft+this.paddingRight))){L=1+Math.floor(((g+K.autoSkipPadding)*this.ticks.length)/(this.width-(this.paddingLeft+this.paddingRight)))}if(j&&this.ticks.length>j){while(!L||this.ticks.length/(L||1)>j){if(!L){L=1}L+=1}}if(!D){L=false}c.each(this.ticks,function(V,U){var S=this.ticks.length===U+1;var W=(L>1&&U%L>0)||(U%L===0&&U+L>=this.ticks.length);if(W&&!S||(V===undefined||V===null)){return}var T=this.getPixelForTick(U);var R=this.getPixelForTick(U,e.offsetGridLines);if(e.display){if(U===(typeof this.zeroLineIndex!=="undefined"?this.zeroLineIndex:0)){M.lineWidth=e.zeroLineWidth;M.strokeStyle=e.zeroLineColor;k=true}else{if(k){M.lineWidth=e.lineWidth;M.strokeStyle=e.color;k=false}}T+=c.aliasPixel(M.lineWidth);M.beginPath();if(e.drawTicks){M.moveTo(T,F);M.lineTo(T,C)}if(e.drawOnChartArea){M.moveTo(T,f.top);M.lineTo(T,f.bottom)}M.stroke()}if(K.display){M.save();M.translate(R+K.labelOffset,(H)?this.top+12:t.position==="top"?this.bottom-d:this.top+d);M.rotate(O*-1);M.font=I;M.textAlign=(H)?"right":"center";M.textBaseline=(H)?"middle":t.position==="top"?"bottom":"top";M.fillText(V,0,0);M.restore()}},this);if(w.display){M.textAlign="center";M.textBaseline="middle";M.fillStyle=r;M.font=i;G=this.left+((this.right-this.left)/2);E=t.position==="bottom"?this.bottom-(s/2):this.top+(s/2);M.fillText(w.labelString,G,E)}}else{k=true;var x=t.position==="right"?this.left:this.right-5;var z=t.position==="right"?this.left+5:this.right;c.each(this.ticks,function(V,U){if(V===undefined||V===null){return}var S=this.getPixelForTick(U);if(e.display){if(U===(typeof this.zeroLineIndex!=="undefined"?this.zeroLineIndex:0)){M.lineWidth=e.zeroLineWidth;M.strokeStyle=e.zeroLineColor;k=true}else{if(k){M.lineWidth=e.lineWidth;M.strokeStyle=e.color;k=false}}S+=c.aliasPixel(M.lineWidth);M.beginPath();if(e.drawTicks){M.moveTo(x,S);M.lineTo(z,S)}if(e.drawOnChartArea){M.moveTo(f.left,S);M.lineTo(f.right,S)}M.stroke()}if(K.display){var R;var T=this.getPixelForTick(U,e.offsetGridLines);M.save();if(t.position==="left"){if(K.mirror){R=this.right+K.padding;M.textAlign="left"}else{R=this.right-K.padding;M.textAlign="right"}}else{if(K.mirror){R=this.left-K.padding;M.textAlign="right"}else{R=this.left+K.padding;M.textAlign="left"}}M.translate(R,T+K.labelOffset);M.rotate(O*-1);M.font=I;M.textBaseline="middle";M.fillText(V,0,0);M.restore()}},this);if(w.display){G=t.position==="left"?this.left+(s/2):this.right-(s/2);E=this.top+((this.bottom-this.top)/2);var v=t.position==="left"?-0.5*Math.PI:0.5*Math.PI;M.save();M.translate(G,E);M.rotate(v);M.textAlign="center";M.fillStyle=r;M.font=i;M.textBaseline="middle";M.fillText(w.labelString,0,0);M.restore()}}if(e.drawBorder){M.lineWidth=e.lineWidth;M.strokeStyle=e.color;var o=this.left,m=this.right,Q=this.top,N=this.bottom;var h=c.aliasPixel(M.lineWidth);if(this.isHorizontal()){Q=N=t.position==="top"?this.bottom:this.top;Q+=h;N+=h}else{o=m=t.position==="left"?this.right:this.left;o+=h;m+=h}M.beginPath();M.moveTo(o,Q);M.lineTo(m,N);M.stroke()}}})};