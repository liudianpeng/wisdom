"use strict";module.exports=function(o){var i=o.helpers;o.types={};o.instances={};o.controllers={};o.Controller=function(s){this.chart=s;this.config=s.config;this.options=this.config.options=i.configMerge(o.defaults.global,o.defaults[this.config.type],this.config.options||{});this.id=i.uid();Object.defineProperty(this,"data",{get:function(){return this.config.data}});o.instances[this.id]=this;if(this.options.responsive){this.resize(true)}this.initialize();return this};i.extend(o.Controller.prototype,{initialize:function a(){o.pluginService.notifyPlugins("beforeInit",[this]);this.bindEvents();this.ensureScalesHaveIDs();this.buildOrUpdateControllers();this.buildScales();this.buildSurroundingItems();this.updateLayout();this.resetElements();this.initToolTip();this.update();o.pluginService.notifyPlugins("afterInit",[this]);return this},clear:function h(){i.clear(this.chart);return this},stop:function j(){o.animationService.cancelAnimation(this);return this},resize:function q(u){var v=this.chart.canvas;var w=i.getMaximumWidth(this.chart.canvas);var t=(this.options.maintainAspectRatio&&isNaN(this.chart.aspectRatio)===false&&isFinite(this.chart.aspectRatio)&&this.chart.aspectRatio!==0)?w/this.chart.aspectRatio:i.getMaximumHeight(this.chart.canvas);var s=this.chart.width!==w||this.chart.height!==t;if(!s){return this}v.width=this.chart.width=w;v.height=this.chart.height=t;i.retinaScale(this.chart);if(!u){this.stop();this.update(this.options.responsiveAnimationDuration)}return this},ensureScalesHaveIDs:function m(){var t=this.options;var u=t.scales||{};var s=t.scale;i.each(u.xAxes,function(v,w){v.id=v.id||("x-axis-"+w)});i.each(u.yAxes,function(w,v){w.id=w.id||("y-axis-"+v)});if(s){s.id=s.id||"scale"}},buildScales:function f(){var u=this;var t=u.options;var v=u.scales={};var s=[];if(t.scales){s=s.concat((t.scales.xAxes||[]).map(function(w){return{options:w,dtype:"category"}}),(t.scales.yAxes||[]).map(function(w){return{options:w,dtype:"linear"}}))}if(t.scale){s.push({options:t.scale,dtype:"radialLinear",isDefault:true})}i.each(s,function(z,y){var x=z.options;var w=i.getValueOrDefault(x.type,z.dtype);var B=o.scaleService.getScaleConstructor(w);if(!B){return}var A=new B({id:x.id,options:x,ctx:u.chart.ctx,chart:u});v[A.id]=A;if(z.isDefault){u.scale=A}});o.scaleService.addScalesToLayout(this)},buildSurroundingItems:function(){if(this.options.title){this.titleBlock=new o.Title({ctx:this.chart.ctx,options:this.options.title,chart:this});o.layoutService.addBox(this,this.titleBlock)}if(this.options.legend){this.legend=new o.Legend({ctx:this.chart.ctx,options:this.options.legend,chart:this});o.layoutService.addBox(this,this.legend)}},updateLayout:function(){o.layoutService.update(this,this.chart.width,this.chart.height)},buildOrUpdateControllers:function e(){var t=[];var u=[];i.each(this.data.datasets,function(w,x){var v=this.getDatasetMeta(x);if(!v.type){v.type=w.type||this.config.type}t.push(v.type);if(v.controller){v.controller.updateIndex(x)}else{v.controller=new o.controllers[v.type](this,x);u.push(v.controller)}},this);if(t.length>1){for(var s=1;s<t.length;s++){if(t[s]!==t[s-1]){this.isCombo=true;break}}}return u},resetElements:function c(){i.each(this.data.datasets,function(s,t){this.getDatasetMeta(t).controller.reset()},this)},update:function d(u,s){o.pluginService.notifyPlugins("beforeUpdate",[this]);this.tooltip._data=this.data;var t=this.buildOrUpdateControllers();i.each(this.data.datasets,function(v,w){this.getDatasetMeta(w).controller.buildOrUpdateElements()},this);o.layoutService.update(this,this.chart.width,this.chart.height);o.pluginService.notifyPlugins("afterScaleUpdate",[this]);i.each(t,function(v){v.reset()});i.each(this.data.datasets,function(v,w){this.getDatasetMeta(w).controller.update()},this);o.pluginService.notifyPlugins("afterUpdate",[this]);this.render(u,s)},render:function r(v,s){o.pluginService.notifyPlugins("beforeRender",[this]);var u=this.options.animation;if(u&&((typeof v!=="undefined"&&v!==0)||(typeof v==="undefined"&&u.duration!==0))){var t=new o.Animation();t.numSteps=(v||u.duration)/16.66;t.easing=u.easing;t.render=function(x,z){var A=i.easingEffects[z.easing];var y=z.currentStep/z.numSteps;var w=A(y);x.draw(w,y,z.currentStep)};t.onAnimationProgress=u.onProgress;t.onAnimationComplete=u.onComplete;o.animationService.addAnimation(this,t,v,s)}else{this.draw();if(u&&u.onComplete&&u.onComplete.call){u.onComplete.call(this)}}return this},draw:function(u){var s=u||1;this.clear();o.pluginService.notifyPlugins("beforeDraw",[this,s]);i.each(this.boxes,function(v){v.draw(this.chartArea)},this);if(this.scale){this.scale.draw()}var t=this.chart.ctx;t.save();t.beginPath();t.rect(this.chartArea.left,this.chartArea.top,this.chartArea.right-this.chartArea.left,this.chartArea.bottom-this.chartArea.top);t.clip();i.each(this.data.datasets,function(v,w){if(this.isDatasetVisible(w)){this.getDatasetMeta(w).controller.draw(u)}},this,true);t.restore();this.tooltip.transition(s).draw();o.pluginService.notifyPlugins("afterDraw",[this,s])},getElementAtEvent:function(u){var s=i.getRelativePosition(u,this.chart);var t=[];i.each(this.data.datasets,function(w,x){if(this.isDatasetVisible(x)){var v=this.getDatasetMeta(x);i.each(v.data,function(z,y){if(z.inRange(s.x,s.y)){t.push(z);return t}})}},this);return t},getElementsAtEvent:function(v){var s=i.getRelativePosition(v,this.chart);var u=[];var t=(function(){if(this.data.datasets){for(var x=0;x<this.data.datasets.length;x++){var y=this.getDatasetMeta(x);if(this.isDatasetVisible(x)){for(var w=0;w<y.data.length;w++){if(y.data[w].inRange(s.x,s.y)){return y.data[w]}}}}}}).call(this);if(!t){return u}i.each(this.data.datasets,function(x,y){if(this.isDatasetVisible(y)){var w=this.getDatasetMeta(y);u.push(w.data[t._index])}},this);return u},getElementsAtEventForMode:function(t,u){var s=this;switch(u){case"single":return s.getElementAtEvent(t);case"label":return s.getElementsAtEvent(t);case"dataset":return s.getDatasetAtEvent(t);default:return t}},getDatasetAtEvent:function(t){var s=this.getElementAtEvent(t);if(s.length>0){s=this.getDatasetMeta(s[0]._datasetIndex).data}return s},getDatasetMeta:function(u){var t=this.data.datasets[u];if(!t._meta){t._meta={}}var s=t._meta[this.id];if(!s){s=t._meta[this.id]={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null}}return s},getVisibleDatasetCount:function(){var u=0;for(var t=0,s=this.data.datasets.length;t<s;++t){if(this.isDatasetVisible(t)){u++}}return u},isDatasetVisible:function(t){var s=this.getDatasetMeta(t);return typeof s.hidden==="boolean"?!s.hidden:!this.data.datasets[t].hidden},generateLegend:function k(){return this.options.legendCallback(this)},destroy:function p(){this.clear();i.unbindEvents(this,this.events);i.removeResizeListener(this.chart.canvas.parentNode);var s=this.chart.canvas;s.width=this.chart.width;s.height=this.chart.height;if(this.chart.originalDevicePixelRatio!==undefined){this.chart.ctx.scale(1/this.chart.originalDevicePixelRatio,1/this.chart.originalDevicePixelRatio)}s.style.width=this.chart.originalCanvasStyleWidth;s.style.height=this.chart.originalCanvasStyleHeight;o.pluginService.notifyPlugins("destroy",[this]);delete o.instances[this.id]},toBase64Image:function g(){return this.chart.canvas.toDataURL.apply(this.chart.canvas,arguments)},initToolTip:function l(){this.tooltip=new o.Tooltip({_chart:this.chart,_chartInstance:this,_data:this.data,_options:this.options},this)},bindEvents:function b(){i.bindEvents(this,this.options.events,function(s){this.eventHandler(s)})},updateHoverStyle:function(w,x,s){var y=s?"setHoverStyle":"removeHoverStyle";var v,u,t;switch(x){case"single":w=[w[0]];break;case"label":case"dataset":break;default:return}for(u=0,t=w.length;u<t;++u){v=w[u];if(v){this.getDatasetMeta(v._datasetIndex).controller[y](v)}}},eventHandler:function n(x){var u=this;var v=u.tooltip;var t=u.options||{};var s=t.hover;var w=t.tooltips;u.lastActive=u.lastActive||[];u.lastTooltipActive=u.lastTooltipActive||[];if(x.type==="mouseout"){u.active=[];u.tooltipActive=[]}else{u.active=u.getElementsAtEventForMode(x,s.mode);u.tooltipActive=u.getElementsAtEventForMode(x,w.mode)}if(s.onHover){s.onHover.call(u,u.active)}if(x.type==="mouseup"||x.type==="click"){if(t.onClick){t.onClick.call(u,x,u.active)}if(u.legend&&u.legend.handleEvent){u.legend.handleEvent(x)}}if(u.lastActive.length){u.updateHoverStyle(u.lastActive,s.mode,false)}if(u.active.length&&s.mode){u.updateHoverStyle(u.active,s.mode,true)}if(w.enabled||w.custom){v.initialize();v._active=u.tooltipActive;v.update(true)}v.pivot();if(!u.animating){if(!i.arrayEquals(u.active,u.lastActive)||!i.arrayEquals(u.tooltipActive,u.lastTooltipActive)){u.stop();if(w.enabled||w.custom){v.update(true)}u.render(s.animationDuration,true)}}u.lastActive=u.active;u.lastTooltipActive=u.tooltipActive;return u}})};