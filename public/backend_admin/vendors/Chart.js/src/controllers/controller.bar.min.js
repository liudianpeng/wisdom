"use strict";module.exports=function(a){var d=a.helpers;a.defaults.bar={hover:{mode:"label"},scales:{xAxes:[{type:"category",categoryPercentage:0.8,barPercentage:0.9,gridLines:{offsetGridLines:true}}],yAxes:[{type:"linear"}]}};a.controllers.bar=a.DatasetController.extend({dataElementType:a.elements.Rectangle,initialize:function(f,g){a.DatasetController.prototype.initialize.call(this,f,g);this.getMeta().bar=true},getBarCount:function b(){var f=0;d.each(this.chart.data.datasets,function(h,i){var g=this.chart.getDatasetMeta(i);if(g.bar&&this.chart.isDatasetVisible(i)){++f}},this);return f},update:function e(f){d.each(this.getMeta().data,function(h,g){this.updateElement(h,g,f)},this)},updateElement:function c(m,l,k){var o=this.getMeta();var n=this.getScaleForId(o.xAxisID);var g=this.getScaleForId(o.yAxisID);var j=g.getBasePixel();var i=this.chart.options.elements.rectangle;var f=m.custom||{};var h=this.getDataset();d.extend(m,{_xScale:n,_yScale:g,_datasetIndex:this.index,_index:l,_model:{x:this.calculateBarX(l,this.index),y:k?j:this.calculateBarY(l,this.index),label:this.chart.data.labels[l],datasetLabel:h.label,base:k?j:this.calculateBarBase(this.index,l),width:this.calculateBarWidth(l),backgroundColor:f.backgroundColor?f.backgroundColor:d.getValueAtIndexOrDefault(h.backgroundColor,l,i.backgroundColor),borderSkipped:f.borderSkipped?f.borderSkipped:i.borderSkipped,borderColor:f.borderColor?f.borderColor:d.getValueAtIndexOrDefault(h.borderColor,l,i.borderColor),borderWidth:f.borderWidth?f.borderWidth:d.getValueAtIndexOrDefault(h.borderWidth,l,i.borderWidth)}});m.pivot()},calculateBarBase:function(t,p){var u=this.getMeta();var k=this.getScaleForId(u.yAxisID);var h=0;if(k.options.stacked){var q=this.chart;var m=q.data.datasets;var r=m[t].data[p];if(r<0){for(var o=0;o<t;o++){var l=m[o];var g=q.getDatasetMeta(o);if(g.bar&&g.yAxisID===k.id&&q.isDatasetVisible(o)){h+=l.data[p]<0?l.data[p]:0}}}else{for(var n=0;n<t;n++){var f=m[n];var s=q.getDatasetMeta(n);if(s.bar&&s.yAxisID===k.id&&q.isDatasetVisible(n)){h+=f.data[p]>0?f.data[p]:0}}}return k.getPixelForValue(h)}return k.getBasePixel()},getRuler:function(i){var o=this.getMeta();var l=this.getScaleForId(o.xAxisID);var n=this.getBarCount();var j;if(l.options.type==="category"){j=l.getPixelForTick(i+1)-l.getPixelForTick(i)}else{j=l.width/l.ticks.length}var g=j*l.options.categoryPercentage;var h=(j-(j*l.options.categoryPercentage))/2;var f=g/n;if(l.ticks.length!==this.chart.data.labels.length){var k=l.ticks.length/this.chart.data.labels.length;f=f*k}var p=f*l.options.barPercentage;var m=f-(f*l.options.barPercentage);return{datasetCount:n,tickWidth:j,categoryWidth:g,categorySpacing:h,fullBarWidth:f,barWidth:p,barSpacing:m}},calculateBarWidth:function(f){var g=this.getScaleForId(this.getMeta().xAxisID);var h=this.getRuler(f);return g.options.stacked?h.categoryWidth:h.barWidth},getBarIndex:function(i){var g=0;var h,f;for(f=0;f<i;++f){h=this.chart.getDatasetMeta(f);if(h.bar&&this.chart.isDatasetVisible(f)){++g}}return g},calculateBarX:function(g,l){var j=this.getMeta();var i=this.getScaleForId(j.xAxisID);var f=this.getBarIndex(l);var k=this.getRuler(g);var h=i.getPixelForValue(null,g,l,this.chart.isCombo);h-=this.chart.isCombo?(k.tickWidth/2):0;if(i.options.stacked){return h+(k.categoryWidth/2)+k.categorySpacing}return h+(k.barWidth/2)+k.categorySpacing+(k.barWidth*f)+(k.barSpacing/2)+(k.barSpacing*f)},calculateBarY:function(k,m){var n=this.getMeta();var f=this.getScaleForId(n.yAxisID);var l=this.getDataset().data[k];if(f.options.stacked){var h=0,p=0;for(var j=0;j<m;j++){var g=this.chart.data.datasets[j];var o=this.chart.getDatasetMeta(j);if(o.bar&&o.yAxisID===f.id&&this.chart.isDatasetVisible(j)){if(g.data[k]<0){p+=g.data[k]||0}else{h+=g.data[k]||0}}}if(l<0){return f.getPixelForValue(p+l)}else{return f.getPixelForValue(h+l)}}return f.getPixelForValue(l)},draw:function(g){var f=g||1;d.each(this.getMeta().data,function(i,h){var j=this.getDataset().data[h];if(j!==null&&j!==undefined&&!isNaN(j)){i.transition(f).draw()}},this)},setHoverStyle:function(h){var j=this.chart.data.datasets[h._datasetIndex];var g=h._index;var i=h.custom||{};var f=h._model;f.backgroundColor=i.hoverBackgroundColor?i.hoverBackgroundColor:d.getValueAtIndexOrDefault(j.hoverBackgroundColor,g,d.getHoverColor(f.backgroundColor));f.borderColor=i.hoverBorderColor?i.hoverBorderColor:d.getValueAtIndexOrDefault(j.hoverBorderColor,g,d.getHoverColor(f.borderColor));f.borderWidth=i.hoverBorderWidth?i.hoverBorderWidth:d.getValueAtIndexOrDefault(j.hoverBorderWidth,g,f.borderWidth)},removeHoverStyle:function(i){var k=this.chart.data.datasets[i._datasetIndex];var h=i._index;var j=i.custom||{};var g=i._model;var f=this.chart.options.elements.rectangle;g.backgroundColor=j.backgroundColor?j.backgroundColor:d.getValueAtIndexOrDefault(k.backgroundColor,h,f.backgroundColor);g.borderColor=j.borderColor?j.borderColor:d.getValueAtIndexOrDefault(k.borderColor,h,f.borderColor);g.borderWidth=j.borderWidth?j.borderWidth:d.getValueAtIndexOrDefault(k.borderWidth,h,f.borderWidth)}});a.defaults.horizontalBar={hover:{mode:"label"},scales:{xAxes:[{type:"linear",position:"bottom"}],yAxes:[{position:"left",type:"category",categoryPercentage:0.8,barPercentage:0.9,gridLines:{offsetGridLines:true}}]},elements:{rectangle:{borderSkipped:"left"}},tooltips:{callbacks:{title:function(f,g){var h="";if(f.length>0){if(f[0].yLabel){h=f[0].yLabel}else{if(g.labels.length>0&&f[0].index<g.labels.length){h=g.labels[f[0].index]}}}return h},label:function(f,g){var h=g.datasets[f.datasetIndex].label||"";return h+": "+f.xLabel}}}};a.controllers.horizontalBar=a.controllers.bar.extend({updateElement:function c(n,m,l,j){var p=this.getMeta();var o=this.getScaleForId(p.xAxisID);var g=this.getScaleForId(p.yAxisID);var k=o.getBasePixel();var f=n.custom||{};var h=this.getDataset();var i=this.chart.options.elements.rectangle;d.extend(n,{_xScale:o,_yScale:g,_datasetIndex:this.index,_index:m,_model:{x:l?k:this.calculateBarX(m,this.index),y:this.calculateBarY(m,this.index),label:this.chart.data.labels[m],datasetLabel:h.label,base:l?k:this.calculateBarBase(this.index,m),height:this.calculateBarHeight(m),backgroundColor:f.backgroundColor?f.backgroundColor:d.getValueAtIndexOrDefault(h.backgroundColor,m,i.backgroundColor),borderSkipped:f.borderSkipped?f.borderSkipped:i.borderSkipped,borderColor:f.borderColor?f.borderColor:d.getValueAtIndexOrDefault(h.borderColor,m,i.borderColor),borderWidth:f.borderWidth?f.borderWidth:d.getValueAtIndexOrDefault(h.borderWidth,m,i.borderWidth)},draw:function(){var B=this._chart.ctx;var r=this._view;var x=r.height/2,q=r.y-x,s=r.y+x,A=r.base-(r.base-r.x),y=r.borderWidth/2;if(r.borderWidth){q+=y;s-=y;A+=y}B.beginPath();B.fillStyle=r.backgroundColor;B.strokeStyle=r.borderColor;B.lineWidth=r.borderWidth;var u=[[r.base,s],[r.base,q],[A,q],[A,s]];var w=["bottom","left","top","right"];var z=w.indexOf(r.borderSkipped,0);if(z===-1){z=0}function v(C){return u[(z+C)%4]}B.moveTo.apply(B,v(0));for(var t=1;t<4;t++){B.lineTo.apply(B,v(t))}B.fill();if(r.borderWidth){B.stroke()}},inRange:function(r,q){var s=this._view;var t=false;if(s){if(s.x<s.base){t=(q>=s.y-s.height/2&&q<=s.y+s.height/2)&&(r>=s.x&&r<=s.base)}else{t=(q>=s.y-s.height/2&&q<=s.y+s.height/2)&&(r>=s.base&&r<=s.x)}}return t}});n.pivot()},calculateBarBase:function(r,n){var s=this.getMeta();var q=this.getScaleForId(s.xAxisID);var h=0;if(q.options.stacked){var o=this.chart.data.datasets[r].data[n];if(o<0){for(var m=0;m<r;m++){var k=this.chart.data.datasets[m];var g=this.chart.getDatasetMeta(m);if(g.bar&&g.xAxisID===q.id&&this.chart.isDatasetVisible(m)){h+=k.data[n]<0?k.data[n]:0}}}else{for(var l=0;l<r;l++){var f=this.chart.data.datasets[l];var p=this.chart.getDatasetMeta(l);if(p.bar&&p.xAxisID===q.id&&this.chart.isDatasetVisible(l)){h+=f.data[n]>0?f.data[n]:0}}}return q.getPixelForValue(h)}return q.getBasePixel()},getRuler:function(j){var o=this.getMeta();var g=this.getScaleForId(o.yAxisID);var n=this.getBarCount();var h;if(g.options.type==="category"){h=g.getPixelForTick(j+1)-g.getPixelForTick(j)}else{h=g.width/g.ticks.length}var f=h*g.options.categoryPercentage;var i=(h-(h*g.options.categoryPercentage))/2;var p=f/n;if(g.ticks.length!==this.chart.data.labels.length){var k=g.ticks.length/this.chart.data.labels.length;p=p*k}var m=p*g.options.barPercentage;var l=p-(p*g.options.barPercentage);return{datasetCount:n,tickHeight:h,categoryHeight:f,categorySpacing:i,fullBarHeight:p,barHeight:m,barSpacing:l,}},calculateBarHeight:function(f){var g=this.getScaleForId(this.getMeta().yAxisID);var h=this.getRuler(f);return g.options.stacked?h.categoryHeight:h.barHeight},calculateBarX:function(j,m){var n=this.getMeta();var l=this.getScaleForId(n.xAxisID);var k=this.getDataset().data[j];if(l.options.stacked){var g=0,p=0;for(var h=0;h<m;h++){var f=this.chart.data.datasets[h];var o=this.chart.getDatasetMeta(h);if(o.bar&&o.xAxisID===l.id&&this.chart.isDatasetVisible(h)){if(f.data[j]<0){p+=f.data[j]||0}else{g+=f.data[j]||0}}}if(k<0){return l.getPixelForValue(p+k)}else{return l.getPixelForValue(g+k)}}return l.getPixelForValue(k)},calculateBarY:function(h,l){var j=this.getMeta();var i=this.getScaleForId(j.yAxisID);var g=this.getBarIndex(l);var k=this.getRuler(h);var f=i.getPixelForValue(null,h,l,this.chart.isCombo);f-=this.chart.isCombo?(k.tickHeight/2):0;if(i.options.stacked){return f+(k.categoryHeight/2)+k.categorySpacing}return f+(k.barHeight/2)+k.categorySpacing+(k.barHeight*g)+(k.barSpacing/2)+(k.barSpacing*g)}})};