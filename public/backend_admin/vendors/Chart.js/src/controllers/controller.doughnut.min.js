"use strict";module.exports=function(b){var c=b.helpers,d=b.defaults;d.doughnut={animation:{animateRotate:true,animateScale:false},aspectRatio:1,hover:{mode:"single"},legendCallback:function(h){var k=[];k.push('<ul class="'+h.id+'-legend">');var j=h.data;var g=j.datasets;var l=j.labels;if(g.length){for(var f=0;f<g[0].data.length;++f){k.push('<li><span style="background-color:'+g[0].backgroundColor[f]+'"></span>');if(l[f]){k.push(l[f])}k.push("</li>")}}k.push("</ul>");return k.join("")},legend:{labels:{generateLabels:function(f){var g=f.data;if(g.labels.length&&g.datasets.length){return g.labels.map(function(p,n){var s=f.getDatasetMeta(0);var l=g.datasets[0];var j=s.data[n];var h=j.custom||{};var k=c.getValueAtIndexOrDefault;var m=f.options.elements.arc;var r=h.backgroundColor?h.backgroundColor:k(l.backgroundColor,n,m.backgroundColor);var q=h.borderColor?h.borderColor:k(l.borderColor,n,m.borderColor);var o=h.borderWidth?h.borderWidth:k(l.borderWidth,n,m.borderWidth);return{text:p,fillStyle:r,strokeStyle:q,lineWidth:o,hidden:isNaN(l.data[n])||s.data[n].hidden,index:n}})}else{return[]}}},onClick:function(m,f){var g=f.index;var k=this.chart;var j,h,l;for(j=0,h=(k.data.datasets||[]).length;j<h;++j){l=k.getDatasetMeta(j);l.data[g].hidden=!l.data[g].hidden}k.update()}},cutoutPercentage:50,rotation:Math.PI*-0.5,circumference:Math.PI*2,tooltips:{callbacks:{title:function(){return""},label:function(f,g){return g.labels[f.index]+": "+g.datasets[f.datasetIndex].data[f.index]}}}};d.pie=c.clone(d.doughnut);c.extend(d.pie,{cutoutPercentage:0});b.controllers.doughnut=b.controllers.pie=b.DatasetController.extend({dataElementType:b.elements.Arc,linkScales:c.noop,getRingIndex:function a(h){var g=0;for(var f=0;f<h;++f){if(this.chart.isDatasetVisible(f)){++g}}return g},update:function e(C){var z=this;var r=z.chart,D=r.chartArea,q=r.options,t=q.elements.arc,h=D.right-D.left-t.borderWidth,i=D.bottom-D.top-t.borderWidth,f=Math.min(h,i),m={x:0,y:0},p=z.getMeta(),u=q.cutoutPercentage,y=q.circumference;if(y<Math.PI*2){var A=q.rotation%(Math.PI*2);A+=Math.PI*2*(A>=Math.PI?-1:A<-Math.PI?1:0);var v=A+y;var k={x:Math.cos(A),y:Math.sin(A)};var j={x:Math.cos(v),y:Math.sin(v)};var w=(A<=0&&0<=v)||(A<=Math.PI*2&&Math.PI*2<=v);var o=(A<=Math.PI*0.5&&Math.PI*0.5<=v)||(A<=Math.PI*2.5&&Math.PI*2.5<=v);var g=(A<=-Math.PI&&-Math.PI<=v)||(A<=Math.PI&&Math.PI<=v);var l=(A<=-Math.PI*0.5&&-Math.PI*0.5<=v)||(A<=Math.PI*1.5&&Math.PI*1.5<=v);var n=u/100;var x={x:g?-1:Math.min(k.x*(k.x<0?1:n),j.x*(j.x<0?1:n)),y:l?-1:Math.min(k.y*(k.y<0?1:n),j.y*(j.y<0?1:n))};var B={x:w?1:Math.max(k.x*(k.x>0?1:n),j.x*(j.x>0?1:n)),y:o?1:Math.max(k.y*(k.y>0?1:n),j.y*(j.y>0?1:n))};var s={width:(B.x-x.x)*0.5,height:(B.y-x.y)*0.5};f=Math.min(h/s.width,i/s.height);m={x:(B.x+x.x)*-0.5,y:(B.y+x.y)*-0.5}}r.outerRadius=Math.max(f/2,0);r.innerRadius=Math.max(u?(r.outerRadius/100)*(u):1,0);r.radiusLength=(r.outerRadius-r.innerRadius)/r.getVisibleDatasetCount();r.offsetX=m.x*r.outerRadius;r.offsetY=m.y*r.outerRadius;p.total=z.calculateTotal();z.outerRadius=r.outerRadius-(r.radiusLength*z.getRingIndex(z.index));z.innerRadius=z.outerRadius-r.radiusLength;c.each(p.data,function(F,E){z.updateElement(F,E,C)})},updateElement:function(j,h,w){var u=this;var o=u.chart,x=o.chartArea,n=o.options,y=n.animation,p=n.elements.arc,l=(x.left+x.right)/2,k=(x.top+x.bottom)/2,v=n.rotation,q=n.rotation,m=u.getDataset(),t=w&&y.animateRotate?0:j.hidden?0:u.calculateCircumference(m.data[h])*(n.circumference/(2*Math.PI)),i=w&&y.animateScale?0:u.innerRadius,s=w&&y.animateScale?0:u.outerRadius,f=j.custom||{},r=c.getValueAtIndexOrDefault;c.extend(j,{_datasetIndex:u.index,_index:h,_model:{x:l+o.offsetX,y:k+o.offsetY,startAngle:v,endAngle:q,circumference:t,outerRadius:s,innerRadius:i,label:r(m.label,h,o.data.labels[h])}});var g=j._model;g.backgroundColor=f.backgroundColor?f.backgroundColor:r(m.backgroundColor,h,p.backgroundColor);g.hoverBackgroundColor=f.hoverBackgroundColor?f.hoverBackgroundColor:r(m.hoverBackgroundColor,h,p.hoverBackgroundColor);g.borderWidth=f.borderWidth?f.borderWidth:r(m.borderWidth,h,p.borderWidth);g.borderColor=f.borderColor?f.borderColor:r(m.borderColor,h,p.borderColor);if(!w||!y.animateRotate){if(h===0){g.startAngle=n.rotation}else{g.startAngle=u.getMeta().data[h-1]._model.endAngle}g.endAngle=g.startAngle+g.circumference}j.pivot()},removeHoverStyle:function(f){b.DatasetController.prototype.removeHoverStyle.call(this,f,this.chart.options.elements.arc)},calculateTotal:function(){var i=this.getDataset();var h=this.getMeta();var f=0;var g;c.each(h.data,function(k,j){g=i.data[j];if(!isNaN(g)&&!k.hidden){f+=Math.abs(g)}});return f},calculateCircumference:function(g){var f=this.getMeta().total;if(f>0&&!isNaN(g)){return(Math.PI*2)*(g/f)}else{return 0}}})};