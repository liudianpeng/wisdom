"use strict";var moment=require("moment");moment=typeof(moment)==="function"?moment:window.moment;module.exports=function(b){var e=b.helpers;var f={units:[{name:"millisecond",steps:[1,2,5,10,20,50,100,250,500]},{name:"second",steps:[1,2,5,10,30]},{name:"minute",steps:[1,2,5,10,30]},{name:"hour",steps:[1,2,3,6,12]},{name:"day",steps:[1,2,5]},{name:"week",maxStep:4},{name:"month",maxStep:3},{name:"quarter",maxStep:4},{name:"year",maxStep:false}]};var a={position:"bottom",time:{parser:false,format:false,unit:false,round:false,displayFormat:false,isoWeekday:false,displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm:ss a",hour:"MMM D, hA",day:"ll",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:false}};var d=b.Scale.extend({initialize:function(){if(!moment){throw new Error("Chart.js - Moment.js could not be found! You must include it before Chart.js to use the time scale. Download at https://momentjs.com")}b.Scale.prototype.initialize.call(this)},getLabelMoment:function(h,g){return this.labelMoments[h][g]},getMomentStartOf:function(g){if(this.options.time.unit==="week"&&this.options.time.isoWeekday!==false){return g.clone().startOf("isoWeek").isoWeekday(this.options.time.isoWeekday)}else{return g.clone().startOf(this.tickUnit)}},determineDataLimits:function(){this.labelMoments=[];var g=[];if(this.chart.data.labels&&this.chart.data.labels.length>0){e.each(this.chart.data.labels,function(i,h){var j=this.parseTime(i);if(j.isValid()){if(this.options.time.round){j.startOf(this.options.time.round)}g.push(j)}},this);this.firstTick=moment.min.call(this,g);this.lastTick=moment.max.call(this,g)}else{this.firstTick=null;this.lastTick=null}e.each(this.chart.data.datasets,function(j,k){var h=[];var i=this.chart.isDatasetVisible(k);if(typeof j.data[0]==="object"&&j.data[0]!==null){e.each(j.data,function(n,l){var m=this.parseTime(this.getRightValue(n));if(m.isValid()){if(this.options.time.round){m.startOf(this.options.time.round)}h.push(m);if(i){this.firstTick=this.firstTick!==null?moment.min(this.firstTick,m):m;this.lastTick=this.lastTick!==null?moment.max(this.lastTick,m):m}}},this)}else{h=g}this.labelMoments.push(h)},this);if(this.options.time.min){this.firstTick=this.parseTime(this.options.time.min)}if(this.options.time.max){this.lastTick=this.parseTime(this.options.time.max)}this.firstTick=(this.firstTick||moment()).clone();this.lastTick=(this.lastTick||moment()).clone()},buildTicks:function(p){this.ctx.save();var u=e.getValueOrDefault(this.options.ticks.fontSize,b.defaults.global.defaultFontSize);var x=e.getValueOrDefault(this.options.ticks.fontStyle,b.defaults.global.defaultFontStyle);var k=e.getValueOrDefault(this.options.ticks.fontFamily,b.defaults.global.defaultFontFamily);var A=e.fontString(u,x,k);this.ctx.font=A;this.ticks=[];this.unitScale=1;this.scaleSizeInUnits=0;if(this.options.time.unit){this.tickUnit=this.options.time.unit||"day";this.displayFormat=this.options.time.displayFormats[this.tickUnit];this.scaleSizeInUnits=this.lastTick.diff(this.firstTick,this.tickUnit,true);this.unitScale=e.getValueOrDefault(this.options.time.unitStepSize,1)}else{var t=this.isHorizontal()?this.width-(this.paddingLeft+this.paddingRight):this.height-(this.paddingTop+this.paddingBottom);var q=this.tickFormatFunction(this.firstTick,0,[]);var y=this.ctx.measureText(q).width;var B=Math.cos(e.toRadians(this.options.ticks.maxRotation));var g=Math.sin(e.toRadians(this.options.ticks.maxRotation));y=(y*B)+(u*g);var j=t/(y);this.tickUnit="millisecond";this.scaleSizeInUnits=this.lastTick.diff(this.firstTick,this.tickUnit,true);this.displayFormat=this.options.time.displayFormats[this.tickUnit];var m=0;var h=f.units[m];while(m<f.units.length){this.unitScale=1;if(e.isArray(h.steps)&&Math.ceil(this.scaleSizeInUnits/j)<e.max(h.steps)){for(var s=0;s<h.steps.length;++s){if(h.steps[s]>=Math.ceil(this.scaleSizeInUnits/j)){this.unitScale=e.getValueOrDefault(this.options.time.unitStepSize,h.steps[s]);break}}break}else{if((h.maxStep===false)||(Math.ceil(this.scaleSizeInUnits/j)<h.maxStep)){this.unitScale=e.getValueOrDefault(this.options.time.unitStepSize,Math.ceil(this.scaleSizeInUnits/j));break}else{++m;h=f.units[m];this.tickUnit=h.name;var z=this.firstTick.diff(this.getMomentStartOf(this.firstTick),this.tickUnit,true);var v=this.getMomentStartOf(this.lastTick.clone().add(1,this.tickUnit)).diff(this.lastTick,this.tickUnit,true);this.scaleSizeInUnits=this.lastTick.diff(this.firstTick,this.tickUnit,true)+z+v;this.displayFormat=this.options.time.displayFormats[h.name]}}}}var n;if(!this.options.time.min){this.firstTick=this.getMomentStartOf(this.firstTick);n=this.firstTick}else{n=this.getMomentStartOf(this.firstTick)}if(!this.options.time.max){var o=this.getMomentStartOf(this.lastTick);if(o.diff(this.lastTick,this.tickUnit,true)!==0){this.lastTick=this.getMomentStartOf(this.lastTick.add(1,this.tickUnit))}}this.smallestLabelSeparation=this.width;e.each(this.chart.data.datasets,function(D,E){for(var C=1;C<this.labelMoments[E].length;C++){this.smallestLabelSeparation=Math.min(this.smallestLabelSeparation,this.labelMoments[E][C].diff(this.labelMoments[E][C-1],this.tickUnit,true))}},this);if(this.options.time.displayFormat){this.displayFormat=this.options.time.displayFormat}this.ticks.push(this.firstTick.clone());for(var w=1;w<=this.scaleSizeInUnits;++w){var l=n.clone().add(w,this.tickUnit);if(this.options.time.max&&l.diff(this.lastTick,this.tickUnit,true)>=0){break}if(w%this.unitScale===0){this.ticks.push(l)}}var r=this.ticks[this.ticks.length-1].diff(this.lastTick,this.tickUnit);if(r!==0||this.scaleSizeInUnits===0){if(this.options.time.max){this.ticks.push(this.lastTick.clone());this.scaleSizeInUnits=this.lastTick.diff(this.ticks[0],this.tickUnit,true)}else{this.ticks.push(this.lastTick.clone());this.scaleSizeInUnits=this.lastTick.diff(this.firstTick,this.tickUnit,true)}}this.ctx.restore()},getLabelForIndex:function(h,i){var g=this.chart.data.labels&&h<this.chart.data.labels.length?this.chart.data.labels[h]:"";if(typeof this.chart.data.datasets[i].data[0]==="object"){g=this.getRightValue(this.chart.data.datasets[i].data[h])}if(this.options.time.tooltipFormat){g=this.parseTime(g).format(this.options.time.tooltipFormat)}return g},tickFormatFunction:function c(i,h,j){var g=i.format(this.displayFormat);var k=this.options.ticks;var l=e.getValueOrDefault(k.callback,k.userCallback);if(l){return l(g,h,j)}else{return g}},convertTicksToLabels:function(){this.tickMoments=this.ticks;this.ticks=this.ticks.map(this.tickFormatFunction,this)},getPixelForValue:function(r,o,s,l){var n=r&&r.isValid&&r.isValid()?r:this.getLabelMoment(s,o);if(n){var k=n.diff(this.firstTick,this.tickUnit,true);var m=k/this.scaleSizeInUnits;if(this.isHorizontal()){var q=this.width-(this.paddingLeft+this.paddingRight);var j=q/Math.max(this.ticks.length-1,1);var i=(q*m)+this.paddingLeft;return this.left+Math.round(i)}else{var h=this.height-(this.paddingTop+this.paddingBottom);var p=h/Math.max(this.ticks.length-1,1);var g=(h*m)+this.paddingTop;return this.top+Math.round(g)}}},getPixelForTick:function(g,h){return this.getPixelForValue(this.tickMoments[g],null,null,h)},getValueForPixel:function(g){var h=this.isHorizontal()?this.width-(this.paddingLeft+this.paddingRight):this.height-(this.paddingTop+this.paddingBottom);var i=(g-(this.isHorizontal()?this.left+this.paddingLeft:this.top+this.paddingTop))/h;i*=this.scaleSizeInUnits;return this.firstTick.clone().add(moment.duration(i,this.tickUnit).asSeconds(),"seconds")},parseTime:function(g){if(typeof this.options.time.parser==="string"){return moment(g,this.options.time.parser)}if(typeof this.options.time.parser==="function"){return this.options.time.parser(g)}if(typeof g.getMonth==="function"||typeof g==="number"){return moment(g)}if(g.isValid&&g.isValid()){return g}if(typeof this.options.time.format!=="string"&&this.options.time.format.call){console.warn("options.time.format is deprecated and replaced by options.time.parser. See http://nnnick.github.io/Chart.js/docs-v2/#scales-time-scale");return this.options.time.format(g)}return moment(g,this.options.time.format)}});b.scaleService.registerScaleType("time",d,a)};