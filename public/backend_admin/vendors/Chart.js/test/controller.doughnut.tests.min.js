describe("Doughnut controller tests",function(){beforeEach(function(){window.addDefaultMatchers(jasmine)});afterEach(function(){window.releaseAllCharts()});it("should be constructed",function(){var a=window.acquireChart({type:"doughnut",data:{datasets:[{data:[]}],labels:[]}});var b=a.getDatasetMeta(0);expect(b.type).toBe("doughnut");expect(b.controller).not.toBe(undefined);expect(b.controller.index).toBe(0);expect(b.data).toEqual([]);b.controller.updateIndex(1);expect(b.controller.index).toBe(1)});it("should create arc elements for each data item during initialization",function(){var a=window.acquireChart({type:"doughnut",data:{datasets:[{data:[10,15,0,4]}],labels:[]}});var b=a.getDatasetMeta(0);expect(b.data.length).toBe(4);expect(b.data[0] instanceof Chart.elements.Arc).toBe(true);expect(b.data[1] instanceof Chart.elements.Arc).toBe(true);expect(b.data[2] instanceof Chart.elements.Arc).toBe(true);expect(b.data[3] instanceof Chart.elements.Arc).toBe(true)});it("should reset and update elements",function(){var a=window.acquireChart({type:"doughnut",data:{datasets:[{data:[1,2,3,4],hidden:true},{data:[5,6,0,7]},{data:[8,9,10,11]}],labels:["label0","label1","label2","label3"]},options:{animation:{animateRotate:true,animateScale:false},cutoutPercentage:50,rotation:Math.PI*-0.5,circumference:Math.PI*2,elements:{arc:{backgroundColor:"rgb(255, 0, 0)",borderColor:"rgb(0, 0, 255)",borderWidth:2,hoverBackgroundColor:"rgb(255, 255, 255)"}}}});var b=a.getDatasetMeta(1);b.controller.reset();expect(b.data.length).toBe(4);[{c:0},{c:0},{c:0,},{c:0}].forEach(function(d,c){expect(b.data[c]._model.x).toBeCloseToPixel(256);expect(b.data[c]._model.y).toBeCloseToPixel(272);expect(b.data[c]._model.outerRadius).toBeCloseToPixel(239);expect(b.data[c]._model.innerRadius).toBeCloseToPixel(179);expect(b.data[c]._model.circumference).toBeCloseTo(d.c,8);expect(b.data[c]._model).toEqual(jasmine.objectContaining({startAngle:Math.PI*-0.5,endAngle:Math.PI*-0.5,label:a.data.labels[c],hoverBackgroundColor:"rgb(255, 255, 255)",backgroundColor:"rgb(255, 0, 0)",borderColor:"rgb(0, 0, 255)",borderWidth:2}))});a.update();[{c:1.7453292519,s:-1.5707963267,e:0.1745329251},{c:2.0943951023,s:0.1745329251,e:2.2689280275},{c:0,s:2.2689280275,e:2.2689280275},{c:2.4434609527,s:2.2689280275,e:4.7123889803}].forEach(function(d,c){expect(b.data[c]._model.x).toBeCloseToPixel(256);expect(b.data[c]._model.y).toBeCloseToPixel(272);expect(b.data[c]._model.outerRadius).toBeCloseToPixel(239);expect(b.data[c]._model.innerRadius).toBeCloseToPixel(179);expect(b.data[c]._model.circumference).toBeCloseTo(d.c,8);expect(b.data[c]._model.startAngle).toBeCloseTo(d.s,8);expect(b.data[c]._model.endAngle).toBeCloseTo(d.e,8);expect(b.data[c]._model).toEqual(jasmine.objectContaining({label:a.data.labels[c],hoverBackgroundColor:"rgb(255, 255, 255)",backgroundColor:"rgb(255, 0, 0)",borderColor:"rgb(0, 0, 255)",borderWidth:2}))});a.data.datasets[1].data=[1,2];a.update();expect(b.data.length).toBe(2);expect(b.data[0] instanceof Chart.elements.Arc).toBe(true);expect(b.data[1] instanceof Chart.elements.Arc).toBe(true);a.data.datasets[1].data=[1,2,3,4];a.update();expect(b.data.length).toBe(4);expect(b.data[0] instanceof Chart.elements.Arc).toBe(true);expect(b.data[1] instanceof Chart.elements.Arc).toBe(true);expect(b.data[2] instanceof Chart.elements.Arc).toBe(true);expect(b.data[3] instanceof Chart.elements.Arc).toBe(true)});it("should rotate and limit circumference",function(){var a=window.acquireChart({type:"doughnut",data:{datasets:[{data:[2,4],hidden:true},{data:[1,3]},{data:[1,0]}],labels:["label0","label1"]},options:{cutoutPercentage:50,rotation:Math.PI,circumference:Math.PI*0.5,elements:{arc:{backgroundColor:"rgb(255, 0, 0)",borderColor:"rgb(0, 0, 255)",borderWidth:2,hoverBackgroundColor:"rgb(255, 255, 255)"}}}});var b=a.getDatasetMeta(1);expect(b.data.length).toBe(2);[{c:Math.PI/8,s:Math.PI,e:Math.PI+Math.PI/8},{c:3*Math.PI/8,s:Math.PI+Math.PI/8,e:Math.PI+Math.PI/2}].forEach(function(d,c){expect(b.data[c]._model.x).toBeCloseToPixel(495);expect(b.data[c]._model.y).toBeCloseToPixel(511);expect(b.data[c]._model.outerRadius).toBeCloseToPixel(478);expect(b.data[c]._model.innerRadius).toBeCloseToPixel(359);expect(b.data[c]._model.circumference).toBeCloseTo(d.c,8);expect(b.data[c]._model.startAngle).toBeCloseTo(d.s,8);expect(b.data[c]._model.endAngle).toBeCloseTo(d.e,8)})});it("should draw all arcs",function(){var a=window.acquireChart({type:"doughnut",data:{datasets:[{data:[10,15,0,4]}],labels:["label0","label1","label2","label3"]}});var b=a.getDatasetMeta(0);spyOn(b.data[0],"draw");spyOn(b.data[1],"draw");spyOn(b.data[2],"draw");spyOn(b.data[3],"draw");a.update();expect(b.data[0].draw.calls.count()).toBe(1);expect(b.data[1].draw.calls.count()).toBe(1);expect(b.data[2].draw.calls.count()).toBe(1);expect(b.data[3].draw.calls.count()).toBe(1)});it("should set the hover style of an arc",function(){var b=window.acquireChart({type:"doughnut",data:{datasets:[{data:[10,15,0,4]}],labels:["label0","label1","label2","label3"]},options:{elements:{arc:{backgroundColor:"rgb(255, 0, 0)",borderColor:"rgb(0, 0, 255)",borderWidth:2,}}}});var c=b.getDatasetMeta(0);var a=c.data[0];c.controller.setHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(230, 0, 0)");expect(a._model.borderColor).toBe("rgb(0, 0, 230)");expect(a._model.borderWidth).toBe(2);b.data.datasets[0].hoverBackgroundColor="rgb(9, 9, 9)";b.data.datasets[0].hoverBorderColor="rgb(18, 18, 18)";b.data.datasets[0].hoverBorderWidth=1.56;c.controller.setHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(9, 9, 9)");expect(a._model.borderColor).toBe("rgb(18, 18, 18)");expect(a._model.borderWidth).toBe(1.56);b.data.datasets[0].hoverBackgroundColor=["rgb(255, 255, 255)","rgb(9, 9, 9)"];b.data.datasets[0].hoverBorderColor=["rgb(18, 18, 18)"];b.data.datasets[0].hoverBorderWidth=[0.1,1.56];c.controller.setHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(255, 255, 255)");expect(a._model.borderColor).toBe("rgb(18, 18, 18)");expect(a._model.borderWidth).toBe(0.1);a.custom={hoverBackgroundColor:"rgb(7, 7, 7)",hoverBorderColor:"rgb(17, 17, 17)",hoverBorderWidth:3.14159,};c.controller.setHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(7, 7, 7)");expect(a._model.borderColor).toBe("rgb(17, 17, 17)");expect(a._model.borderWidth).toBe(3.14159)});it("should unset the hover style of an arc",function(){var b=window.acquireChart({type:"doughnut",data:{datasets:[{data:[10,15,0,4]}],labels:["label0","label1","label2","label3"]},options:{elements:{arc:{backgroundColor:"rgb(255, 0, 0)",borderColor:"rgb(0, 0, 255)",borderWidth:2,}}}});var c=b.getDatasetMeta(0);var a=c.data[0];c.controller.removeHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(255, 0, 0)");expect(a._model.borderColor).toBe("rgb(0, 0, 255)");expect(a._model.borderWidth).toBe(2);b.data.datasets[0].backgroundColor="rgb(9, 9, 9)";b.data.datasets[0].borderColor="rgb(18, 18, 18)";b.data.datasets[0].borderWidth=1.56;c.controller.removeHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(9, 9, 9)");expect(a._model.borderColor).toBe("rgb(18, 18, 18)");expect(a._model.borderWidth).toBe(1.56);b.data.datasets[0].backgroundColor=["rgb(255, 255, 255)","rgb(9, 9, 9)"];b.data.datasets[0].borderColor=["rgb(18, 18, 18)"];b.data.datasets[0].borderWidth=[0.1,1.56];c.controller.removeHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(255, 255, 255)");expect(a._model.borderColor).toBe("rgb(18, 18, 18)");expect(a._model.borderWidth).toBe(0.1);a.custom={backgroundColor:"rgb(7, 7, 7)",borderColor:"rgb(17, 17, 17)",borderWidth:3.14159,};c.controller.removeHoverStyle(a);expect(a._model.backgroundColor).toBe("rgb(7, 7, 7)");expect(a._model.borderColor).toBe("rgb(17, 17, 17)");expect(a._model.borderWidth).toBe(3.14159)})});