describe("Core helper tests",function(){var a;beforeAll(function(){a=window.Chart.helpers});it("should iterate over an array and pass the extra data to that function",function(){var b=[0,9,"abc"];var c={};a.each(b,function(f,e){expect(f).not.toBe(undefined);expect(e).not.toBe(undefined);expect(b[e]).toBe(f);expect(this).toBe(c)},c);var d=[];a.each(b,function(f,e){expect(f).not.toBe(undefined);expect(e).not.toBe(undefined);expect(b[e]).toBe(f);expect(this).toBe(c);d.push(f)},c,true);expect(d.slice().reverse()).toEqual(b)});it("should iterate over properties in an object",function(){var b={myProp1:"abc",myProp2:276,myProp3:["a","b"]};a.each(b,function(d,c){if(c==="myProp1"){expect(d).toBe("abc")}else{if(c==="myProp2"){expect(d).toBe(276)}else{if(c==="myProp3"){expect(d).toEqual(["a","b"])}else{expect(false).toBe(true)}}}})});it("should not error when iterating over a null object",function(){expect(function(){a.each(undefined)}).not.toThrow()});it("should clone an object",function(){var b={myProp1:"abc",myProp2:["a","b"],myProp3:{myProp4:5,myProp5:[1,2]}};var c=a.clone(b);expect(c).toEqual(b);expect(c).not.toBe(b);expect(c.myProp2).not.toBe(b.myProp2);expect(c.myProp3).not.toBe(b.myProp3);expect(c.myProp3.myProp5).not.toBe(b.myProp3.myProp5)});it("should extend an object",function(){var b={myProp1:"abc",myProp2:56};var c={myProp3:[2,5,6],myProp2:0};a.extend(b,c);expect(b).toEqual({myProp1:"abc",myProp2:0,myProp3:[2,5,6],})});it("should merge a normal config without scales",function(){var d={valueProp:5,arrayProp:[1,2,3,4,5,6],objectProp:{prop1:"abc",prop2:56}};var c={valueProp2:null,arrayProp:["a","c"],objectProp:{prop1:"c",prop3:"prop3"}};var b=a.configMerge(d,c);expect(b).toEqual({valueProp:5,valueProp2:null,arrayProp:["a","c",3,4,5,6],objectProp:{prop1:"c",prop2:56,prop3:"prop3"}})});it("should merge arrays containing objects",function(){var d={arrayProp:[{prop1:"abc",prop2:56}],};var c={arrayProp:[{prop1:"myProp1",prop3:"prop3"},2,{prop1:"myProp1"}],};var b=a.configMerge(d,c);expect(b).toEqual({arrayProp:[{prop1:"myProp1",prop2:56,prop3:"prop3"},2,{prop1:"myProp1"}],})});it("should merge scale configs",function(){var d={scales:{prop1:{abc:123,def:"456"},prop2:777,yAxes:[{type:"linear",},{type:"log"}]}};var c={scales:{prop1:{def:"bbb",ghi:78},prop2:null,yAxes:[{type:"linear",axisProp:456},{type:"linear",position:"right"},{type:"linear"}]}};var b=a.configMerge(d,c);expect(b).toEqual({scales:{prop1:{abc:123,def:"bbb",ghi:78},prop2:null,yAxes:[{type:"linear",axisProp:456},{display:true,gridLines:{color:"rgba(0, 0, 0, 0.1)",drawBorder:true,drawOnChartArea:true,drawTicks:true,tickMarkLength:10,lineWidth:1,offsetGridLines:false,display:true,zeroLineColor:"rgba(0,0,0,0.25)",zeroLineWidth:1,},position:"right",scaleLabel:{labelString:"",display:false,},ticks:{beginAtZero:false,minRotation:0,maxRotation:50,mirror:false,padding:10,reverse:false,display:true,callback:b.scales.yAxes[1].ticks.callback,autoSkip:true,autoSkipPadding:0,labelOffset:0,},type:"linear"},{display:true,gridLines:{color:"rgba(0, 0, 0, 0.1)",drawBorder:true,drawOnChartArea:true,drawTicks:true,tickMarkLength:10,lineWidth:1,offsetGridLines:false,display:true,zeroLineColor:"rgba(0,0,0,0.25)",zeroLineWidth:1,},position:"left",scaleLabel:{labelString:"",display:false,},ticks:{beginAtZero:false,minRotation:0,maxRotation:50,mirror:false,padding:10,reverse:false,display:true,callback:b.scales.yAxes[2].ticks.callback,autoSkip:true,autoSkipPadding:0,labelOffset:0,},type:"linear"}]}});expect(b.scales.yAxes[1].ticks.callback).toEqual(jasmine.any(Function));expect(b.scales.yAxes[2].ticks.callback).toEqual(jasmine.any(Function))});it("should get value or default",function(){expect(a.getValueAtIndexOrDefault(98,0,56)).toBe(98);expect(a.getValueAtIndexOrDefault(0,0,56)).toBe(0);expect(a.getValueAtIndexOrDefault(undefined,undefined,56)).toBe(56);expect(a.getValueAtIndexOrDefault([1,2,3],1,100)).toBe(2);expect(a.getValueAtIndexOrDefault([1,2,3],3,100)).toBe(100)});it("should filter an array",function(){var b=[-10,0,6,0,7];var c=function(d){return d>2};expect(a.where(b,c)).toEqual([6,7]);expect(a.findNextWhere(b,c)).toEqual(6);expect(a.findNextWhere(b,c,2)).toBe(7);expect(a.findNextWhere(b,c,4)).toBe(undefined);expect(a.findPreviousWhere(b,c)).toBe(7);expect(a.findPreviousWhere(b,c,3)).toBe(6);expect(a.findPreviousWhere(b,c,0)).toBe(undefined)});it("should get the correct sign",function(){expect(a.sign(0)).toBe(0);expect(a.sign(10)).toBe(1);expect(a.sign(-5)).toBe(-1)});it("should do a log10 operation",function(){expect(a.log10(0)).toBe(-Infinity);expect(a.log10(1)).toBe(0);expect(a.log10(1000)).toBeCloseTo(3,1e-9)});it("should correctly determine if two numbers are essentially equal",function(){expect(a.almostEquals(0,Number.EPSILON,2*Number.EPSILON)).toBe(true);expect(a.almostEquals(1,1.1,0.0001)).toBe(false);expect(a.almostEquals(1e+30,1e+30+Number.EPSILON,0)).toBe(false);expect(a.almostEquals(1e+30,1e+30+Number.EPSILON,2*Number.EPSILON)).toBe(true)});it("should generate integer ids",function(){var b=a.uid();expect(b).toEqual(jasmine.any(Number));expect(a.uid()).toBe(b+1);expect(a.uid()).toBe(b+2);expect(a.uid()).toBe(b+3)});it("should detect a number",function(){expect(a.isNumber(123)).toBe(true);expect(a.isNumber("123")).toBe(true);expect(a.isNumber(null)).toBe(false);expect(a.isNumber(NaN)).toBe(false);expect(a.isNumber(undefined)).toBe(false);expect(a.isNumber("cbc")).toBe(false)});it("should convert between radians and degrees",function(){expect(a.toRadians(180)).toBe(Math.PI);expect(a.toRadians(90)).toBe(0.5*Math.PI);expect(a.toDegrees(Math.PI)).toBe(180);expect(a.toDegrees(Math.PI*3/2)).toBe(270)});it("should get an angle from a point",function(){var b={x:0,y:0};expect(a.getAngleFromPoint(b,{x:0,y:10})).toEqual({angle:Math.PI/2,distance:10,});expect(a.getAngleFromPoint(b,{x:Math.sqrt(2),y:Math.sqrt(2)})).toEqual({angle:Math.PI/4,distance:2});expect(a.getAngleFromPoint(b,{x:-1*Math.sqrt(2),y:-1*Math.sqrt(2)})).toEqual({angle:Math.PI*1.25,distance:2})});it("should spline curves",function(){expect(a.splineCurve({x:0,y:0},{x:1,y:1},{x:2,y:0},0)).toEqual({previous:{x:1,y:1,},next:{x:1,y:1,}});expect(a.splineCurve({x:0,y:0},{x:1,y:1},{x:2,y:0},1)).toEqual({previous:{x:0,y:1,},next:{x:2,y:1,}})});it("should get the next or previous item in an array",function(){var b=[0,1,2];expect(a.nextItem(b,0,false)).toEqual(1);expect(a.nextItem(b,2,false)).toEqual(2);expect(a.nextItem(b,2,true)).toEqual(0);expect(a.nextItem(b,1,true)).toEqual(2);expect(a.nextItem(b,-1,false)).toEqual(0);expect(a.previousItem(b,0,false)).toEqual(0);expect(a.previousItem(b,0,true)).toEqual(2);expect(a.previousItem(b,2,false)).toEqual(1);expect(a.previousItem(b,1,true)).toEqual(0)});it("should clear a canvas",function(){var b=window.createMockContext();a.clear({width:100,height:150,ctx:b});expect(b.getCalls()).toEqual([{name:"clearRect",args:[0,0,100,150]}])});it("should draw a rounded rectangle",function(){var b=window.createMockContext();a.drawRoundedRectangle(b,10,20,30,40,5);expect(b.getCalls()).toEqual([{name:"beginPath",args:[]},{name:"moveTo",args:[15,20]},{name:"lineTo",args:[35,20]},{name:"quadraticCurveTo",args:[40,20,40,25]},{name:"lineTo",args:[40,55]},{name:"quadraticCurveTo",args:[40,60,35,60]},{name:"lineTo",args:[15,60]},{name:"quadraticCurveTo",args:[10,60,10,55]},{name:"lineTo",args:[10,25]},{name:"quadraticCurveTo",args:[10,20,15,20]},{name:"closePath",args:[]}])});it("should get the maximum width and height for a node",function(){var c=document.createElement("div");c.style.width="200px";c.style.height="300px";document.body.appendChild(c);var b=document.createElement("div");c.appendChild(b);expect(a.getMaximumWidth(b)).toBe(200);expect(a.getMaximumHeight(b)).toBe(300);document.body.removeChild(c)});it("should get the maximum width of a node that has a max-width style",function(){var c=document.createElement("div");c.style.width="200px";c.style.height="300px";document.body.appendChild(c);var b=document.createElement("div");b.style.maxWidth="150px";c.appendChild(b);expect(a.getMaximumWidth(b)).toBe(150);document.body.removeChild(c)});it("should get the maximum height of a node that has a max-height style",function(){var c=document.createElement("div");c.style.width="200px";c.style.height="300px";document.body.appendChild(c);var b=document.createElement("div");b.style.maxHeight="150px";c.appendChild(b);expect(a.getMaximumHeight(b)).toBe(150);document.body.removeChild(c)});it("should get the maximum width of a node when the parent has a max-width style",function(){var d=document.createElement("div");d.style.width="200px";d.style.height="300px";document.body.appendChild(d);var c=document.createElement("div");c.style.maxWidth="150px";d.appendChild(c);var b=document.createElement("div");c.appendChild(b);expect(a.getMaximumWidth(b)).toBe(150);document.body.removeChild(d)});it("should get the maximum height of a node when the parent has a max-height style",function(){var d=document.createElement("div");d.style.width="200px";d.style.height="300px";document.body.appendChild(d);var c=document.createElement("div");c.style.maxHeight="150px";d.appendChild(c);var b=document.createElement("div");b.style.height="300px";c.appendChild(b);expect(a.getMaximumHeight(b)).toBe(150);document.body.removeChild(d)});it("should get the maximum width of a node that has a percentage max-width style",function(){var c=document.createElement("div");c.style.width="200px";c.style.height="300px";document.body.appendChild(c);var b=document.createElement("div");b.style.maxWidth="50%";c.appendChild(b);expect(a.getMaximumWidth(b)).toBe(100);document.body.removeChild(c)});it("should get the maximum height of a node that has a percentage max-height style",function(){var c=document.createElement("div");c.style.width="200px";c.style.height="300px";document.body.appendChild(c);var b=document.createElement("div");b.style.maxHeight="50%";c.appendChild(b);expect(a.getMaximumHeight(b)).toBe(150);document.body.removeChild(c)});it("should get the maximum width of a node when the parent has a percentage max-width style",function(){var d=document.createElement("div");d.style.width="200px";d.style.height="300px";document.body.appendChild(d);var c=document.createElement("div");c.style.maxWidth="50%";d.appendChild(c);var b=document.createElement("div");c.appendChild(b);expect(a.getMaximumWidth(b)).toBe(100);document.body.removeChild(d)});it("should get the maximum height of a node when the parent has a percentage max-height style",function(){var d=document.createElement("div");d.style.width="200px";d.style.height="300px";document.body.appendChild(d);var c=document.createElement("div");c.style.maxHeight="50%";d.appendChild(c);var b=document.createElement("div");b.style.height="300px";c.appendChild(b);expect(a.getMaximumHeight(b)).toBe(150);document.body.removeChild(d)});describe("Color helper",function(){function b(c){return typeof c==="object"&&c.hasOwnProperty("values")&&c.values.hasOwnProperty("rgb")}it("should return a color when called with a color",function(){expect(b(a.color("rgb(1, 2, 3)"))).toBe(true)});it("should return a color when called with a CanvasGradient instance",function(){var c=document.createElement("canvas").getContext("2d");var d=c.createLinearGradient(0,1,2,3);expect(b(a.color(d))).toBe(true)})});describe("Background hover color helper",function(){it("should return a CanvasPattern when called with a CanvasPattern",function(b){var c=new Image();c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAMAAAAolt3jAAAAD1BMVEUAAAD///////////////+PQt5oAAAABXRSTlMAHlFhZsfk/BEAAAAqSURBVHgBY2BgZGJmYmSAAUYWEIDzmcBcJhiXGcxlRpPFrhdmMiqgvX0AcGIBEUAo6UAAAAAASUVORK5CYII=";c.onload=function(){var h=document.createElement("canvas").getContext("2d");var f=document.createElement("canvas");var g=f.getContext("2d");var e=g.createPattern(c,"repeat");g.fillStyle=e;var d=a.getHoverColor(h.createPattern(f,"repeat"));expect(d instanceof CanvasPattern).toBe(true);b()}});it("should return a modified version of color when called with a color",function(){var b="rgb(70, 191, 189)";expect(a.getHoverColor("#46BFBD")).not.toEqual(b)})})});