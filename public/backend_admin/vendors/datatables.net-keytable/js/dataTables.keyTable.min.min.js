(function(b){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(a){return b(a,window,document)})}else{if(typeof exports==="object"){module.exports=function(a,d){if(!a){a=window}if(!d||!d.fn.dataTable){d=require("datatables.net")(a,d).$}return b(d,a,a.document)}}else{b(jQuery,window,document)}}}(function(k,g,h,i){var l=k.fn.dataTable;var j=function(a,b){if(!l.versionCheck||!l.versionCheck("1.10.8")){throw"KeyTable requires DataTables 1.10.8 or newer"}this.c=k.extend(true,{},l.defaults.keyTable,j.defaults,b);this.s={dt:new l.Api(a),enable:true,focusDraw:false};this.dom={};var c=this.s.dt.settings()[0];var d=c.keytable;if(d){return d}c.keytable=this;this._constructor()};k.extend(j.prototype,{blur:function(){this._blur()},enable:function(a){this.s.enable=a},focus:function(a,b){this._focus(this.s.dt.cell(a,b))},focused:function(c){var a=this.s.lastFocus;if(!a){return false}var b=this.s.lastFocus.index();return c.row===b.row&&c.column===b.column},_constructor:function(){this._tabInput();var b=this;var c=this.s.dt;var d=k(c.table().node());if(d.css("position")==="static"){d.css("position","relative")}k(c.table().body()).on("click.keyTable","th, td",function(){if(b.s.enable===false){return}var e=c.cell(this);if(!e.any()){return}b._focus(e,null,false)});k(h).on("keydown.keyTable",function(e){b._key(e)});if(this.c.blurable){k(h).on("click.keyTable",function(e){if(k(e.target).parents(".dataTables_filter").length){b._blur()}if(k(e.target).parents().filter(c.table().container()).length){return}if(k(e.target).parents("div.DTE").length){return}b._blur()})}if(this.c.editor){c.on("key.keyTable",function(r,e,f,p,q){b._editor(f,q)})}if(c.settings()[0].oFeatures.bStateSave){c.on("stateSaveParams.keyTable",function(f,n,e){e.keyTable=b.s.lastFocus?b.s.lastFocus.index():null})}c.on("xhr.keyTable",function(e){if(b.s.focusDraw){return}var f=b.s.lastFocus;if(f){b.s.lastFocus=null;c.one("draw",function(){b._focus(f)})}});c.on("destroy.keyTable",function(){c.off(".keyTable");k(c.table().body()).off("click.keyTable","th, td");k(h.body).off("keydown.keyTable").off("click.keyTable")});var a=c.state.loaded();if(a&&a.keyTable){c.one("init",function(){var e=c.cell(a.keyTable);if(e.any()){e.focus()}})}else{if(this.c.focus){c.cell(this.c.focus).focus()}}},_blur:function(){if(!this.s.enable||!this.s.lastFocus){return}var a=this.s.lastFocus;k(a.node()).removeClass(this.c.className);this.s.lastFocus=null;this._emitEvent("key-blur",[this.s.dt,a])},_columns:function(){var a=this.s.dt;var c=a.columns(this.c.columns).indexes();var b=[];a.columns(":visible").every(function(d){if(c.indexOf(d)!==-1){b.push(d)}});return b},_editor:function(d,a){var b=this.s.dt;var c=this.c.editor;a.stopPropagation();if(d===13){a.preventDefault()}c.inline(this.s.lastFocus.index());var e=k("div.DTE input, div.DTE textarea");if(e.length){e[0].select()}b.keys.enable("navigation-only");b.one("key-blur.editor",function(){if(c.displayed()){c.submit()}});c.one("close",function(){b.keys.enable(true);b.off("key-blur.editor")})},_emitEvent:function(a,b){this.s.dt.iterator("table",function(d,c){k(d.nTable).triggerHandler(a,b)})},_focus:function(a,u,w){var t=this;var x=this.s.dt;var c=x.page.info();var b=this.s.lastFocus;if(!this.s.enable){return}if(typeof a!=="number"){var s=a.index();u=s.column;a=x.rows({filter:"applied",order:"applied"}).indexes().indexOf(s.row);if(c.serverSide){a+=c.start}}if(c.length!==-1&&(a<c.start||a>=c.start+c.length)){this.s.focusDraw=true;x.one("draw",function(){t.s.focusDraw=false;t._focus(a,u)}).page(Math.floor(a/c.length)).draw(false);return}if(k.inArray(u,this._columns())===-1){return}if(c.serverSide){a-=c.start}var d=x.cell(":eq("+a+")",u,{search:"applied"});if(b){if(b.node()===d.node()){return}this._blur()}var v=k(d.node());v.addClass(this.c.className);if(w===i||w===true){this._scroll(k(g),k(h.body),v,"offset");var e=x.table().body().parentNode;if(e!==x.table().header().parentNode){var f=k(e.parentNode);this._scroll(f,f,v,"position")}}this.s.lastFocus=d;this._emitEvent("key-focus",[this.s.dt,d]);x.state.save()},_key:function(a){if(!this.s.enable){return}if(a.keyCode===0||a.ctrlKey||a.metaKey||a.altKey){return}var f=this.s.lastFocus;if(!f){return}var b=this;var c=this.s.dt;if(this.c.keys&&k.inArray(a.keyCode,this.c.keys)===-1){return}switch(a.keyCode){case 9:this._shift(a,a.shiftKey?"left":"right",true);break;case 27:if(this.s.blurable&&this.s.enable===true){this._blur()}break;case 33:case 34:a.preventDefault();var d=c.cells({page:"current"}).nodes().indexOf(f.node());c.one("draw",function(){var n=c.cells({page:"current"}).nodes();b._focus(c.cell(d<n.length?n[d]:n[n.length-1]))}).page(a.keyCode===33?"previous":"next").draw(false);break;case 35:case 36:a.preventDefault();var e=c.cells({page:"current"}).indexes();this._focus(c.cell(e[a.keyCode===35?e.length-1:0]));break;case 37:this._shift(a,"left");break;case 38:this._shift(a,"up");break;case 39:this._shift(a,"right");break;case 40:this._shift(a,"down");break;default:if(this.s.enable===true){this._emitEvent("key",[c,a.keyCode,this.s.lastFocus,a])}break}},_scroll:function(v,f,d,b){var r=d[b]();var c=d.outerHeight();var u=d.outerWidth();var t=f.scrollTop();var s=f.scrollLeft();var a=v.height();var e=v.width();if(r.top<t){f.scrollTop(r.top)}if(r.left<s){f.scrollLeft(r.left)}if(r.top+c>t+a&&c<a){f.scrollTop(r.top+c-a)}if(r.left+u>s+e&&u<e){f.scrollLeft(r.left+u-e)}},_shift:function(t,d,f){var u=this;var y=this.s.dt;var c=y.page.info();var z=c.recordsDisplay;var e=this.s.lastFocus;var v=this._columns();if(!e){return}var a=y.rows({filter:"applied",order:"applied"}).indexes().indexOf(e.index().row);if(c.serverSide){a+=c.start}var x=y.columns(v).indexes().indexOf(e.index().column);var b=a,w=v[x];if(d==="right"){if(x>=v.length-1){b++;w=v[0]}else{w=v[x+1]}}else{if(d==="left"){if(x===0){b--;w=v[v.length-1]}else{w=v[x-1]}}else{if(d==="up"){b--}else{if(d==="down"){b++}}}}if(b>=0&&b<z&&k.inArray(w,v)!==-1){t.preventDefault();this._focus(b,w)}else{if(!f||!this.c.blurable){t.preventDefault()}else{this._blur()}}},_tabInput:function(){var b=this;var c=this.s.dt;var d=this.c.tabIndex!==null?this.c.tabIndex:c.settings()[0].iTabIndex;if(d==-1){return}var a=k('<div><input type="text" tabindex="'+d+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(c.table().node());a.children().on("focus",function(){b._focus(c.cell(":eq(0)","0:visible",{page:"current"}))})}});j.defaults={blurable:true,className:"focus",columns:"",editor:null,focus:null,keys:null,tabIndex:null};j.version="2.1.2";k.fn.dataTable.KeyTable=j;k.fn.DataTable.KeyTable=j;l.Api.register("cell.blur()",function(){return this.iterator("table",function(a){if(a.keytable){a.keytable.blur()}})});l.Api.register("cell().focus()",function(){return this.iterator("cell",function(c,a,b){if(c.keytable){c.keytable.focus(a,b)}})});l.Api.register("keys.disable()",function(){return this.iterator("table",function(a){if(a.keytable){a.keytable.enable(false)}})});l.Api.register("keys.enable()",function(a){return this.iterator("table",function(b){if(b.keytable){b.keytable.enable(a===i?true:a)}})});l.ext.selector.cell.push(function(b,a,d){var q=a.focused;var p=b.keytable;var e=[];if(!p||q===i){return d}for(var c=0,f=d.length;c<f;c++){if((q===true&&p.focused(d[c]))||(q===false&&!p.focused(d[c]))){e.push(d[c])}}return e});k(h).on("preInit.dt.dtk",function(b,e,f){if(b.namespace!=="dt"){return}var a=e.oInit.keys;var c=l.defaults.keys;if(a||c){var d=k.extend({},a,c);if(a!==false){new j(e,d)}}});return j}));