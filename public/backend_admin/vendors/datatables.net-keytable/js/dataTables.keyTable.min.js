/* KeyTable 2.1.2
 * Â©2009-2016 SpryMedia Ltd - datatables.net/license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(b){return a(b,window,document)})}else{if(typeof exports==="object"){module.exports=function(b,c){if(!b){b=window}if(!c||!c.fn.dataTable){c=require("datatables.net")(b,c).$}return a(c,b,b.document)}}else{a(jQuery,window,document)}}}(function(d,b,a,f){var c=d.fn.dataTable;var e=function(j,i){if(!c.versionCheck||!c.versionCheck("1.10.8")){throw"KeyTable requires DataTables 1.10.8 or newer"}this.c=d.extend(true,{},c.defaults.keyTable,e.defaults,i);this.s={dt:new c.Api(j),enable:true,focusDraw:false};this.dom={};var h=this.s.dt.settings()[0];var g=h.keytable;if(g){return g}h.keytable=this;this._constructor()};d.extend(e.prototype,{blur:function(){this._blur()},enable:function(g){this.s.enable=g},focus:function(h,g){this._focus(this.s.dt.cell(h,g))},focused:function(g){var i=this.s.lastFocus;if(!i){return false}var h=this.s.lastFocus.index();return g.row===h.row&&g.column===h.column},_constructor:function(){this._tabInput();var i=this;var h=this.s.dt;var g=d(h.table().node());if(g.css("position")==="static"){g.css("position","relative")}d(h.table().body()).on("click.keyTable","th, td",function(){if(i.s.enable===false){return}var k=h.cell(this);if(!k.any()){return}i._focus(k,null,false)});d(a).on("keydown.keyTable",function(k){i._key(k)});if(this.c.blurable){d(a).on("click.keyTable",function(k){if(d(k.target).parents(".dataTables_filter").length){i._blur()}if(d(k.target).parents().filter(h.table().container()).length){return}if(d(k.target).parents("div.DTE").length){return}i._blur()})}if(this.c.editor){h.on("key.keyTable",function(n,m,l,k,o){i._editor(l,o)})}if(h.settings()[0].oFeatures.bStateSave){h.on("stateSaveParams.keyTable",function(l,k,m){m.keyTable=i.s.lastFocus?i.s.lastFocus.index():null})}h.on("xhr.keyTable",function(l){if(i.s.focusDraw){return}var k=i.s.lastFocus;if(k){i.s.lastFocus=null;h.one("draw",function(){i._focus(k)})}});h.on("destroy.keyTable",function(){h.off(".keyTable");d(h.table().body()).off("click.keyTable","th, td");d(a.body).off("keydown.keyTable").off("click.keyTable")});var j=h.state.loaded();if(j&&j.keyTable){h.one("init",function(){var k=h.cell(j.keyTable);if(k.any()){k.focus()}})}else{if(this.c.focus){h.cell(this.c.focus).focus()}}},_blur:function(){if(!this.s.enable||!this.s.lastFocus){return}var g=this.s.lastFocus;d(g.node()).removeClass(this.c.className);this.s.lastFocus=null;this._emitEvent("key-blur",[this.s.dt,g])},_columns:function(){var i=this.s.dt;var g=i.columns(this.c.columns).indexes();var h=[];i.columns(":visible").every(function(j){if(g.indexOf(j)!==-1){h.push(j)}});return h},_editor:function(h,k){var j=this.s.dt;var i=this.c.editor;k.stopPropagation();if(h===13){k.preventDefault()}i.inline(this.s.lastFocus.index());var g=d("div.DTE input, div.DTE textarea");if(g.length){g[0].select()}j.keys.enable("navigation-only");j.one("key-blur.editor",function(){if(i.displayed()){i.submit()}});i.one("close",function(){j.keys.enable(true);j.off("key-blur.editor")})},_emitEvent:function(h,g){this.s.dt.iterator("table",function(j,k){d(j.nTable).triggerHandler(h,g)})},_focus:function(r,j,h){var k=this;var g=this.s.dt;var p=g.page.info();var q=this.s.lastFocus;if(!this.s.enable){return}if(typeof r!=="number"){var l=r.index();j=l.column;r=g.rows({filter:"applied",order:"applied"}).indexes().indexOf(l.row);if(p.serverSide){r+=p.start}}if(p.length!==-1&&(r<p.start||r>=p.start+p.length)){this.s.focusDraw=true;g.one("draw",function(){k.s.focusDraw=false;k._focus(r,j)}).page(Math.floor(r/p.length)).draw(false);return}if(d.inArray(j,this._columns())===-1){return}if(p.serverSide){r-=p.start}var o=g.cell(":eq("+r+")",j,{search:"applied"});if(q){if(q.node()===o.node()){return}this._blur()}var i=d(o.node());i.addClass(this.c.className);if(h===f||h===true){this._scroll(d(b),d(a.body),i,"offset");var n=g.table().body().parentNode;if(n!==g.table().header().parentNode){var m=d(n.parentNode);this._scroll(m,m,i,"position")}}this.s.lastFocus=o;this._emitEvent("key-focus",[this.s.dt,o]);g.state.save()},_key:function(l){if(!this.s.enable){return}if(l.keyCode===0||l.ctrlKey||l.metaKey||l.altKey){return}var g=this.s.lastFocus;if(!g){return}var k=this;var j=this.s.dt;if(this.c.keys&&d.inArray(l.keyCode,this.c.keys)===-1){return}switch(l.keyCode){case 9:this._shift(l,l.shiftKey?"left":"right",true);break;case 27:if(this.s.blurable&&this.s.enable===true){this._blur()}break;case 33:case 34:l.preventDefault();var i=j.cells({page:"current"}).nodes().indexOf(g.node());j.one("draw",function(){var m=j.cells({page:"current"}).nodes();k._focus(j.cell(i<m.length?m[i]:m[m.length-1]))}).page(l.keyCode===33?"previous":"next").draw(false);break;case 35:case 36:l.preventDefault();var h=j.cells({page:"current"}).indexes();this._focus(j.cell(h[l.keyCode===35?h.length-1:0]));break;case 37:this._shift(l,"left");break;case 38:this._shift(l,"up");break;case 39:this._shift(l,"right");break;case 40:this._shift(l,"down");break;default:if(this.s.enable===true){this._emitEvent("key",[j,l.keyCode,this.s.lastFocus,l])}break}},_scroll:function(g,l,n,p){var k=n[p]();var o=n.outerHeight();var h=n.outerWidth();var i=l.scrollTop();var j=l.scrollLeft();var q=g.height();var m=g.width();if(k.top<i){l.scrollTop(k.top)}if(k.left<j){l.scrollLeft(k.left)}if(k.top+o>i+q&&o<q){l.scrollTop(k.top+o-q)}if(k.left+h>j+m&&h<m){l.scrollLeft(k.left+h-m)}},_shift:function(l,o,m){var k=this;var g=this.s.dt;var p=g.page.info();var s=p.recordsDisplay;var n=this.s.lastFocus;var j=this._columns();if(!n){return}var r=g.rows({filter:"applied",order:"applied"}).indexes().indexOf(n.index().row);if(p.serverSide){r+=p.start}var h=g.columns(j).indexes().indexOf(n.index().column);var q=r,i=j[h];if(o==="right"){if(h>=j.length-1){q++;i=j[0]}else{i=j[h+1]}}else{if(o==="left"){if(h===0){q--;i=j[j.length-1]}else{i=j[h-1]}}else{if(o==="up"){q--}else{if(o==="down"){q++}}}}if(q>=0&&q<s&&d.inArray(i,j)!==-1){l.preventDefault();this._focus(q,i)}else{if(!m||!this.c.blurable){l.preventDefault()}else{this._blur()}}},_tabInput:function(){var i=this;var h=this.s.dt;var g=this.c.tabIndex!==null?this.c.tabIndex:h.settings()[0].iTabIndex;if(g==-1){return}var j=d('<div><input type="text" tabindex="'+g+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(h.table().node());j.children().on("focus",function(){i._focus(h.cell(":eq(0)","0:visible",{page:"current"}))})}});e.defaults={blurable:true,className:"focus",columns:"",editor:null,focus:null,keys:null,tabIndex:null};e.version="2.1.2";d.fn.dataTable.KeyTable=e;d.fn.DataTable.KeyTable=e;c.Api.register("cell.blur()",function(){return this.iterator("table",function(g){if(g.keytable){g.keytable.blur()}})});c.Api.register("cell().focus()",function(){return this.iterator("cell",function(g,i,h){if(g.keytable){g.keytable.focus(i,h)}})});c.Api.register("keys.disable()",function(){return this.iterator("table",function(g){if(g.keytable){g.keytable.enable(false)}})});c.Api.register("keys.enable()",function(g){return this.iterator("table",function(h){if(h.keytable){h.keytable.enable(g===f?true:g)}})});c.ext.selector.cell.push(function(l,m,j){var n=m.focused;var o=l.keytable;var h=[];if(!o||n===f){return j}for(var k=0,g=j.length;k<g;k++){if((n===true&&o.focused(j[k]))||(n===false&&!o.focused(j[k]))){h.push(j[k])}}return h});d(a).on("preInit.dt.dtk",function(k,h,g){if(k.namespace!=="dt"){return}var l=h.oInit.keys;var j=c.defaults.keys;if(l||j){var i=d.extend({},l,j);if(l!==false){new e(h,i)}}});return e}));