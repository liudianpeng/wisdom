/* Buttons for DataTables 1.2.1
 * Â©2016 SpryMedia Ltd - datatables.net/license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(b){return a(b,window,document)})}else{if(typeof exports==="object"){module.exports=function(b,c){if(!b){b=window}if(!c||!c.fn.dataTable){c=require("datatables.net")(b,c).$}return a(c,b,b.document)}}else{a(jQuery,window,document)}}}(function(e,h,j,b){var d=e.fn.dataTable;var f=0;var i=0;var k=d.ext.buttons;var a=function(n,m){if(m===true){m={}}if(e.isArray(m)){m={buttons:m}}this.c=e.extend(true,{},a.defaults,m);if(m.buttons){this.c.buttons=m.buttons}this.s={dt:new d.Api(n),buttons:[],listenKeys:"",namespace:"dtb"+(f++)};this.dom={container:e("<"+this.c.dom.container.tag+"/>").addClass(this.c.dom.container.className)};this._constructor()};e.extend(a.prototype,{action:function(n,o){var m=this._nodeToButton(n);if(o===b){return m.conf.action}m.conf.action=o;return this},active:function(q,n){var o=this._nodeToButton(q);var m=this.c.dom.button.active;var p=e(o.node);if(n===b){return p.hasClass(m)}p.toggleClass(m,n===b?true:n);return this},add:function(o,m){var r=this.s.buttons;if(typeof m==="string"){var q=m.split("-");var s=this.s;for(var p=0,n=q.length-1;p<n;p++){s=s.buttons[q[p]*1]}r=s.buttons;m=q[q.length-1]*1}this._expandButton(r,o,false,m);this._draw();return this},container:function(){return this.dom.container},disable:function(n){var m=this._nodeToButton(n);e(m.node).addClass(this.c.dom.button.disabled);return this},destroy:function(){e("body").off("keyup."+this.s.namespace);var p=this.s.buttons.slice();var n,m;for(n=0,m=p.length;n<m;n++){this.remove(p[n].node)}this.dom.container.remove();var o=this.s.dt.settings()[0];for(n=0,m=o.length;n<m;n++){if(o.inst===this){o.splice(n,1);break}}return this},enable:function(o,m){if(m===false){return this.disable(o)}var n=this._nodeToButton(o);e(n.node).removeClass(this.c.dom.button.disabled);return this},name:function(){return this.c.name},node:function(n){var m=this._nodeToButton(n);return e(m.node)},remove:function(r){var o=this._nodeToButton(r);var q=this._nodeToHost(r);var p=this.s.dt;if(o.buttons.length){for(var n=o.buttons.length-1;n>=0;n--){this.remove(o.buttons[n].node)}}if(o.conf.destroy){o.conf.destroy.call(p.button(r),p,e(r),o.conf)}this._removeKey(o.conf);e(o.node).remove();var m=e.inArray(o,q);q.splice(m,1);return this},text:function(r,n){var o=this._nodeToButton(r);var s=this.c.dom.collection.buttonLiner;var m=o.inCollection&&s&&s.tag?s.tag:this.c.dom.buttonLiner.tag;var q=this.s.dt;var p=e(o.node);var t=function(u){return typeof u==="function"?u(q,p,o.conf):u};if(n===b){return t(o.conf.text)}o.conf.text=n;if(m){p.children(m).html(t(n))}else{p.html(t(n))}return this},_constructor:function(){var q=this;var p=this.s.dt;var r=p.settings()[0];var o=this.c.buttons;if(!r._buttons){r._buttons=[]}r._buttons.push({inst:this,name:this.c.name});for(var n=0,m=o.length;n<m;n++){this.add(o[n])}p.on("destroy",function(){q.destroy()});e("body").on("keyup."+this.s.namespace,function(t){if(!j.activeElement||j.activeElement===j.body){var s=String.fromCharCode(t.keyCode).toLowerCase();if(q.s.listenKeys.toLowerCase().indexOf(s)!==-1){q._keypress(s,t)}}})},_addKey:function(m){if(m.key){this.s.listenKeys+=e.isPlainObject(m.key)?m.key.key:m.key}},_draw:function(n,p){if(!n){n=this.dom.container;p=this.s.buttons}n.children().detach();for(var o=0,m=p.length;o<m;o++){n.append(p[o].inserter);if(p[o].buttons&&p[o].buttons.length){this._draw(p[o].collection,p[o].buttons)}}},_expandButton:function(s,t,u,o){var n=this.s.dt;var q=0;var w=!e.isArray(t)?[t]:t;for(var r=0,x=w.length;r<x;r++){var v=this._resolveExtends(w[r]);if(!v){continue}if(e.isArray(v)){this._expandButton(s,v,u,o);continue}var m=this._buildButton(v,u);if(!m){continue}if(o!==b){s.splice(o,0,m);o++}else{s.push(m)}if(m.conf.buttons){var p=this.c.dom.collection;m.collection=e("<"+p.tag+"/>").addClass(p.className);m.conf._collection=m.collection;this._expandButton(m.buttons,m.conf.buttons,true,o)}if(v.init){v.init.call(n.button(m.node),n,e(m.node),v)}q++}},_buildButton:function(q,u){var n=this.c.dom.button;var p=this.c.dom.buttonLiner;var r=this.c.dom.collection;var o=this.s.dt;var w=function(y){return typeof y==="function"?y(o,t,q):y};if(u&&r.button){n=r.button}if(u&&r.buttonLiner){p=r.buttonLiner}if(q.available&&!q.available(o,q)){return false}var s=function(B,A,z,y){y.action.call(A.button(z),B,A,z,y);e(A.table().node()).triggerHandler("buttons-action.dt",[A.button(z),A,z,y])};var t=e("<"+n.tag+"/>").addClass(n.className).attr("tabindex",this.s.dt.settings()[0].iTabIndex).attr("aria-controls",this.s.dt.table().node().id).on("click.dtb",function(y){y.preventDefault();if(!t.hasClass(n.disabled)&&q.action){s(y,o,t,q)}t.blur()}).on("keyup.dtb",function(y){if(y.keyCode===13){if(!t.hasClass(n.disabled)&&q.action){s(y,o,t,q)}}});if(n.tag.toLowerCase()==="a"){t.attr("href","#")}if(p.tag){var m=e("<"+p.tag+"/>").html(w(q.text)).addClass(p.className);if(p.tag.toLowerCase()==="a"){m.attr("href","#")}t.append(m)}else{t.html(w(q.text))}if(q.enabled===false){t.addClass(n.disabled)}if(q.className){t.addClass(q.className)}if(q.titleAttr){t.attr("title",q.titleAttr)}if(!q.namespace){q.namespace=".dt-button-"+(i++)}var x=this.c.dom.buttonContainer;var v;if(x&&x.tag){v=e("<"+x.tag+"/>").addClass(x.className).append(t)}else{v=t}this._addKey(q);return{conf:q,node:t.get(0),inserter:v,buttons:[],inCollection:u,collection:null}},_nodeToButton:function(q,p){if(!p){p=this.s.buttons}for(var o=0,m=p.length;o<m;o++){if(p[o].node===q){return p[o]}if(p[o].buttons.length){var n=this._nodeToButton(q,p[o].buttons);if(n){return n}}}},_nodeToHost:function(q,p){if(!p){p=this.s.buttons}for(var o=0,m=p.length;o<m;o++){if(p[o].node===q){return p}if(p[o].buttons.length){var n=this._nodeToHost(q,p[o].buttons);if(n){return n}}}},_keypress:function(n,p){var o=function(q,r){if(!q.key){return}if(q.key===n){e(r).click()}else{if(e.isPlainObject(q.key)){if(q.key.key!==n){return}if(q.key.shiftKey&&!p.shiftKey){return}if(q.key.altKey&&!p.altKey){return}if(q.key.ctrlKey&&!p.ctrlKey){return}if(q.key.metaKey&&!p.metaKey){return}e(r).click()}}};var m=function(r){for(var s=0,q=r.length;s<q;s++){o(r[s].conf,r[s].node);if(r[s].buttons.length){m(r[s].buttons)}}};m(this.s.buttons)},_removeKey:function(o){if(o.key){var p=e.isPlainObject(o.key)?o.key.key:o.key;var n=this.s.listenKeys.split("");var m=e.inArray(p,n);n.splice(m,1);this.s.listenKeys=n.join("")}},_resolveExtends:function(s){var n=this.s.dt;var r,u;var q=function(w){var v=0;while(!e.isPlainObject(w)&&!e.isArray(w)){if(w===b){return}if(typeof w==="function"){w=w(n,s);if(!w){return false}}else{if(typeof w==="string"){if(!k[w]){throw"Unknown button type: "+w}w=k[w]}}v++;if(v>30){throw"Buttons: Too many iterations"}}return e.isArray(w)?w:e.extend({},w)};s=q(s);while(s&&s.extend){if(!k[s.extend]){throw"Cannot extend unknown button type: "+s.extend}var o=q(k[s.extend]);if(e.isArray(o)){return o}else{if(!o){return false}}var t=o.className;s=e.extend({},o,s);if(t&&s.className!==t){s.className=t+" "+s.className}var p=s.postfixButtons;if(p){if(!s.buttons){s.buttons=[]}for(r=0,u=p.length;r<u;r++){s.buttons.push(p[r])}s.postfixButtons=null}var m=s.prefixButtons;if(m){if(!s.buttons){s.buttons=[]}for(r=0,u=m.length;r<u;r++){s.buttons.splice(r,0,m[r])}s.prefixButtons=null}s.extend=o.extend}return s}});a.background=function(m,n,o){if(o===b){o=400}if(m){e("<div/>").addClass(n).css("display","none").appendTo("body").fadeIn(o)}else{e("body > div."+n).fadeOut(o,function(){e(this).remove()})}};a.instanceSelector=function(q,n){if(!q){return e.map(n,function(r){return r.inst})}var m=[];var p=e.map(n,function(r){return r.name});var o=function(t){if(e.isArray(t)){for(var u=0,s=t.length;u<s;u++){o(t[u])}return}if(typeof t==="string"){if(t.indexOf(",")!==-1){o(t.split(","))}else{var r=e.inArray(e.trim(t),p);if(r!==-1){m.push(n[r].inst)}}}else{if(typeof t==="number"){m.push(n[t].inst)}}};o(q);return m};a.buttonSelector=function(n,m){var p=[];var t=function(w,A,x){var z;var u;for(var y=0,v=A.length;y<v;y++){z=A[y];if(z){u=x!==b?x+y:y+"";w.push({node:z.node,name:z.conf.name,idx:u});if(z.buttons){t(w,z.buttons,u+"-")}}}};var s=function(w,y){var x,D;var A=[];t(A,y.s.buttons);var v=e.map(A,function(E){return E.node});if(e.isArray(w)||w instanceof e){for(x=0,D=w.length;x<D;x++){s(w[x],y)}return}if(w===null||w===b||w==="*"){for(x=0,D=A.length;x<D;x++){p.push({inst:y,node:A[x].node})}}else{if(typeof w==="number"){p.push({inst:y,node:y.s.buttons[w].node})}else{if(typeof w==="string"){if(w.indexOf(",")!==-1){var B=w.split(",");for(x=0,D=B.length;x<D;x++){s(e.trim(B[x]),y)}}else{if(w.match(/^\d+(\-\d+)*$/)){var z=e.map(A,function(E){return E.idx});p.push({inst:y,node:A[e.inArray(w,z)].node})}else{if(w.indexOf(":name")!==-1){var u=w.replace(":name","");for(x=0,D=A.length;x<D;x++){if(A[x].name===u){p.push({inst:y,node:A[x].node})}}}else{e(v).filter(w).each(function(){p.push({inst:y,node:this})})}}}}else{if(typeof w==="object"&&w.nodeName){var C=e.inArray(w,v);if(C!==-1){p.push({inst:y,node:v[C]})}}}}}};for(var q=0,o=n.length;q<o;q++){var r=n[q];s(m,r)}return p};a.defaults={buttons:["copy","excel","csv","pdf","print"],name:"main",tabIndex:0,dom:{container:{tag:"div",className:"dt-buttons"},collection:{tag:"div",className:"dt-button-collection"},button:{tag:"a",className:"dt-button",active:"active",disabled:"disabled"},buttonLiner:{tag:"span",className:""}}};a.version="1.2.1";e.extend(k,{collection:{text:function(m){return m.i18n("buttons.collection","Collection")},className:"buttons-collection",action:function(s,m,q,n){var w=q;var t=w.offset();var v=e(m.table().container());var x=false;if(e("div.dt-button-background").length){x=e("div.dt-button-collection").offset();e("body").trigger("click.dtb-collection")}n._collection.addClass(n.collectionLayout).css("display","none").appendTo("body").fadeIn(n.fade);var p=n._collection.css("position");if(x&&p==="absolute"){n._collection.css({top:x.top+5,left:x.left+5})}else{if(p==="absolute"){n._collection.css({top:t.top+w.outerHeight(),left:t.left});var r=t.left+n._collection.outerWidth();var o=v.offset().left+v.width();if(r>o){n._collection.css("left",t.left-(r-o))}}else{var u=n._collection.height()/2;if(u>e(h).height()/2){u=e(h).height()/2}n._collection.css("marginTop",u*-1)}}if(n.background){a.background(true,n.backgroundClassName,n.fade)}setTimeout(function(){e("div.dt-button-background").on("click.dtb-collection",function(){});e("body").on("click.dtb-collection",function(y){if(!e(y.target).parents().andSelf().filter(n._collection).length){n._collection.fadeOut(n.fade,function(){n._collection.detach()});e("div.dt-button-background").off("click.dtb-collection");a.background(false,n.backgroundClassName,n.fade);e("body").off("click.dtb-collection");m.off("buttons-action.b-internal")}})},10);if(n.autoClose){m.on("buttons-action.b-internal",function(){e("div.dt-button-background").click()})}},background:true,collectionLayout:"",backgroundClassName:"dt-button-background",autoClose:false,fade:400},copy:function(n,m){if(k.copyHtml5){return"copyHtml5"}if(k.copyFlash&&k.copyFlash.available(n,m)){return"copyFlash"}},csv:function(n,m){if(k.csvHtml5&&k.csvHtml5.available(n,m)){return"csvHtml5"}if(k.csvFlash&&k.csvFlash.available(n,m)){return"csvFlash"}},excel:function(n,m){if(k.excelHtml5&&k.excelHtml5.available(n,m)){return"excelHtml5"}if(k.excelFlash&&k.excelFlash.available(n,m)){return"excelFlash"}},pdf:function(n,m){if(k.pdfHtml5&&k.pdfHtml5.available(n,m)){return"pdfHtml5"}if(k.pdfFlash&&k.pdfFlash.available(n,m)){return"pdfFlash"}},pageLength:function(n){var m=n.settings()[0].aLengthMenu;var o=e.isArray(m[0])?m[0]:m;var q=e.isArray(m[0])?m[1]:m;var p=function(r){return r.i18n("buttons.pageLength",{"-1":"Show all rows",_:"Show %d rows"},r.page.len())};return{extend:"collection",text:p,className:"buttons-page-length",autoClose:true,buttons:e.map(o,function(s,r){return{text:q[r],action:function(u,t){t.page.len(s).draw()},init:function(x,w,t){var v=this;var u=function(){v.active(x.page.len()===s)};x.on("length.dt"+t.namespace,u);u()},destroy:function(v,u,t){v.off("length.dt"+t.namespace)}}}),init:function(u,t,r){var s=this;u.on("length.dt"+r.namespace,function(){s.text(p(u))})},destroy:function(t,s,r){t.off("length.dt"+r.namespace)}}}});d.Api.register("buttons()",function(n,m){if(m===b){m=n;n=b}return this.iterator(true,"table",function(o){if(o._buttons){return a.buttonSelector(a.instanceSelector(n,o._buttons),m)}},true)});d.Api.register("button()",function(o,m){var n=this.buttons(o,m);if(n.length>1){n.splice(1,n.length)}return n});d.Api.registerPlural("buttons().active()","button().active()",function(m){if(m===b){return this.map(function(n){return n.inst.active(n.node)})}return this.each(function(n){n.inst.active(n.node,m)})});d.Api.registerPlural("buttons().action()","button().action()",function(m){if(m===b){return this.map(function(n){return n.inst.action(n.node)})}return this.each(function(n){n.inst.action(n.node,m)})});d.Api.register(["buttons().enable()","button().enable()"],function(m){return this.each(function(n){n.inst.enable(n.node,m)})});d.Api.register(["buttons().disable()","button().disable()"],function(){return this.each(function(m){m.inst.disable(m.node)})});d.Api.registerPlural("buttons().nodes()","button().node()",function(){var m=e();e(this.each(function(n){m=m.add(n.inst.node(n.node))}));return m});d.Api.registerPlural("buttons().text()","button().text()",function(m){if(m===b){return this.map(function(n){return n.inst.text(n.node)})}return this.each(function(n){n.inst.text(n.node,m)})});d.Api.registerPlural("buttons().trigger()","button().trigger()",function(){return this.each(function(m){m.inst.node(m.node).trigger("click")})});d.Api.registerPlural("buttons().containers()","buttons().container()",function(){var m=e();e(this.each(function(n){m=m.add(n.inst.container())}));return m});d.Api.register("button().add()",function(m,n){if(this.length===1){this[0].inst.add(n,m)}return this.button(m)});d.Api.register("buttons().destroy()",function(){this.pluck("inst").unique().each(function(m){m.destroy()});return this});d.Api.registerPlural("buttons().remove()","buttons().remove()",function(){this.each(function(m){m.inst.remove(m.node)});return this});var l;d.Api.register("buttons.info()",function(p,n,o){var m=this;if(p===false){e("#datatables_buttons_info").fadeOut(function(){e(this).remove()});clearTimeout(l);l=null;return this}if(l){clearTimeout(l)}if(e("#datatables_buttons_info").length){e("#datatables_buttons_info").remove()}p=p?"<h2>"+p+"</h2>":"";e('<div id="datatables_buttons_info" class="dt-button-info"/>').html(p).append(e("<div/>")[typeof n==="string"?"html":"append"](n)).css("display","none").appendTo("body").fadeIn();if(o!==b&&o!==0){l=setTimeout(function(){m.buttons.info(false)},o)}return this});d.Api.register("buttons.exportData()",function(m){if(this.context.length){return c(new d.Api(this.context[0]),m)}});var g=e("<textarea/>")[0];var c=function(o,m){var p=e.extend(true,{},{rows:null,columns:"",modifier:{search:"applied",order:"applied"},orthogonal:"display",stripHtml:true,stripNewlines:true,decodeEntities:true,trim:true,format:{header:function(C){return n(C)},footer:function(C){return n(C)},body:function(C){return n(C)}}},m);var n=function(C){if(typeof C!=="string"){return C}if(p.stripHtml){C=C.replace(/<[^>]*>/g,"")}if(p.trim){C=C.replace(/^\s+|\s+$/g,"")}if(p.stripNewlines){C=C.replace(/\n/g," ")}if(p.decodeEntities){g.innerHTML=C;C=g.value}return C};var u=o.columns(p.columns).indexes().map(function(C){return p.format.header(o.column(C).header().innerHTML,C)}).toArray();var x=o.table().footer()?o.columns(p.columns).indexes().map(function(C){var D=o.column(C).footer();return p.format.footer(D?D.innerHTML:"",C)}).toArray():null;var w=o.rows(p.rows,p.modifier).indexes().toArray();var z=o.cells(w,p.columns).render(p.orthogonal).toArray();var q=u.length;var B=q>0?z.length/q:0;var v=new Array(B);var t=0;for(var s=0,y=B;s<y;s++){var A=new Array(q);for(var r=0;r<q;r++){A[r]=p.format.body(z[t],r,s);t++}v[s]=A}return{header:u,footer:x,body:v}};e.fn.dataTable.Buttons=a;e.fn.DataTable.Buttons=a;e(j).on("init.dt plugin-init.dt",function(o,m){if(o.namespace!=="dt"){return}var n=m.oInit.buttons||d.defaults.buttons;if(n&&!m._buttons){new a(m,n).container()}});d.ext.feature.push({fnInit:function(n){var m=new d.Api(n);var o=m.init().buttons||d.defaults.buttons;return new a(m,o).container()},cFeature:"B"});return a}));