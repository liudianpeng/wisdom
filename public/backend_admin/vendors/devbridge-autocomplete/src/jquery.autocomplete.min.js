(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"&&typeof require==="function"){a(require("jquery"))}else{a(jQuery)}}}(function(d){var a=(function(){return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var f=document.createElement("div");f.className=e;f.style.position="absolute";f.style.display="none";return f}}}()),c={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};function b(f,e){var h=function(){},g=this,i={ajaxSettings:{},autoSelectFirst:false,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:false,onSearchStart:h,onSearchComplete:h,onSearchError:h,preserveInput:false,containerClass:"autocomplete-suggestions",tabDisabled:false,dataType:"text",currentRequest:null,triggerSelectOnValidInput:true,preventBadQueries:true,lookupFilter:function(k,j,l){return k.value.toLowerCase().indexOf(l)!==-1},paramName:"query",transformResult:function(j){return typeof j==="string"?d.parseJSON(j):j},showNoSuggestionNotice:false,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:false};g.element=f;g.el=d(f);g.suggestions=[];g.badQueries=[];g.selectedIndex=-1;g.currentValue=g.element.value;g.intervalId=0;g.cachedResponse={};g.onChangeInterval=null;g.onChange=null;g.isLocal=false;g.suggestionsContainer=null;g.noSuggestionsContainer=null;g.options=d.extend({},i,e);g.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"};g.hint=null;g.hintValue="";g.selection=null;g.initialize();g.setOptions(e)}b.utils=a;d.Autocomplete=b;b.formatResult=function(e,f){var g="("+a.escapeRegExChars(f)+")";return e.value.replace(new RegExp(g,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")};b.prototype={killerFn:null,initialize:function(){var h=this,i="."+h.classes.suggestion,g=h.classes.selected,f=h.options,e;h.element.setAttribute("autocomplete","off");h.killerFn=function(j){if(d(j.target).closest("."+h.options.containerClass).length===0){h.killSuggestions();h.disableKillerFn()}};h.noSuggestionsContainer=d('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0);h.suggestionsContainer=b.utils.createNode(f.containerClass);e=d(h.suggestionsContainer);e.appendTo(f.appendTo);if(f.width!=="auto"){e.width(f.width)}e.on("mouseover.autocomplete",i,function(){h.activate(d(this).data("index"))});e.on("mouseout.autocomplete",function(){h.selectedIndex=-1;e.children("."+g).removeClass(g)});e.on("click.autocomplete",i,function(){h.select(d(this).data("index"))});h.fixPositionCapture=function(){if(h.visible){h.fixPosition()}};d(window).on("resize.autocomplete",h.fixPositionCapture);h.el.on("keydown.autocomplete",function(j){h.onKeyPress(j)});h.el.on("keyup.autocomplete",function(j){h.onKeyUp(j)});h.el.on("blur.autocomplete",function(){h.onBlur()});h.el.on("focus.autocomplete",function(){h.onFocus()});h.el.on("change.autocomplete",function(j){h.onKeyUp(j)});h.el.on("input.autocomplete",function(j){h.onKeyUp(j)})},onFocus:function(){var e=this;e.fixPosition();if(e.options.minChars===0&&e.el.val().length===0){e.onValueChange()}},onBlur:function(){this.enableKillerFn()},abortAjax:function(){var e=this;if(e.currentRequest){e.currentRequest.abort();e.currentRequest=null}},setOptions:function(g){var f=this,e=f.options;d.extend(e,g);f.isLocal=d.isArray(e.lookup);if(f.isLocal){e.lookup=f.verifySuggestionsFormat(e.lookup)}e.orientation=f.validateOrientation(e.orientation,"bottom");d(f.suggestionsContainer).css({"max-height":e.maxHeight+"px",width:e.width+"px","z-index":e.zIndex})},clearCache:function(){this.cachedResponse={};this.badQueries=[]},clear:function(){this.clearCache();this.currentValue="";this.suggestions=[]},disable:function(){var e=this;e.disabled=true;clearInterval(e.onChangeInterval);e.abortAjax()},enable:function(){this.disabled=false},fixPosition:function(){var k=this,o=d(k.suggestionsContainer),m=o.parent().get(0);if(m!==document.body&&!k.options.forceFixPosition){return}var f=k.options.orientation,r=o.outerHeight(),n=k.el.outerHeight(),i=k.el.offset(),p={top:i.top,left:i.left};if(f==="auto"){var h=d(window).height(),g=d(window).scrollTop(),l=-g+i.top-r,q=g+h-(i.top+n+r);f=(Math.max(l,q)===l)?"top":"bottom"}if(f==="top"){p.top+=-r}else{p.top+=n}if(m!==document.body){var j=o.css("opacity"),e;if(!k.visible){o.css("opacity",0).show()}e=o.offsetParent().offset();p.top-=e.top;p.left-=e.left;if(!k.visible){o.css("opacity",j).hide()}}if(k.options.width==="auto"){p.width=(k.el.outerWidth()-2)+"px"}o.css(p)},enableKillerFn:function(){var e=this;d(document).on("click.autocomplete",e.killerFn)},disableKillerFn:function(){var e=this;d(document).off("click.autocomplete",e.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions();e.intervalId=window.setInterval(function(){if(e.visible){e.el.val(e.currentValue);e.hide()}e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var g=this,f=g.el.val().length,h=g.element.selectionStart,e;if(typeof h==="number"){return h===f}if(document.selection){e=document.selection.createRange();e.moveStart("character",-f);return f===e.text.length}return true},onKeyPress:function(g){var f=this;if(!f.disabled&&!f.visible&&g.which===c.DOWN&&f.currentValue){f.suggest();return}if(f.disabled||!f.visible){return}switch(g.which){case c.ESC:f.el.val(f.currentValue);f.hide();break;case c.RIGHT:if(f.hint&&f.options.onHint&&f.isCursorAtEnd()){f.selectHint();break}return;case c.TAB:if(f.hint&&f.options.onHint){f.selectHint();return}if(f.selectedIndex===-1){f.hide();return}f.select(f.selectedIndex);if(f.options.tabDisabled===false){return}break;case c.RETURN:if(f.selectedIndex===-1){f.hide();return}f.select(f.selectedIndex);break;case c.UP:f.moveUp();break;case c.DOWN:f.moveDown();break;default:return}g.stopImmediatePropagation();g.preventDefault()},onKeyUp:function(g){var f=this;if(f.disabled){return}switch(g.which){case c.UP:case c.DOWN:return}clearInterval(f.onChangeInterval);if(f.currentValue!==f.el.val()){f.findBestHint();if(f.options.deferRequestBy>0){f.onChangeInterval=setInterval(function(){f.onValueChange()},f.options.deferRequestBy)}else{f.onValueChange()}}},onValueChange:function(){var f=this,e=f.options,h=f.el.val(),g=f.getQuery(h);if(f.selection&&f.currentValue!==g){f.selection=null;(e.onInvalidateSelection||d.noop).call(f.element)}clearInterval(f.onChangeInterval);f.currentValue=h;f.selectedIndex=-1;if(e.triggerSelectOnValidInput&&f.isExactMatch(g)){f.select(0);return}if(g.length<e.minChars){f.hide()}else{f.getSuggestions(g)}},isExactMatch:function(f){var e=this.suggestions;return(e.length===1&&e[0].value.toLowerCase()===f.toLowerCase())},getQuery:function(f){var e=this.options.delimiter,g;if(!e){return f}g=f.split(e);return d.trim(g[g.length-1])},getSuggestionsLocal:function(k){var i=this,g=i.options,f=k.toLowerCase(),h=g.lookupFilter,e=parseInt(g.lookupLimit,10),j;j={suggestions:d.grep(g.lookup,function(l){return h(l,k,f)})};if(e&&j.suggestions.length>e){j.suggestions=j.suggestions.slice(0,e)}return j},getSuggestions:function(i){var e,g=this,f=g.options,j=f.serviceUrl,l,k,h;f.params[f.paramName]=i;l=f.ignoreParams?null:f.params;if(f.onSearchStart.call(g.element,f.params)===false){return}if(d.isFunction(f.lookup)){f.lookup(i,function(m){g.suggestions=m.suggestions;g.suggest();f.onSearchComplete.call(g.element,i,m.suggestions)});return}if(g.isLocal){e=g.getSuggestionsLocal(i)}else{if(d.isFunction(j)){j=j.call(g.element,i)}k=j+"?"+d.param(l||{});e=g.cachedResponse[k]}if(e&&d.isArray(e.suggestions)){g.suggestions=e.suggestions;g.suggest();f.onSearchComplete.call(g.element,i,e.suggestions)}else{if(!g.isBadQuery(i)){g.abortAjax();h={url:j,data:l,type:f.type,dataType:f.dataType};d.extend(h,f.ajaxSettings);g.currentRequest=d.ajax(h).done(function(n){var m;g.currentRequest=null;m=f.transformResult(n,i);g.processResponse(m,i,k);f.onSearchComplete.call(g.element,i,m.suggestions)}).fail(function(m,o,n){f.onSearchError.call(g.element,i,m,o,n)})}else{f.onSearchComplete.call(g.element,i,[])}}},isBadQuery:function(f){if(!this.options.preventBadQueries){return false}var g=this.badQueries,e=g.length;while(e--){if(f.indexOf(g[e])===0){return true}}return false},hide:function(){var f=this,e=d(f.suggestionsContainer);if(d.isFunction(f.options.onHide)&&f.visible){f.options.onHide.call(f.element,e)}f.visible=false;f.selectedIndex=-1;clearInterval(f.onChangeInterval);d(f.suggestionsContainer).hide();f.signalHint(null)},suggest:function(){if(this.suggestions.length===0){if(this.options.showNoSuggestionNotice){this.noSuggestions()}else{this.hide()}return}var k=this,q=k.options,o=q.groupBy,m=q.formatResult,n=k.getQuery(k.currentValue),l=k.classes.suggestion,g=k.classes.selected,e=d(k.suggestionsContainer),j=d(k.noSuggestionsContainer),p=q.beforeRender,i="",f,h=function(s,t){var r=s.data[o];if(f===r){return""}f=r;return'<div class="autocomplete-group"><strong>'+f+"</strong></div>"};if(q.triggerSelectOnValidInput&&k.isExactMatch(n)){k.select(0);return}d.each(k.suggestions,function(s,r){if(o){i+=h(r,n,s)}i+='<div class="'+l+'" data-index="'+s+'">'+m(r,n)+"</div>"});this.adjustContainerWidth();j.detach();e.html(i);if(d.isFunction(p)){p.call(k.element,e)}k.fixPosition();e.show();if(q.autoSelectFirst){k.selectedIndex=0;e.scrollTop(0);e.children("."+l).first().addClass(g)}k.visible=true;k.findBestHint()},noSuggestions:function(){var g=this,e=d(g.suggestionsContainer),f=d(g.noSuggestionsContainer);this.adjustContainerWidth();f.detach();e.empty();e.append(f);g.fixPosition();e.show();g.visible=true},adjustContainerWidth:function(){var h=this,f=h.options,g,e=d(h.suggestionsContainer);if(f.width==="auto"){g=h.el.outerWidth()-2;e.width(g>0?g:300)}},findBestHint:function(){var f=this,g=f.el.val().toLowerCase(),e=null;if(!g){return}d.each(f.suggestions,function(j,h){var k=h.value.toLowerCase().indexOf(g)===0;if(k){e=h}return !k});f.signalHint(e)},signalHint:function(f){var e="",g=this;if(f){e=g.currentValue+f.value.substr(g.currentValue.length)}if(g.hintValue!==e){g.hintValue=e;g.hint=f;(this.options.onHint||d.noop)(e)}},verifySuggestionsFormat:function(e){if(e.length&&typeof e[0]==="string"){return d.map(e,function(f){return{value:f,data:null}})}return e},validateOrientation:function(e,f){e=d.trim(e||"").toLowerCase();if(d.inArray(e,["auto","bottom","top"])===-1){e=f}return e},processResponse:function(e,f,i){var h=this,g=h.options;e.suggestions=h.verifySuggestionsFormat(e.suggestions);if(!g.noCache){h.cachedResponse[i]=e;if(g.preventBadQueries&&e.suggestions.length===0){h.badQueries.push(f)}}if(f!==h.getQuery(h.currentValue)){return}h.suggestions=e.suggestions;h.suggest()},activate:function(f){var i=this,j,h=i.classes.selected,e=d(i.suggestionsContainer),g=e.find("."+i.classes.suggestion);e.find("."+h).removeClass(h);i.selectedIndex=f;if(i.selectedIndex!==-1&&g.length>i.selectedIndex){j=g.get(i.selectedIndex);d(j).addClass(h);return j}return null},selectHint:function(){var f=this,e=d.inArray(f.hint,f.suggestions);f.select(e)},select:function(e){var f=this;f.hide();f.onSelect(e)},moveUp:function(){var e=this;if(e.selectedIndex===-1){return}if(e.selectedIndex===0){d(e.suggestionsContainer).children().first().removeClass(e.classes.selected);e.selectedIndex=-1;e.el.val(e.currentValue);e.findBestHint();return}e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;if(e.selectedIndex===(e.suggestions.length-1)){return}e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var g=this,k=g.activate(e);if(!k){return}var f,i,j,h=d(k).outerHeight();f=k.offsetTop;i=d(g.suggestionsContainer).scrollTop();j=i+g.options.maxHeight-h;if(f<i){d(g.suggestionsContainer).scrollTop(f)}else{if(f>j){d(g.suggestionsContainer).scrollTop(f-g.options.maxHeight+h)}}if(!g.options.preserveInput){g.el.val(g.getValue(g.suggestions[e].value))}g.signalHint(null)},onSelect:function(f){var h=this,g=h.options.onSelect,e=h.suggestions[f];h.currentValue=h.getValue(e.value);if(h.currentValue!==h.el.val()&&!h.options.preserveInput){h.el.val(h.currentValue)}h.signalHint(null);h.suggestions=[];h.selection=e;if(d.isFunction(g)){g.call(h.element,e)}},getValue:function(h){var g=this,e=g.options.delimiter,f,i;if(!e){return h}f=g.currentValue;i=f.split(e);if(i.length===1){return h}return f.substr(0,f.length-i[i.length-1].length)+h},dispose:function(){var e=this;e.el.off(".autocomplete").removeData("autocomplete");e.disableKillerFn();d(window).off("resize.autocomplete",e.fixPositionCapture);d(e.suggestionsContainer).remove()}};d.fn.autocomplete=d.fn.devbridgeAutocomplete=function(f,e){var g="autocomplete";if(arguments.length===0){return this.first().data(g)}return this.each(function(){var i=d(this),h=i.data(g);if(typeof f==="string"){if(h&&typeof h[f]==="function"){h[f](e)}}else{if(h&&h.dispose){h.dispose()}h=new b(this,f);i.data(g,h)}})}}));