!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(f){function e(k,j){var i=function(){},b=this,a={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:e.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:i,onSearchComplete:i,onSearchError:i,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(l,d,m){return -1!==l.value.toLowerCase().indexOf(m)},paramName:"query",transformResult:function(c){return"string"==typeof c?f.parseJSON(c):c},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};b.element=k,b.el=f(k),b.suggestions=[],b.badQueries=[],b.selectedIndex=-1,b.currentValue=b.element.value,b.intervalId=0,b.cachedResponse={},b.onChangeInterval=null,b.onChange=null,b.isLocal=!1,b.suggestionsContainer=null,b.noSuggestionsContainer=null,b.options=f.extend({},a,j),b.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},b.hint=null,b.hintValue="",b.selection=null,b.initialize(),b.setOptions(j)}var h=function(){return{escapeRegExChars:function(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(d){var c=document.createElement("div");return c.className=d,c.style.position="absolute",c.style.display="none",c}}}(),g={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};e.utils=h,f.Autocomplete=e,e.formatResult=function(i,c){var j="("+h.escapeRegExChars(c)+")";return i.value.replace(new RegExp(j,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")},e.prototype={killerFn:null,initialize:function(){var k,j=this,i="."+j.classes.suggestion,b=j.classes.selected,a=j.options;j.element.setAttribute("autocomplete","off"),j.killerFn=function(c){0===f(c.target).closest("."+j.options.containerClass).length&&(j.killSuggestions(),j.disableKillerFn())},j.noSuggestionsContainer=f('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),j.suggestionsContainer=e.utils.createNode(a.containerClass),k=f(j.suggestionsContainer),k.appendTo(a.appendTo),"auto"!==a.width&&k.width(a.width),k.on("mouseover.autocomplete",i,function(){j.activate(f(this).data("index"))}),k.on("mouseout.autocomplete",function(){j.selectedIndex=-1,k.children("."+b).removeClass(b)}),k.on("click.autocomplete",i,function(){j.select(f(this).data("index"))}),j.fixPositionCapture=function(){j.visible&&j.fixPosition()},f(window).on("resize.autocomplete",j.fixPositionCapture),j.el.on("keydown.autocomplete",function(c){j.onKeyPress(c)}),j.el.on("keyup.autocomplete",function(c){j.onKeyUp(c)}),j.el.on("blur.autocomplete",function(){j.onBlur()}),j.el.on("focus.autocomplete",function(){j.onFocus()}),j.el.on("change.autocomplete",function(c){j.onKeyUp(c)}),j.el.on("input.autocomplete",function(c){j.onKeyUp(c)})},onFocus:function(){var b=this;b.fixPosition(),0===b.options.minChars&&0===b.el.val().length&&b.onValueChange()},onBlur:function(){this.enableKillerFn()},abortAjax:function(){var b=this;b.currentRequest&&(b.currentRequest.abort(),b.currentRequest=null)},setOptions:function(a){var j=this,i=j.options;f.extend(i,a),j.isLocal=f.isArray(i.lookup),j.isLocal&&(i.lookup=j.verifySuggestionsFormat(i.lookup)),i.orientation=j.validateOrientation(i.orientation,"bottom"),f(j.suggestionsContainer).css({"max-height":i.maxHeight+"px",width:i.width+"px","z-index":i.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var b=this;b.disabled=!0,clearInterval(b.onChangeInterval),b.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var B=this,A=f(B.suggestionsContainer),z=A.parent().get(0);if(z===document.body||B.options.forceFixPosition){var y=B.options.orientation,x=A.outerHeight(),w=B.el.outerHeight(),v=B.el.offset(),u={top:v.top,left:v.left};if("auto"===y){var t=f(window).height(),s=f(window).scrollTop(),r=-s+v.top-x,q=s+t-(v.top+w+x);y=Math.max(r,q)===r?"top":"bottom"}if("top"===y?u.top+=-x:u.top+=w,z!==document.body){var p,a=A.css("opacity");B.visible||A.css("opacity",0).show(),p=A.offsetParent().offset(),u.top-=p.top,u.left-=p.left,B.visible||A.css("opacity",a).hide()}"auto"===B.options.width&&(u.width=B.el.outerWidth()-2+"px"),A.css(u)}},enableKillerFn:function(){var a=this;f(document).on("click.autocomplete",a.killerFn)},disableKillerFn:function(){var a=this;f(document).off("click.autocomplete",a.killerFn)},killSuggestions:function(){var b=this;b.stopKillSuggestions(),b.intervalId=window.setInterval(function(){b.visible&&(b.el.val(b.currentValue),b.hide()),b.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var j,i=this,l=i.el.val().length,k=i.element.selectionStart;return"number"==typeof k?k===l:document.selection?(j=document.selection.createRange(),j.moveStart("character",-l),l===j.text.length):!0},onKeyPress:function(d){var c=this;if(!c.disabled&&!c.visible&&d.which===g.DOWN&&c.currentValue){return void c.suggest()}if(!c.disabled&&c.visible){switch(d.which){case g.ESC:c.el.val(c.currentValue),c.hide();break;case g.RIGHT:if(c.hint&&c.options.onHint&&c.isCursorAtEnd()){c.selectHint();break}return;case g.TAB:if(c.hint&&c.options.onHint){return void c.selectHint()}if(-1===c.selectedIndex){return void c.hide()}if(c.select(c.selectedIndex),c.options.tabDisabled===!1){return}break;case g.RETURN:if(-1===c.selectedIndex){return void c.hide()}c.select(c.selectedIndex);break;case g.UP:c.moveUp();break;case g.DOWN:c.moveDown();break;default:return}d.stopImmediatePropagation(),d.preventDefault()}},onKeyUp:function(d){var c=this;if(!c.disabled){switch(d.which){case g.UP:case g.DOWN:return}clearInterval(c.onChangeInterval),c.currentValue!==c.el.val()&&(c.findBestHint(),c.options.deferRequestBy>0?c.onChangeInterval=setInterval(function(){c.onValueChange()},c.options.deferRequestBy):c.onValueChange())}},onValueChange:function(){var a=this,k=a.options,j=a.el.val(),i=a.getQuery(j);return a.selection&&a.currentValue!==i&&(a.selection=null,(k.onInvalidateSelection||f.noop).call(a.element)),clearInterval(a.onChangeInterval),a.currentValue=j,a.selectedIndex=-1,k.triggerSelectOnValidInput&&a.isExactMatch(i)?void a.select(0):void (i.length<k.minChars?a.hide():a.getSuggestions(i))},isExactMatch:function(d){var c=this.suggestions;return 1===c.length&&c[0].value.toLowerCase()===d.toLowerCase()},getQuery:function(a){var j,i=this.options.delimiter;return i?(j=a.split(i),f.trim(j[j.length-1])):a},getSuggestionsLocal:function(a){var n,m=this,l=m.options,k=a.toLowerCase(),j=l.lookupFilter,i=parseInt(l.lookupLimit,10);return n={suggestions:f.grep(l.lookup,function(b){return j(b,a,k)})},i&&n.suggestions.length>i&&(n.suggestions=n.suggestions.slice(0,i)),n},getSuggestions:function(a){var p,o,n,m,l=this,k=l.options,j=k.serviceUrl;if(k.params[k.paramName]=a,o=k.ignoreParams?null:k.params,k.onSearchStart.call(l.element,k.params)!==!1){if(f.isFunction(k.lookup)){return void k.lookup(a,function(b){l.suggestions=b.suggestions,l.suggest(),k.onSearchComplete.call(l.element,a,b.suggestions)})}l.isLocal?p=l.getSuggestionsLocal(a):(f.isFunction(j)&&(j=j.call(l.element,a)),n=j+"?"+f.param(o||{}),p=l.cachedResponse[n]),p&&f.isArray(p.suggestions)?(l.suggestions=p.suggestions,l.suggest(),k.onSearchComplete.call(l.element,a,p.suggestions)):l.isBadQuery(a)?k.onSearchComplete.call(l.element,a,[]):(l.abortAjax(),m={url:j,data:o,type:k.type,dataType:k.dataType},f.extend(m,k.ajaxSettings),l.currentRequest=f.ajax(m).done(function(b){var d;l.currentRequest=null,d=k.transformResult(b,a),l.processResponse(d,a,n),k.onSearchComplete.call(l.element,a,d.suggestions)}).fail(function(b,q,i){k.onSearchError.call(l.element,a,b,q,i)}))}},isBadQuery:function(i){if(!this.options.preventBadQueries){return !1}for(var d=this.badQueries,j=d.length;j--;){if(0===i.indexOf(d[j])){return !0}}return !1},hide:function(){var a=this,d=f(a.suggestionsContainer);f.isFunction(a.options.onHide)&&a.visible&&a.options.onHide.call(a.element,d),a.visible=!1,a.selectedIndex=-1,clearInterval(a.onChangeInterval),f(a.suggestionsContainer).hide(),a.signalHint(null)},suggest:function(){if(0===this.suggestions.length){return void (this.options.showNoSuggestionNotice?this.noSuggestions():this.hide())}var z,y=this,x=y.options,w=x.groupBy,v=x.formatResult,u=y.getQuery(y.currentValue),t=y.classes.suggestion,s=y.classes.selected,r=f(y.suggestionsContainer),q=f(y.noSuggestionsContainer),p=x.beforeRender,o="",a=function(b,j){var i=b.data[w];return z===i?"":(z=i,'<div class="autocomplete-group"><strong>'+z+"</strong></div>")};return x.triggerSelectOnValidInput&&y.isExactMatch(u)?void y.select(0):(f.each(y.suggestions,function(d,c){w&&(o+=a(c,u,d)),o+='<div class="'+t+'" data-index="'+d+'">'+v(c,u)+"</div>"}),this.adjustContainerWidth(),q.detach(),r.html(o),f.isFunction(p)&&p.call(y.element,r),y.fixPosition(),r.show(),x.autoSelectFirst&&(y.selectedIndex=0,r.scrollTop(0),r.children("."+t).first().addClass(s)),y.visible=!0,void y.findBestHint())},noSuggestions:function(){var a=this,j=f(a.suggestionsContainer),i=f(a.noSuggestionsContainer);this.adjustContainerWidth(),i.detach(),j.empty(),j.append(i),a.fixPosition(),j.show(),a.visible=!0},adjustContainerWidth:function(){var a,k=this,j=k.options,i=f(k.suggestionsContainer);"auto"===j.width&&(a=k.el.outerWidth()-2,i.width(a>0?a:300))},findBestHint:function(){var a=this,j=a.el.val().toLowerCase(),i=null;j&&(f.each(a.suggestions,function(d,c){var k=0===c.value.toLowerCase().indexOf(j);return k&&(i=c),!k}),a.signalHint(i))},signalHint:function(a){var j="",i=this;a&&(j=i.currentValue+a.value.substr(i.currentValue.length)),i.hintValue!==j&&(i.hintValue=j,i.hint=a,(this.options.onHint||f.noop)(j))},verifySuggestionsFormat:function(a){return a.length&&"string"==typeof a[0]?f.map(a,function(b){return{value:b,data:null}}):a},validateOrientation:function(a,d){return a=f.trim(a||"").toLowerCase(),-1===f.inArray(a,["auto","bottom","top"])&&(a=d),a},processResponse:function(j,i,m){var l=this,k=l.options;j.suggestions=l.verifySuggestionsFormat(j.suggestions),k.noCache||(l.cachedResponse[m]=j,k.preventBadQueries&&0===j.suggestions.length&&l.badQueries.push(i)),i===l.getQuery(l.currentValue)&&(l.suggestions=j.suggestions,l.suggest())},activate:function(a){var m,l=this,k=l.classes.selected,j=f(l.suggestionsContainer),i=j.find("."+l.classes.suggestion);return j.find("."+k).removeClass(k),l.selectedIndex=a,-1!==l.selectedIndex&&i.length>l.selectedIndex?(m=i.get(l.selectedIndex),f(m).addClass(k),m):null},selectHint:function(){var a=this,d=f.inArray(a.hint,a.suggestions);a.select(d)},select:function(d){var c=this;c.hide(),c.onSelect(d)},moveUp:function(){var a=this;if(-1!==a.selectedIndex){return 0===a.selectedIndex?(f(a.suggestionsContainer).children().first().removeClass(a.classes.selected),a.selectedIndex=-1,a.el.val(a.currentValue),void a.findBestHint()):void a.adjustScroll(a.selectedIndex-1)}},moveDown:function(){var b=this;b.selectedIndex!==b.suggestions.length-1&&b.adjustScroll(b.selectedIndex+1)},adjustScroll:function(a){var n=this,m=n.activate(a);if(m){var l,k,j,i=f(m).outerHeight();l=m.offsetTop,k=f(n.suggestionsContainer).scrollTop(),j=k+n.options.maxHeight-i,k>l?f(n.suggestionsContainer).scrollTop(l):l>j&&f(n.suggestionsContainer).scrollTop(l-n.options.maxHeight+i),n.options.preserveInput||n.el.val(n.getValue(n.suggestions[a].value)),n.signalHint(null)}},onSelect:function(a){var k=this,j=k.options.onSelect,i=k.suggestions[a];k.currentValue=k.getValue(i.value),k.currentValue===k.el.val()||k.options.preserveInput||k.el.val(k.currentValue),k.signalHint(null),k.suggestions=[],k.selection=i,f.isFunction(j)&&j.call(k.element,i)},getValue:function(j){var i,m,l=this,k=l.options.delimiter;return k?(i=l.currentValue,m=i.split(k),1===m.length?j:i.substr(0,i.length-m[m.length-1].length)+j):j},dispose:function(){var a=this;a.el.off(".autocomplete").removeData("autocomplete"),a.disableKillerFn(),f(window).off("resize.autocomplete",a.fixPositionCapture),f(a.suggestionsContainer).remove()}},f.fn.autocomplete=f.fn.devbridgeAutocomplete=function(i,b){var a="autocomplete";return 0===arguments.length?this.first().data(a):this.each(function(){var d=f(this),c=d.data(a);"string"==typeof i?c&&"function"==typeof c[i]&&c[i](b):(c&&c.dispose&&c.dispose(),c=new e(this,i),d.data(a,c))})}});