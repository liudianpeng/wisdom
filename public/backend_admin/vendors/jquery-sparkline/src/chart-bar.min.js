$.fn.sparkline.bar=bar=createClass($.fn.sparkline._base,barHighlightMixin,{type:"bar",init:function(J,L,q,a,b){var s=parseInt(q.get("barWidth"),10),u=parseInt(q.get("barSpacing"),10),g=q.get("chartRangeMin"),z=q.get("chartRangeMax"),d=q.get("chartRangeClip"),D=Infinity,m=-Infinity,M,h,B,r,A,I,C,f,w,o,K,p,H,n,E,e,G,x,k,t,c,F,y;bar._super.init.call(this,J,L,q,a,b);for(I=0,C=L.length;I<C;I++){t=L[I];M=typeof(t)==="string"&&t.indexOf(":")>-1;if(M||$.isArray(t)){E=true;if(M){t=L[I]=normalizeValues(t.split(":"))}t=remove(t,null);h=Math.min.apply(Math,t);B=Math.max.apply(Math,t);if(h<D){D=h}if(B>m){m=B}}}this.stacked=E;this.regionShapes={};this.barWidth=s;this.barSpacing=u;this.totalBarWidth=s+u;this.width=a=(L.length*s)+((L.length-1)*u);this.initTarget();if(d){H=g===undefined?-Infinity:g;n=z===undefined?Infinity:z}A=[];r=E?[]:A;var v=[];var l=[];for(I=0,C=L.length;I<C;I++){if(E){e=L[I];L[I]=k=[];v[I]=0;r[I]=l[I]=0;for(G=0,x=e.length;G<x;G++){t=k[G]=d?clipval(e[G],H,n):e[G];if(t!==null){if(t>0){v[I]+=t}if(D<0&&m>0){if(t<0){l[I]+=Math.abs(t)}else{r[I]+=t}}else{r[I]+=Math.abs(t-(t<0?m:D))}A.push(t)}}}else{t=d?clipval(L[I],H,n):L[I];t=L[I]=normalizeValue(t);if(t!==null){A.push(t)}}}this.max=p=Math.max.apply(Math,A);this.min=K=Math.min.apply(Math,A);this.stackMax=m=E?Math.max.apply(Math,v):p;this.stackMin=D=E?Math.min.apply(Math,A):K;if(q.get("chartRangeMin")!==undefined&&(q.get("chartRangeClip")||q.get("chartRangeMin")<K)){K=q.get("chartRangeMin")}if(q.get("chartRangeMax")!==undefined&&(q.get("chartRangeClip")||q.get("chartRangeMax")>p)){p=q.get("chartRangeMax")}this.zeroAxis=w=q.get("zeroAxis",true);if(K<=0&&p>=0&&w){o=0}else{if(w==false){o=K}else{if(K>0){o=K}else{o=p}}}this.xaxisOffset=o;f=E?(Math.max.apply(Math,r)+Math.max.apply(Math,l)):p-K;this.canvasHeightEf=(w&&K<0)?this.canvasHeight-2:this.canvasHeight-1;if(K<o){F=(E&&p>=0)?m:p;c=(F-o)/f*this.canvasHeight;if(c!==Math.ceil(c)){this.canvasHeightEf-=2;c=Math.ceil(c)}}else{c=this.canvasHeight}this.yoffset=c;if($.isArray(q.get("colorMap"))){this.colorMapByIndex=q.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=q.get("colorMap");if(this.colorMapByValue&&this.colorMapByValue.get===undefined){this.colorMapByValue=new RangeMap(this.colorMapByValue)}}this.range=f},getRegion:function(c,b,d){var a=Math.floor(b/this.totalBarWidth);return(a<0||a>=this.values.length)?undefined:a},getCurrentRegionFields:function(){var e=this.currentRegion,b=ensureArray(this.values[e]),a=[],d,c;for(c=b.length;c--;){d=b[c];a.push({isNull:d===null,value:d,color:this.calcColor(c,d,e),offset:e})}return a},calcColor:function(e,f,g){var h=this.colorMapByIndex,d=this.colorMapByValue,c=this.options,a,b;if(this.stacked){a=c.get("stackedBarColor")}else{a=(f<0)?c.get("negBarColor"):c.get("barColor")}if(f===0&&c.get("zeroColor")!==undefined){a=c.get("zeroColor")}if(d&&(b=d.get(f))){a=b}else{if(h&&h.length>g){a=h[g]}}return $.isArray(a)?a[e%a.length]:a},renderRegion:function(l,e){var n=this.values[l],c=this.options,a=this.xaxisOffset,j=[],o=this.range,u=this.stacked,v=this.target,h=l*this.totalBarWidth,b=this.canvasHeightEf,k=this.yoffset,g,p,r,q,f,s,d,w,t,m;n=$.isArray(n)?n:[n];d=n.length;w=n[0];q=all(null,n);m=all(a,n,true);if(q){if(c.get("nullColor")){r=e?c.get("nullColor"):this.calcHighlightColor(c.get("nullColor"),c);g=(k>0)?k-1:k;return v.drawRect(h,g,this.barWidth-1,0,r,r)}else{return undefined}}f=k;for(s=0;s<d;s++){w=n[s];if(u&&w===a){if(!m||t){continue}t=true}if(o>0){p=Math.floor(b*((Math.abs(w-a)/o)))+1}else{p=1}if(w<a||(w===a&&k===0)){g=f;f+=p}else{g=k-p;k-=p}r=this.calcColor(s,w,l);if(e){r=this.calcHighlightColor(r,c)}j.push(v.drawRect(h,g,this.barWidth-1,p-1,r,r))}if(j.length===1){return j[0]}return j}});