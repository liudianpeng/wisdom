$.fn.sparkline.box=box=createClass($.fn.sparkline._base,{type:"box",init:function(e,b,c,d,a){box._super.init.call(this,e,b,c,d,a);this.values=$.map(b,Number);this.width=c.get("width")==="auto"?"4.0em":d;this.initTarget();if(!this.values.length){this.disabled=1}},getRegion:function(){return 1},getCurrentRegionFields:function(){var a=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];if(this.loutlier!==undefined){a.push({field:"lo",value:this.loutlier})}if(this.routlier!==undefined){a.push({field:"ro",value:this.routlier})}if(this.lwhisker!==undefined){a.push({field:"lw",value:this.lwhisker})}if(this.rwhisker!==undefined){a.push({field:"rw",value:this.rwhisker})}return a},render:function(){var u=this.target,d=this.values,h=d.length,f=this.options,t=this.canvasWidth,b=this.canvasHeight,n=f.get("chartRangeMin")===undefined?Math.min.apply(Math,d):f.get("chartRangeMin"),s=f.get("chartRangeMax")===undefined?Math.max.apply(Math,d):f.get("chartRangeMax"),p=0,m,r,e,l,k,j,a,g,q,o,c;if(!box._super.render.call(this)){return}if(f.get("raw")){if(f.get("showOutliers")&&d.length>5){r=d[0];m=d[1];l=d[2];k=d[3];j=d[4];a=d[5];g=d[6]}else{m=d[0];l=d[1];k=d[2];j=d[3];a=d[4]}}else{d.sort(function(v,i){return v-i});l=quartile(d,1);k=quartile(d,2);j=quartile(d,3);e=j-l;if(f.get("showOutliers")){m=a=undefined;for(q=0;q<h;q++){if(m===undefined&&d[q]>l-(e*f.get("outlierIQR"))){m=d[q]}if(d[q]<j+(e*f.get("outlierIQR"))){a=d[q]}}r=d[0];g=d[h-1]}else{m=d[0];a=d[h-1]}}this.quartiles=[l,k,j];this.lwhisker=m;this.rwhisker=a;this.loutlier=r;this.routlier=g;c=t/(s-n+1);if(f.get("showOutliers")){p=Math.ceil(f.get("spotRadius"));t-=2*Math.ceil(f.get("spotRadius"));c=t/(s-n+1);if(r<m){u.drawCircle((r-n)*c+p,b/2,f.get("spotRadius"),f.get("outlierLineColor"),f.get("outlierFillColor")).append()}if(g>a){u.drawCircle((g-n)*c+p,b/2,f.get("spotRadius"),f.get("outlierLineColor"),f.get("outlierFillColor")).append()}}u.drawRect(Math.round((l-n)*c+p),Math.round(b*0.1),Math.round((j-l)*c),Math.round(b*0.8),f.get("boxLineColor"),f.get("boxFillColor")).append();u.drawLine(Math.round((m-n)*c+p),Math.round(b/2),Math.round((l-n)*c+p),Math.round(b/2),f.get("lineColor")).append();u.drawLine(Math.round((m-n)*c+p),Math.round(b/4),Math.round((m-n)*c+p),Math.round(b-b/4),f.get("whiskerColor")).append();u.drawLine(Math.round((a-n)*c+p),Math.round(b/2),Math.round((j-n)*c+p),Math.round(b/2),f.get("lineColor")).append();u.drawLine(Math.round((a-n)*c+p),Math.round(b/4),Math.round((a-n)*c+p),Math.round(b-b/4),f.get("whiskerColor")).append();u.drawLine(Math.round((k-n)*c+p),Math.round(b*0.1),Math.round((k-n)*c+p),Math.round(b*0.9),f.get("medianColor")).append();if(f.get("target")){o=Math.ceil(f.get("spotRadius"));u.drawLine(Math.round((f.get("target")-n)*c+p),Math.round((b/2)-o),Math.round((f.get("target")-n)*c+p),Math.round((b/2)+o),f.get("targetColor")).append();u.drawLine(Math.round((f.get("target")-n)*c+p-o),Math.round(b/2),Math.round((f.get("target")-n)*c+p+o),Math.round(b/2),f.get("targetColor")).append()}u.render()}});