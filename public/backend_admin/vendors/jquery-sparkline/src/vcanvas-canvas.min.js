VCanvas_canvas=createClass(VCanvas_base,{init:function(c,a,d,b){VCanvas_canvas._super.init.call(this,c,a,d);this.canvas=document.createElement("canvas");if(d[0]){d=d[0]}$.data(d,"_jqs_vcanvas",this);$(this.canvas).css({display:"inline-block",width:c,height:a,verticalAlign:"top"});this._insert(this.canvas,d);this._calculatePixelDims(c,a,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=b;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined;$(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(c,d,a){var b=this.canvas.getContext("2d");if(c!==undefined){b.strokeStyle=c}b.lineWidth=a===undefined?1:a;if(d!==undefined){b.fillStyle=d}return b},reset:function(){var a=this._getContext();a.clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined},_drawShape:function(g,f,e,h,a){var c=this._getContext(e,h,a),b,d;c.beginPath();c.moveTo(f[0][0]+0.5,f[0][1]+0.5);for(b=1,d=f.length;b<d;b++){c.lineTo(f[b][0]+0.5,f[b][1]+0.5)}if(e!==undefined){c.stroke()}if(h!==undefined){c.fill()}if(this.targetX!==undefined&&this.targetY!==undefined&&c.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=g}},_drawCircle:function(f,c,h,b,e,g,a){var d=this._getContext(e,g,a);d.beginPath();d.arc(c,h,b,0,2*Math.PI,false);if(this.targetX!==undefined&&this.targetY!==undefined&&d.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=f}if(e!==undefined){d.stroke()}if(g!==undefined){d.fill()}},_drawPieSlice:function(e,i,g,d,f,c,h,b){var a=this._getContext(h,b);a.beginPath();a.moveTo(i,g);a.arc(i,g,d,f,c,false);a.lineTo(i,g);a.closePath();if(h!==undefined){a.stroke()}if(b){a.fill()}if(this.targetX!==undefined&&this.targetY!==undefined&&a.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=e}},_drawRect:function(e,b,g,c,a,d,f){return this._drawShape(e,[[b,g],[b+c,g],[b+c,g+a],[b,g+a],[b,g]],d,f)},appendShape:function(a){this.shapes[a.id]=a;this.shapeseq.push(a.id);this.lastShapeId=a.id;return a.id},replaceWithShape:function(c,a){var d=this.shapeseq,b;this.shapes[a.id]=a;for(b=d.length;b--;){if(d[b]==c){d[b]=a.id}}delete this.shapes[c]},replaceWithShapes:function(c,b){var g=this.shapeseq,e={},a,d,f;for(d=c.length;d--;){e[c[d]]=true}for(d=g.length;d--;){a=g[d];if(e[a]){g.splice(d,1);delete this.shapes[a];f=d}}for(d=b.length;d--;){g.splice(f,0,b[d].id);this.shapes[b[d].id]=b[d]}},insertAfterShape:function(c,a){var d=this.shapeseq,b;for(b=d.length;b--;){if(d[b]===c){d.splice(b+1,0,a.id);this.shapes[a.id]=a;return}}},removeShapeId:function(b){var c=this.shapeseq,a;for(a=c.length;a--;){if(c[a]===b){c.splice(a,1);break}}delete this.shapes[b]},getShapeAt:function(b,a,c){this.targetX=a;this.targetY=c;this.render();return this.currentTargetShapeId},render:function(){var g=this.shapeseq,a=this.shapes,e=g.length,d=this._getContext(),f,b,c;d.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(c=0;c<e;c++){f=g[c];b=a[f];this["_draw"+b.type].apply(this,b.args)}if(!this.interact){this.shapes={};this.shapeseq=[]}}});