$.fn.sparkline.line=line=createClass($.fn.sparkline._base,{type:"line",init:function(e,b,c,d,a){line._super.init.call(this,e,b,c,d,a);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;this.initTarget()},getRegion:function(c,a,e){var b,d=this.regionMap;for(b=d.length;b--;){if(d[b]!==null&&a>=d[b][0]&&a<=d[b][1]){return d[b][2]}}return undefined},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.yvalues[a]===null,x:this.xvalues[a],y:this.yvalues[a],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:a}},renderHighlight:function(){var a=this.currentRegion,h=this.target,e=this.vertices[a],i=this.options,d=i.get("spotRadius"),c=i.get("highlightSpotColor"),f=i.get("highlightLineColor"),b,g;if(!e){return}if(d&&c){b=h.drawCircle(e[0],e[1],d,undefined,c);this.highlightSpotId=b.id;h.insertAfterShape(this.lastShapeId,b)}if(f){g=h.drawLine(e[0],this.canvasTop,e[0],this.canvasTop+this.canvasHeight,f);this.highlightLineId=g.id;h.insertAfterShape(this.lastShapeId,g)}},removeHighlight:function(){var a=this.target;if(this.highlightSpotId){a.removeShapeId(this.highlightSpotId);this.highlightSpotId=null}if(this.highlightLineId){a.removeShapeId(this.highlightLineId);this.highlightLineId=null}},scanValues:function(){var j=this.values,c=j.length,a=this.xvalues,g=this.yvalues,k=this.yminmax,e,d,h,f,b;for(e=0;e<c;e++){d=j[e];h=typeof(j[e])==="string";f=typeof(j[e])==="object"&&j[e] instanceof Array;b=h&&j[e].split(":");if(h&&b.length===2){a.push(Number(b[0]));g.push(Number(b[1]));k.push(Number(b[1]))}else{if(f){a.push(d[0]);g.push(d[1]);k.push(d[1])}else{a.push(e);if(j[e]===null||j[e]==="null"){g.push(null)}else{g.push(Number(d));k.push(Number(d))}}}}if(this.options.get("xvalues")){a=this.options.get("xvalues")}this.maxy=this.maxyorg=Math.max.apply(Math,k);this.miny=this.minyorg=Math.min.apply(Math,k);this.maxx=Math.max.apply(Math,a);this.minx=Math.min.apply(Math,a);this.xvalues=a;this.yvalues=g;this.yminmax=k},processRangeOptions:function(){var b=this.options,a=b.get("normalRangeMin"),c=b.get("normalRangeMax");if(a!==undefined){if(a<this.miny){this.miny=a}if(c>this.maxy){this.maxy=c}}if(b.get("chartRangeMin")!==undefined&&(b.get("chartRangeClip")||b.get("chartRangeMin")<this.miny)){this.miny=b.get("chartRangeMin")}if(b.get("chartRangeMax")!==undefined&&(b.get("chartRangeClip")||b.get("chartRangeMax")>this.maxy)){this.maxy=b.get("chartRangeMax")}if(b.get("chartRangeMinX")!==undefined&&(b.get("chartRangeClipX")||b.get("chartRangeMinX")<this.minx)){this.minx=b.get("chartRangeMinX")}if(b.get("chartRangeMaxX")!==undefined&&(b.get("chartRangeClipX")||b.get("chartRangeMaxX")>this.maxx)){this.maxx=b.get("chartRangeMaxX")}},drawNormalRange:function(c,g,f,d,h){var a=this.options.get("normalRangeMin"),e=this.options.get("normalRangeMax"),b=g+Math.round(f-(f*((e-this.miny)/h))),i=Math.round((f*(e-a))/h);this.target.drawRect(c,b,d,i,undefined,this.options.get("normalRangeColor")).append()},render:function(){var g=this.options,H=this.target,E=this.canvasWidth,d=this.canvasHeight,k=this.vertices,I=g.get("spotRadius"),r=this.regionMap,c,b,w,C,A,D,s,v,p,o,u,e,F,n,t,G,f,h,q,a,l,z,m,j,B;if(!line._super.render.call(this)){return}this.scanValues();this.processRangeOptions();m=this.xvalues;j=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){return}C=A=0;c=this.maxx-this.minx===0?1:this.maxx-this.minx;b=this.maxy-this.miny===0?1:this.maxy-this.miny;w=this.yvalues.length-1;if(I&&(E<(I*4)||d<(I*4))){I=0}if(I){l=g.get("highlightSpotColor")&&!g.get("disableInteraction");if(l||g.get("minSpotColor")||(g.get("spotColor")&&j[w]===this.miny)){d-=Math.ceil(I)}if(l||g.get("maxSpotColor")||(g.get("spotColor")&&j[w]===this.maxy)){d-=Math.ceil(I);C+=Math.ceil(I)}if(l||((g.get("minSpotColor")||g.get("maxSpotColor"))&&(j[0]===this.miny||j[0]===this.maxy))){A+=Math.ceil(I);E-=Math.ceil(I)}if(l||g.get("spotColor")||(g.get("minSpotColor")||g.get("maxSpotColor")&&(j[w]===this.miny||j[w]===this.maxy))){E-=Math.ceil(I)}}d--;if(g.get("normalRangeMin")!==undefined&&!g.get("drawNormalOnTop")){this.drawNormalRange(A,C,d,E,b)}s=[];v=[s];n=t=null;G=j.length;for(B=0;B<G;B++){p=m[B];u=m[B+1];o=j[B];e=A+Math.round((p-this.minx)*(E/c));F=B<G-1?A+Math.round((u-this.minx)*(E/c)):E;t=e+((F-e)/2);r[B]=[n||0,t,B];n=t;if(o===null){if(B){if(j[B-1]!==null){s=[];v.push(s)}k.push(null)}}else{if(o<this.miny){o=this.miny}if(o>this.maxy){o=this.maxy}if(!s.length){s.push([e,C+d])}D=[e,C+Math.round(d-(d*((o-this.miny)/b)))];s.push(D);k.push(D)}}f=[];h=[];q=v.length;for(B=0;B<q;B++){s=v[B];if(s.length){if(g.get("fillColor")){s.push([s[s.length-1][0],(C+d)]);h.push(s.slice(0));s.pop()}if(s.length>2){s[0]=[s[0][0],s[1][1]]}f.push(s)}}q=h.length;for(B=0;B<q;B++){H.drawShape(h[B],g.get("fillColor"),g.get("fillColor")).append()}if(g.get("normalRangeMin")!==undefined&&g.get("drawNormalOnTop")){this.drawNormalRange(A,C,d,E,b)}q=f.length;for(B=0;B<q;B++){H.drawShape(f[B],g.get("lineColor"),undefined,g.get("lineWidth")).append()}if(I&&g.get("valueSpots")){a=g.get("valueSpots");if(a.get===undefined){a=new RangeMap(a)}for(B=0;B<G;B++){z=a.get(j[B]);if(z){H.drawCircle(A+Math.round((m[B]-this.minx)*(E/c)),C+Math.round(d-(d*((j[B]-this.miny)/b))),I,undefined,z).append()}}}if(I&&g.get("spotColor")&&j[w]!==null){H.drawCircle(A+Math.round((m[m.length-1]-this.minx)*(E/c)),C+Math.round(d-(d*((j[w]-this.miny)/b))),I,undefined,g.get("spotColor")).append()}if(this.maxy!==this.minyorg){if(I&&g.get("minSpotColor")){p=m[$.inArray(this.minyorg,j)];H.drawCircle(A+Math.round((p-this.minx)*(E/c)),C+Math.round(d-(d*((this.minyorg-this.miny)/b))),I,undefined,g.get("minSpotColor")).append()}if(I&&g.get("maxSpotColor")){p=m[$.inArray(this.maxyorg,j)];H.drawCircle(A+Math.round((p-this.minx)*(E/c)),C+Math.round(d-(d*((this.maxyorg-this.miny)/b))),I,undefined,g.get("maxSpotColor")).append()}}this.lastShapeId=H.getLastShapeId();this.canvasTop=C;H.render()}});