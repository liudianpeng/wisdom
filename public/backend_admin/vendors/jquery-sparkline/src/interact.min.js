MouseHandler=createClass({init:function(c,a){var b=$(c);this.$el=b;this.options=a;this.currentPageX=0;this.currentPageY=0;this.el=c;this.splist=[];this.tooltip=null;this.over=false;this.displayTooltips=!a.get("disableTooltips");this.highlightEnabled=!a.get("disableHighlight")},registerSparkline:function(a){this.splist.push(a);if(this.over){this.updateDisplay()}},registerCanvas:function(a){var b=$(a.canvas);this.canvas=a;this.$canvas=b;b.mouseenter($.proxy(this.mouseenter,this));b.mouseleave($.proxy(this.mouseleave,this));b.click($.proxy(this.mouseclick,this))},reset:function(a){this.splist=[];if(this.tooltip&&a){this.tooltip.remove();this.tooltip=undefined}},mouseclick:function(b){var a=$.Event("sparklineClick");a.originalEvent=b;a.sparklines=this.splist;this.$el.trigger(a)},mouseenter:function(a){$(document.body).unbind("mousemove.jqs");$(document.body).bind("mousemove.jqs",$.proxy(this.mousemove,this));this.over=true;this.currentPageX=a.pageX;this.currentPageY=a.pageY;this.currentEl=a.target;if(!this.tooltip&&this.displayTooltips){this.tooltip=new Tooltip(this.options);this.tooltip.updatePosition(a.pageX,a.pageY)}this.updateDisplay()},mouseleave:function(){$(document.body).unbind("mousemove.jqs");var d=this.splist,a=d.length,c=false,e,b;this.over=false;this.currentEl=null;if(this.tooltip){this.tooltip.remove();this.tooltip=null}for(b=0;b<a;b++){e=d[b];if(e.clearRegionHighlight()){c=true}}if(c){this.canvas.render()}},mousemove:function(a){this.currentPageX=a.pageX;this.currentPageY=a.pageY;this.currentEl=a.target;if(this.tooltip){this.tooltip.updatePosition(a.pageX,a.pageY)}this.updateDisplay()},updateDisplay:function(){var b=this.splist,h=b.length,f=false,e=this.$canvas.offset(),d=this.currentPageX-e.left,c=this.currentPageY-e.top,j,a,g,l,k;if(!this.over){return}for(g=0;g<h;g++){a=b[g];l=a.setRegionHighlight(this.currentEl,d,c);if(l){f=true}}if(f){k=$.Event("sparklineRegionChange");k.sparklines=this.splist;this.$el.trigger(k);if(this.tooltip){j="";for(g=0;g<h;g++){a=b[g];j+=a.getCurrentRegionTooltip()}this.tooltip.setContent(j)}if(!this.disableHighlight){this.canvas.render()}}if(l===null){this.mouseleave()}}});Tooltip=createClass({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(a){var d=a.get("tooltipClassname","jqstooltip"),b=this.sizeStyle,c;this.container=a.get("tooltipContainer")||document.body;this.tooltipOffsetX=a.get("tooltipOffsetX",10);this.tooltipOffsetY=a.get("tooltipOffsetY",12);$("#jqssizetip").remove();$("#jqstooltip").remove();this.sizetip=$("<div/>",{id:"jqssizetip",style:b,"class":d});this.tooltip=$("<div/>",{id:"jqstooltip","class":d}).appendTo(this.container);c=this.tooltip.offset();this.offsetLeft=c.left;this.offsetTop=c.top;this.hidden=true;$(window).unbind("resize.jqs scroll.jqs");$(window).bind("resize.jqs scroll.jqs",$.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=$(window).scrollTop();this.scrollLeft=$(window).scrollLeft();this.scrollRight=this.scrollLeft+$(window).width();this.updatePosition()},getSize:function(a){this.sizetip.html(a).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(a){if(!a){this.tooltip.css("visibility","hidden");this.hidden=true;return}this.getSize(a);this.tooltip.html(a).css({width:this.width,height:this.height,visibility:"visible"});if(this.hidden){this.hidden=false;this.updatePosition()}},updatePosition:function(a,b){if(a===undefined){if(this.mousex===undefined){return}a=this.mousex-this.offsetLeft;b=this.mousey-this.offsetTop}else{this.mousex=a=a-this.offsetLeft;this.mousey=b=b-this.offsetTop}if(!this.height||!this.width||this.hidden){return}b-=this.height+this.tooltipOffsetY;a+=this.tooltipOffsetX;if(b<this.scrollTop){b=this.scrollTop}if(a<this.scrollLeft){a=this.scrollLeft}else{if(a+this.width>this.scrollRight){a=this.scrollRight-this.width}}this.tooltip.css({left:a,top:b})},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=undefined;$(window).unbind("resize.jqs scroll.jqs")}});