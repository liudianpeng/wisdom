$.fn.sparkline.pie=pie=createClass($.fn.sparkline._base,{type:"pie",init:function(f,b,c,e,a){var g=0,d;pie._super.init.call(this,f,b,c,e,a);this.shapes={};this.valueShapes={};this.values=b=$.map(b,Number);if(c.get("width")==="auto"){this.width=this.height}if(b.length>0){for(d=b.length;d--;){g+=b[d]}}this.total=g;this.initTarget();this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(b,a,d){var c=this.target.getShapeAt(b,a,d);return(c!==undefined&&this.shapes[c]!==undefined)?this.shapes[c]:undefined},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===undefined,value:this.values[a],percent:this.values[a]/this.total*100,color:this.options.get("sliceColors")[a%this.options.get("sliceColors").length],offset:a}},changeHighlight:function(a){var d=this.currentRegion,b=this.renderSlice(d,a),c=this.valueShapes[d];delete this.shapes[c];this.target.replaceWithShape(c,b);this.valueShapes[d]=b.id;this.shapes[b.id]=d},renderSlice:function(k,d){var m=this.target,q=this.options,l=this.radius,a=q.get("borderWidth"),g=q.get("offset"),b=2*Math.PI,p=this.values,n=this.total,j=g?(2*Math.PI)*(g/360):0,c,f,h,o,e;o=p.length;for(h=0;h<o;h++){c=j;f=j;if(n>0){f=j+(b*(p[h]/n))}if(k===h){e=q.get("sliceColors")[h%q.get("sliceColors").length];if(d){e=this.calcHighlightColor(e,q)}return m.drawPieSlice(l,l,l-a,c,f,undefined,e)}j=f}},render:function(){var g=this.target,d=this.values,e=this.options,a=this.radius,c=e.get("borderWidth"),b,f;if(!pie._super.render.call(this)){return}if(c){g.drawCircle(a,a,Math.floor(a-(c/2)),e.get("borderColor"),undefined,c).append()}for(f=d.length;f--;){if(d[f]){b=this.renderSlice(f).append();this.valueShapes[f]=b.id;this.shapes[b.id]=f}}g.render()}});