$.fn.sparkline.tristate=tristate=createClass($.fn.sparkline._base,barHighlightMixin,{type:"tristate",init:function(f,b,c,e,a){var d=parseInt(c.get("barWidth"),10),g=parseInt(c.get("barSpacing"),10);tristate._super.init.call(this,f,b,c,e,a);this.regionShapes={};this.barWidth=d;this.barSpacing=g;this.totalBarWidth=d+g;this.values=$.map(b,Number);this.width=e=(b.length*d)+((b.length-1)*g);if($.isArray(c.get("colorMap"))){this.colorMapByIndex=c.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=c.get("colorMap");if(this.colorMapByValue&&this.colorMapByValue.get===undefined){this.colorMapByValue=new RangeMap(this.colorMapByValue)}}this.initTarget()},getRegion:function(b,a,c){return Math.floor(a/this.totalBarWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===undefined,value:this.values[a],color:this.calcColor(this.values[a],a),offset:a}},calcColor:function(f,g){var b=this.values,e=this.options,h=this.colorMapByIndex,d=this.colorMapByValue,a,c;if(d&&(c=d.get(f))){a=c}else{if(h&&h.length>g){a=h[g]}else{if(b[g]<0){a=e.get("negBarColor")}else{if(b[g]>0){a=e.get("posBarColor")}else{a=e.get("zeroBarColor")}}}}return a},renderRegion:function(d,a){var i=this.values,k=this.options,e=this.target,c,j,f,h,g,b;c=e.pixelHeight;f=Math.round(c/2);h=d*this.totalBarWidth;if(i[d]<0){g=f;j=f-1}else{if(i[d]>0){g=0;j=f-1}else{g=f-1;j=2}}b=this.calcColor(i[d],d);if(b===null){return}if(a){b=this.calcHighlightColor(b,k)}return e.drawRect(h,g,this.barWidth-1,j-1,b,b)}});