var esprima=require("esprima");var escodegen=require("escodegen");var estraverse=require("estraverse");var SYNTAX=estraverse.Syntax;var STR_MIN_LENGTH=5;var STR_MIN_DIST=1000;var STR_MIN_COUNT=2;function createDeclaration(a){return{type:SYNTAX.VariableDeclaration,declarations:a,kind:"var"}}function createDeclarator(b,a){return{type:SYNTAX.VariableDeclarator,id:{type:SYNTAX.Identifier,name:b},init:{type:SYNTAX.Literal,value:a}}}function base54Digits(){return"etnrisouaflchpdvmgybwESxTNCkLAOM_DPHBjFIqRUzWXV$JKQGYZ0516372984"}var base54=(function(){var a=base54Digits();return function(c){var b="";var d=54;do{b+=a.charAt(c%d);c=Math.floor(c/d);d=64}while(c>0);return b}})();function mangleString(d){var a=esprima.parse(d,{loc:true});var c={};var b=0;estraverse.traverse(a,{enter:function(g,f){if(g.type===SYNTAX.Literal&&typeof g.value==="string"){if(f.type===SYNTAX.Property){return}var h=g.value;if(h.length>STR_MIN_LENGTH){if(!c[h]){c[h]={count:0,lastLoc:g.loc.start.line,name:"__echartsString__"+base54(b++)}}var i=g.loc.start.line-c[h].lastLoc;if(i>=STR_MIN_DIST){c[h].lastLoc=g.loc.start.line;c[h].count++}}}if(g.type===SYNTAX.MemberExpression&&!g.computed){if(g.property.type===SYNTAX.Identifier){var h=g.property.name;if(h.length>STR_MIN_LENGTH){if(!c[h]){c[h]={count:0,lastLoc:g.loc.start.line,name:"__echartsString__"+base54(b++)}}var i=g.loc.start.line-c[h].lastLoc;if(i>=STR_MIN_DIST){c[h].lastLoc=g.loc.start.line;c[h].count++}}}}}});estraverse.replace(a,{enter:function(g,f){if((g.type===SYNTAX.Literal&&typeof g.value==="string")){if(f.type===SYNTAX.Property){return}var h=g.value;if(c[h]&&c[h].count>STR_MIN_COUNT){return{type:SYNTAX.Identifier,name:c[h].name}}}if(g.type===SYNTAX.MemberExpression&&!g.computed){if(g.property.type===SYNTAX.Identifier){var h=g.property.name;if(c[h]&&c[h].count>STR_MIN_COUNT){return{type:SYNTAX.MemberExpression,object:g.object,property:{type:SYNTAX.Identifier,name:c[h].name},computed:true}}}}}});for(var e in c){if(c[e].count>STR_MIN_COUNT){a.body.unshift(createDeclaration([createDeclarator(c[e].name,e)]))}}return escodegen.generate(a,{format:{escapeless:true},comment:true})}exports=module.exports=mangleString;