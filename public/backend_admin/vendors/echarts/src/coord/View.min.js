define(function(d){var c=d("zrender/core/vector");var g=d("zrender/core/matrix");var b=d("zrender/mixin/Transformable");var e=d("zrender/core/util");var h=d("zrender/core/BoundingRect");var f=c.applyTransform;function i(){b.call(this)}e.mixin(i,b);function a(j){this.name=j;this.zoomLimit;b.call(this);this._roamTransform=new i();this._viewTransform=new i();this._center;this._zoom}a.prototype={constructor:a,type:"view",dimensions:["x","y"],setBoundingRect:function(k,m,l,j){this._rect=new h(k,m,l,j);return this._rect},getBoundingRect:function(){return this._rect},setViewRect:function(k,m,l,j){l=l;j=j;this.transformTo(k,m,l,j);this._viewRect=new h(k,m,l,j)},transformTo:function(k,o,m,j){var n=this.getBoundingRect();var l=this._viewTransform;l.transform=n.calculateTransform(new h(k,o,m,j));l.decomposeTransform();this._updateTransform()},setCenter:function(j){if(!j){return}this._center=j;this._updateCenterAndZoom()},setZoom:function(k){k=k||1;var j=this.zoomLimit;if(j){if(j.max!=null){k=Math.min(j.max,k)}if(j.min!=null){k=Math.max(j.min,k)}}this._zoom=k;this._updateCenterAndZoom()},getDefaultCenter:function(){var k=this.getBoundingRect();var j=k.x+k.width/2;var l=k.y+k.height/2;return[j,l]},getCenter:function(){return this._center||this.getDefaultCenter()},getZoom:function(){return this._zoom||1},getRoamTransform:function(){return this._roamTransform},_updateCenterAndZoom:function(){var l=this._viewTransform.getLocalTransform();var k=this._roamTransform;var n=this.getDefaultCenter();var j=this.getCenter();var m=this.getZoom();j=c.applyTransform([],j,l);n=c.applyTransform([],n,l);k.origin=j;k.position=[n[0]-j[0],n[1]-j[1]];k.scale=[m,m];this._updateTransform()},_updateTransform:function(){var j=this._roamTransform;var k=this._viewTransform;k.parent=j;j.updateTransform();k.updateTransform();k.transform&&g.copy(this.transform||(this.transform=[]),k.transform);if(this.transform){this.invTransform=this.invTransform||[];g.invert(this.invTransform,this.transform)}else{this.invTransform=null}this.decomposeTransform()},getViewRect:function(){return this._viewRect},getViewRectAfterRoam:function(){var j=this.getBoundingRect().clone();j.applyTransform(this.transform);return j},dataToPoint:function(k){var j=this.transform;return j?f([],k,j):[k[0],k[1]]},pointToData:function(j){var k=this.invTransform;return k?f([],j,k):[j[0],j[1]]}};e.mixin(a,b);return a});