define(function(b){var f=b("./Geo");var g=b("../../util/layout");var c=b("zrender/core/util");var e={};function a(l,m){var n=this.getBoundingRect();var o=l.getBoxLayoutParams();o.aspect=n.width/n.height*0.75;var k=g.getLayoutRect(o,{width:m.getWidth(),height:m.getHeight()});this.setViewRect(k.x,k.y,k.width,k.height);this.setCenter(l.get("center"));this.setZoom(l.get("zoom"))}function i(l,k){c.each(k.get("geoCoord"),function(n,m){l.addGeoCoord(m,n)})}function h(k){console.error("Map "+k+" not exists")}var j={dimensions:f.prototype.dimensions,create:function(k,n){var m=[];k.eachComponent("geo",function(q,o){var p=q.get("map");var s=e[p];if(!s){h(p)}var r=new f(p+o,p,s&&s.geoJson,s&&s.specialAreas,q.get("nameMap"));r.zoomLimit=q.get("scaleLimit");m.push(r);i(r,q);q.coordinateSystem=r;r.model=q;r.resize=a;r.resize(q,n)});k.eachSeries(function(o){var q=o.get("coordinateSystem");if(q==="geo"){var p=o.get("geoIndex")||0;o.coordinateSystem=m[p]}});var l={};k.eachSeriesByType("map",function(o){var p=o.get("map");l[p]=l[p]||[];l[p].push(o)});c.each(l,function(s,o){var r=e[o];if(!r){h(name)}var q=c.map(s,function(t){return t.get("nameMap")});var p=new f(o,o,r&&r.geoJson,r&&r.specialAreas,c.mergeAll(q));p.zoomLimit=c.retrieve.apply(null,c.map(s,function(t){return t.get("scaleLimit")}));m.push(p);p.resize=a;p.resize(s[0],n);c.each(s,function(t){t.coordinateSystem=p;i(p,t)})});return m},registerMap:function(l,k,m){if(k.geoJson&&!k.features){m=k.specialAreas;k=k.geoJson}if(typeof k==="string"){k=(typeof JSON!=="undefined"&&JSON.parse)?JSON.parse(k):(new Function("return ("+k+");"))()}e[l]={geoJson:k,specialAreas:m}},getMap:function(k){return e[k]},getFilledRegions:function(r,q){var m=(r||[]).slice();var l=j.getMap(q);var o=l&&l.geoJson;var s={};var n=o.features;for(var p=0;p<m.length;p++){s[m[p].name]=m[p]}for(var p=0;p<n.length;p++){var k=n[p].properties.name;if(!s[k]){m.push({name:k})}}return m}};var d=b("../../echarts");d.registerMap=j.registerMap;d.getMap=j.getMap;d.loadMap=function(){};d.registerCoordinateSystem("geo",j);return j});