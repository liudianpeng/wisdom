define(function(e){var b=e("./parseGeoJson");var a=e("zrender/core/util");var d=e("zrender/core/BoundingRect");var g=e("../View");var c=[e("./fix/nanhai"),e("./fix/textCoord"),e("./fix/geoCoord")];function f(i,k,h,j,l){g.call(this,i);this.map=k;this._nameCoordMap={};this.loadGeoJson(h,j,l)}f.prototype={constructor:f,type:"geo",dimensions:["lng","lat"],containCoord:function(k){var j=this.regions;for(var h=0;h<j.length;h++){if(j[h].contain(k)){return true}}return false},loadGeoJson:function(k,m,p){try{this.regions=k?b(k):[]}catch(o){throw"Invalid geoJson format\n"+o}m=m||{};p=p||{};var j=this.regions;var q={};for(var l=0;l<j.length;l++){var h=j[l].name;h=p[h]||h;j[l].name=h;q[h]=j[l];this.addGeoCoord(h,j[l].center);var n=m[h];if(n){j[l].transformTo(n.left,n.top,n.width,n.height)}}this._regionsMap=q;this._rect=null;a.each(c,function(i){i(this)},this)},transformTo:function(i,n,k,h){var l=this.getBoundingRect();l=l.clone();l.y=-l.y-l.height;var j=this._viewTransform;j.transform=l.calculateTransform(new d(i,n,k,h));j.decomposeTransform();var m=j.scale;m[1]=-m[1];j.updateTransform();this._updateTransform()},getRegion:function(h){return this._regionsMap[h]},getRegionByCoord:function(k){var j=this.regions;for(var h=0;h<j.length;h++){if(j[h].contain(k)){return j[h]}}},addGeoCoord:function(h,i){this._nameCoordMap[h]=i},getGeoCoord:function(h){return this._nameCoordMap[h]},getBoundingRect:function(){if(this._rect){return this._rect}var k;var l=this.regions;for(var j=0;j<l.length;j++){var h=l[j].getBoundingRect();k=k||h.clone();k.union(h)}return(this._rect=k||new d(0,0,0,0))},dataToPoints:function(i){var h=[];return i.mapArray(["lng","lat"],function(k,j){h[0]=k;h[1]=j;return this.dataToPoint(h)},this)},dataToPoint:function(h){if(typeof h==="string"){h=this.getGeoCoord(h)}if(h){return g.prototype.dataToPoint.call(this,h)}}};a.mixin(f,g);return f});