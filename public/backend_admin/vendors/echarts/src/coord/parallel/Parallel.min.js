define(function(c){var e=c("../../util/layout");var f=c("../../coord/axisHelper");var d=c("zrender/core/util");var g=c("./ParallelAxis");var i=c("zrender/core/matrix");var a=c("zrender/core/vector");var h=d.each;var j=Math.PI;function b(l,k,m){this._axesMap={};this._axesLayout={};this.dimensions=l.dimensions;this._rect;this._model=l;this._init(l,k,m)}b.prototype={type:"parallel",constructor:b,_init:function(m,k,n){var o=m.dimensions;var l=m.parallelAxisIndex;h(o,function(u,p){var s=l[p];var r=k.getComponent("parallelAxis",s);var t=this._axesMap[u]=new g(u,f.createScaleByModel(r),[0,0],r.get("type"),s);var q=t.type==="category";t.onBand=q&&r.get("boundaryGap");t.inverse=r.get("inverse");r.axis=t;t.model=r},this)},update:function(k,l){this._updateAxesFromSeries(this._model,k)},_updateAxesFromSeries:function(l,k){k.eachSeries(function(m){if(!l.contains(m,k)){return}var n=m.getData();h(this.dimensions,function(p){var o=this._axesMap[p];o.scale.unionExtent(n.getDataExtent(p));f.niceScaleExtent(o,o.model)},this)},this)},resize:function(k,l){this._rect=e.getLayoutRect(k.getBoxLayoutParams(),{width:l.getWidth(),height:l.getHeight()});this._layoutAxes(k)},getRect:function(){return this._rect},_layoutAxes:function(l){var s=this._rect;var q=l.get("layout");var r=this._axesMap;var k=this.dimensions;var t=[s.width,s.height];var o=q==="horizontal"?0:1;var m=t[o];var p=t[1-o];var n=[0,p];h(r,function(v){var u=v.inverse?1:0;v.setExtent(n[u],n[1-u])});h(k,function(A,v){var B=m*v/(k.length-1);var z={horizontal:{x:B,y:p},vertical:{x:0,y:B}};var y={horizontal:j/2,vertical:0};var u=[z[q].x+s.x,z[q].y+s.y];var x=y[q];var w=i.create();i.rotate(w,w,x);i.translate(w,w,u);this._axesLayout[A]={position:u,rotation:x,transform:w,tickDirection:1,labelDirection:1}},this)},getAxis:function(k){return this._axesMap[k]},dataToPoint:function(k,l){return this.axisCoordToPoint(this._axesMap[l].dataToCoord(k),l)},eachActiveState:function(q,w,m){var k=this.dimensions;var u=this._axesMap;var t=false;for(var o=0,x=k.length;o<x;o++){if(u[k[o]].model.getActiveState()!=="normal"){t=true}}for(var p=0,s=q.count();p<s;p++){var v=q.getValues(k,p);var r;if(!t){r="normal"}else{r="active";for(var o=0,x=k.length;o<x;o++){var n=k[o];var l=u[n].model.getActiveState(v[o],o);if(l==="inactive"){r="inactive";break}}}w.call(m,r,p)}},axisCoordToPoint:function(n,m){var l=this._axesLayout[m];var k=[n,0];a.applyTransform(k,k,l.transform);return k},getAxisLayout:function(k){return d.clone(this._axesLayout[k])}};return b});