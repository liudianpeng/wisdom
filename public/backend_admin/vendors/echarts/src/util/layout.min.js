define(function(d){var f=d("zrender/core/util");var j=d("zrender/core/BoundingRect");var c=d("./number");var b=d("./format");var g=c.parsePercent;var i=f.each;var h={};var a=["left","right","top","bottom","width","height"];function e(m,p,r,o,n){var k=0;var q=0;if(o==null){o=Infinity}if(n==null){n=Infinity}var l=0;p.eachChild(function(u,z){var x=u.position;var y=u.getBoundingRect();var t=p.childAt(z+1);var s=t&&t.getBoundingRect();var B;var A;if(m==="horizontal"){var w=y.width+(s?(-s.x+y.x):0);B=k+w;if(B>o||u.newline){k=0;B=w;q+=l+r;l=y.height}else{l=Math.max(l,y.height)}}else{var v=y.height+(s?(-s.y+y.y):0);A=q+v;if(A>n||u.newline){k+=l+r;q=0;A=v;l=y.width}else{l=Math.max(l,y.width)}}if(u.newline){return}x[0]=k;x[1]=q;m==="horizontal"?(k=B+r):(q=A+r)})}h.box=e;h.vbox=f.curry(e,"vertical");h.hbox=f.curry(e,"horizontal");h.getAvailableSize=function(k,q,m){var p=q.width;var s=q.height;var r=g(k.x,p);var o=g(k.y,s);var l=g(k.x2,p);var n=g(k.y2,s);(isNaN(r)||isNaN(parseFloat(k.x)))&&(r=0);(isNaN(l)||isNaN(parseFloat(k.x2)))&&(l=p);(isNaN(o)||isNaN(parseFloat(k.y)))&&(o=0);(isNaN(n)||isNaN(parseFloat(k.y2)))&&(n=s);m=b.normalizeCssArray(m||0);return{width:Math.max(l-r-m[1]-m[3],0),height:Math.max(n-o-m[0]-m[2],0)}};h.getLayoutRect=function(m,u,p){p=b.normalizeCssArray(p||0);var t=u.width;var y=u.height;var o=g(m.left,t);var s=g(m.top,y);var v=g(m.right,t);var l=g(m.bottom,y);var n=g(m.width,t);var w=g(m.height,y);var x=p[2]+p[0];var q=p[1]+p[3];var k=m.aspect;if(isNaN(n)){n=t-v-q-o}if(isNaN(w)){w=y-l-x-s}if(isNaN(n)&&isNaN(w)){if(k>t/y){n=t*0.8}else{w=y*0.8}}if(k!=null){if(isNaN(n)){n=k*w}if(isNaN(w)){w=n/k}}if(isNaN(o)){o=t-v-n-q}if(isNaN(s)){s=y-l-w-x}switch(m.left||m.right){case"center":o=t/2-n/2-p[3];break;case"right":o=t-n-q;break}switch(m.top||m.bottom){case"middle":case"center":s=y/2-w/2-p[0];break;case"bottom":s=y-w-x;break}o=o||0;s=s||0;if(isNaN(n)){n=t-o-(v||0)}if(isNaN(w)){w=y-s-(l||0)}var r=new j(o+p[3],s+p[0],n,w);r.margin=p;return r};h.positionGroup=function(o,m,k,n){var l=o.getBoundingRect();m=f.extend(f.clone(m),{width:l.width,height:l.height});m=h.getLayoutRect(m,k,n);o.position=[m.x-l.x,m.y-l.y]};h.mergeLayoutParam=function(l,p,n){!f.isObject(n)&&(n={});var o=["width","left","right"];var r=["height","top","bottom"];var s=t(o);var m=t(r);k(o,l,s);k(r,l,m);function t(A){var C={};var B=0;var v={};var z=0;var y=n.ignoreSize?1:2;i(A,function(D){v[D]=l[D]});i(A,function(D){q(p,D)&&(C[D]=v[D]=p[D]);u(C,D)&&B++;u(v,D)&&z++});if(z===y||!B){return v}else{if(B>=y){return C}else{for(var x=0;x<A.length;x++){var w=A[x];if(!q(C,w)&&q(l,w)){C[w]=l[w];break}}return C}}}function q(w,v){return w.hasOwnProperty(v)}function u(w,v){return w[v]!=null&&w[v]!=="auto"}function k(x,w,v){i(x,function(y){w[y]=v[y]})}};h.getLayoutParams=function(k){return h.copyLayoutParams({},k)};h.copyLayoutParams=function(l,k){k&&l&&i(a,function(m){k.hasOwnProperty(m)&&(l[m]=k[m])});return l};return h});