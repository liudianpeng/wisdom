define(function(e){var b=e("zrender/core/util");var d=e("./clazz");var c=d.parseClassType;var f=0;var g={};var a="_";g.getUID=function(h){return[(h||""),f++,Math.random()].join(a)};g.enableSubTypeDefaulter=function(h){var i={};h.registerSubTypeDefaulter=function(k,j){k=c(k);i[k.main]=j};h.determineSubType=function(j,l){var k=l.type;if(!k){var m=c(j).main;if(h.hasSubTypes(j)&&i[m]){k=i[m](l)}}return k};return h};g.enableTopologicalTravel=function(k,j){k.topologicalTravel=function(s,m,v,o){if(!s.length){return}var y=i(m);var w=y.graph;var t=y.noEntryList;var r={};b.each(s,function(z){r[z]=true});while(t.length){var x=t.pop();var p=w[x];var q=!!r[x];if(q){v.call(o,x,p.originalDeps.slice());delete r[x]}b.each(p.successor,q?u:n)}b.each(r,function(){throw new Error("Circle dependency may exists")});function n(z){w[z].entryCount--;if(w[z].entryCount===0){t.push(z)}}function u(z){r[z]=true;n(z)}};function i(o){var n={};var m=[];b.each(o,function(p){var q=h(n,p);var s=q.originalDeps=j(p);var r=l(s,o);q.entryCount=r.length;if(q.entryCount===0){m.push(p)}b.each(r,function(t){if(b.indexOf(q.predecessor,t)<0){q.predecessor.push(t)}var u=h(n,t);if(b.indexOf(u.successor,t)<0){u.successor.push(p)}})});return{graph:n,noEntryList:m}}function h(n,m){if(!n[m]){n[m]={predecessor:[],successor:[]}}return n[m]}function l(n,o){var m=[];b.each(n,function(p){b.indexOf(o,p)>=0&&m.push(p)});return m}};return g});