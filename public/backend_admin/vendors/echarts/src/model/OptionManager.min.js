define(function(e){var h=e("zrender/core/util");var o=e("../util/model");var g=e("./Component");var n=h.each;var l=h.clone;var a=h.map;var m=h.merge;var k=/^(min|max)?(.+)$/;function c(p){this._api=p;this._timelineOptions=[];this._mediaList=[];this._mediaDefault;this._currentMediaIndices=[];this._optionBackup;this._newBaseOption}c.prototype={constructor:c,setOption:function(q,s){q=l(q,true);var p=this._optionBackup;var r=d.call(this,q,s);this._newBaseOption=r.baseOption;if(p){i(p.baseOption,r.baseOption);if(r.timelineOptions.length){p.timelineOptions=r.timelineOptions}if(r.mediaList.length){p.mediaList=r.mediaList}if(r.mediaDefault){p.mediaDefault=r.mediaDefault}}else{this._optionBackup=r}},mountOption:function(q){var p=this._optionBackup;this._timelineOptions=a(p.timelineOptions,l);this._mediaList=a(p.mediaList,l);this._mediaDefault=l(p.mediaDefault);this._currentMediaIndices=[];return l(q?p.baseOption:this._newBaseOption)},getTimelineOption:function(p){var r;var q=this._timelineOptions;if(q.length){var s=p.getComponent("timeline");if(s){r=l(q[s.getCurrentIndex()],true)}}return r},getMediaOption:function(s){var p=this._api.getWidth();var r=this._api.getHeight();var v=this._mediaList;var u=this._mediaDefault;var w=[];var x=[];if(!v.length&&!u){return x}for(var q=0,t=v.length;q<t;q++){if(j(v[q].query,p,r)){w.push(q)}}if(!w.length&&u){w=[-1]}if(w.length&&!f(w,this._currentMediaIndices)){x=a(w,function(y){return l(y===-1?u.option:v[y].option)})}this._currentMediaIndices=w;return x}};function d(u,w){var r=[];var q=[];var p;var t;var s=u.timeline;if(u.baseOption){t=u.baseOption}if(s||u.options){t=t||{};r=(u.options||[]).slice()}if(u.media){t=t||{};var v=u.media;n(v,function(x){if(x&&x.option){if(x.query){q.push(x)}else{if(!p){p=x}}}})}if(!t){t=u}if(!t.timeline){t.timeline=s}n([t].concat(r).concat(h.map(q,function(x){return x.option})),function(x){n(w,function(y){y(x)})});return{baseOption:t,timelineOptions:r,mediaDefault:p,mediaList:q}}function j(s,q,t){var p={width:q,height:t,aspectratio:q/t};var r=true;h.each(s,function(y,w){var v=w.match(k);if(!v||!v[1]||!v[2]){return}var x=v[1];var u=v[2].toLowerCase();if(!b(p[u],y,x)){r=false}});return r}function b(r,q,p){if(p==="min"){return r>=q}else{if(p==="max"){return r<=q}else{return r===q}}}function f(q,p){return q.join(",")===p.join(",")}function i(p,q){q=q||{};n(q,function(t,u){if(t==null){return}var s=p[u];if(!g.hasClass(u)){p[u]=m(s,t,true)}else{t=o.normalizeToArray(t);s=o.normalizeToArray(s);var r=o.mappingToExists(s,t);p[u]=a(r,function(v){return(v.option&&v.exist)?m(v.exist,v.option,true):(v.exist||v.option)})}})}return c});