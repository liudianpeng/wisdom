define(function(b){var c=b("zrender/core/util");var a=b("../model/Model");var h=b("./List");var i=b("./helper/linkList");var g=b("./helper/completeDimensions");var f=function(j,k){this.name=j||"";this.depth=0;this.height=0;this.parentNode=null;this.dataIndex=-1;this.children=[];this.viewChildren=[];this.hostTree=k};f.prototype={constructor:f,isRemoved:function(){return this.dataIndex<0},eachNode:function(m,k,p){if(typeof m==="function"){p=k;k=m;m=null}m=m||{};if(c.isString(m)){m={order:m}}var j=m.order||"preorder";var o=this[m.attr||"children"];var l;j==="preorder"&&(l=k.call(p,this));for(var n=0;!l&&n<o.length;n++){o[n].eachNode(m,k,p)}j==="postorder"&&k.call(p,this)},updateDepthAndHeight:function(l){var j=0;this.depth=l;for(var k=0;k<this.children.length;k++){var m=this.children[k];m.updateDepthAndHeight(l+1);if(m.height>j){j=m.height}}this.height=j+1},getNodeById:function(n){if(this.getId()===n){return this}for(var m=0,l=this.children,j=l.length;m<j;m++){var k=l[m].getNodeById(n);if(k){return k}}},contains:function(n){if(n===this){return true}for(var m=0,l=this.children,j=l.length;m<j;m++){var k=l[m].contains(n);if(k){return k}}},getAncestors:function(j){var k=[];var l=j?this:this.parentNode;while(l){k.push(l);l=l.parentNode}k.reverse();return k},getValue:function(k){var j=this.hostTree.data;return j.get(j.getDimension(k||"value"),this.dataIndex)},setLayout:function(j,k){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,j,k)},getLayout:function(){return this.hostTree.data.getItemLayout(this.dataIndex)},getModel:function(l){if(this.dataIndex<0){return}var k=this.hostTree;var j=k.data.getItemModel(this.dataIndex);var m=this.getLevelModel();return j.getModel(l,(m||k.hostModel).getModel(l))},getLevelModel:function(){return(this.hostTree.levelModels||[])[this.depth]},setVisual:function(j,k){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,j,k)},getVisual:function(k,j){return this.hostTree.data.getItemVisual(this.dataIndex,k,j)},getRawIndex:function(){return this.hostTree.data.getRawIndex(this.dataIndex)},getId:function(){return this.hostTree.data.getId(this.dataIndex)}};function d(j,k){this.root;this.data;this._nodes=[];this.hostModel=j;this.levelModels=c.map(k||[],function(l){return new a(l,j,j.ecModel)})}d.prototype={constructor:d,type:"tree",eachNode:function(k,j,l){this.root.eachNode(k,j,l)},getNodeByDataIndex:function(k){var j=this.data.getRawIndex(k);return this._nodes[j]},getNodeByName:function(j){return this.root.getNodeByName(j)},update:function(){var m=this.data;var k=this._nodes;for(var l=0,j=k.length;l<j;l++){k[l].dataIndex=-1}for(var l=0,j=m.count();l<j;l++){k[m.getRawIndex(l)].dataIndex=l}},clearLayouts:function(){this.data.clearItemLayouts()}};d.createTree=function(p,o,q){var j=new d(o,q);var n=[];k(p);function k(s,r){n.push(s);var v=new f(s.name,j);r?e(v,r):(j.root=v);j._nodes.push(v);var u=s.children;if(u){for(var t=0;t<u.length;t++){k(u[t],v)}}}j.root.updateDepthAndHeight(0);var l=g([{name:"value"}],n);var m=new h(l,o);m.initData(n);i({mainData:m,struct:j,structAttr:"tree"});j.update();return j};function e(l,k){var j=k.children;if(l.parentNode===k){return}j.push(l);l.parentNode=k}return d});