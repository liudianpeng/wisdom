define(function(g){var q="undefined";var r=typeof window==="undefined"?global:window;var c=typeof r.Float64Array===q?Array:r.Float64Array;var h=typeof r.Int32Array===q?Array:r.Int32Array;var o={"float":c,"int":h,ordinal:Array,number:Array,time:Array};var j=g("../model/Model");var b=g("./DataDiffer");var m=g("zrender/core/util");var l=g("../util/model");var i=m.isObject;var e=["stackedOn","_nameList","_idList","_rawData"];var p=function(t,s){m.each(e.concat(s.__wrappedMethods||[]),function(u){if(s.hasOwnProperty(u)){t[u]=s[u]}});t.__wrappedMethods=s.__wrappedMethods};var a=function(u,y){u=u||["x","y"];var x={};var w=[];for(var t=0;t<u.length;t++){var s;var v={};if(typeof u[t]==="string"){s=u[t];v={name:s,stackable:false,type:"number"}}else{v=u[t];s=v.name;v.type=v.type||"number"}w.push(s);x[s]=v}this.dimensions=w;this._dimensionInfos=x;this.hostModel=y;this.dataType;this.indices=[];this._storage={};this._nameList=[];this._idList=[];this._optionModels=[];this.stackedOn=null;this._visual={};this._layout={};this._itemVisuals=[];this._itemLayouts=[];this._graphicEls=[];this._rawData;this._extent};var k=a.prototype;k.type="list";k.getDimension=function(s){if(!isNaN(s)){s=this.dimensions[s]||s}return s};k.getDimensionInfo=function(s){return m.clone(this._dimensionInfos[this.getDimension(s)])};k.initData=function(K,H,x){K=K||[];if(!m.isArray(K)){throw new Error("Invalid data.")}this._rawData=K;var G=this._storage={};var t=this.indices=[];var v=this.dimensions;var z=K.length;var I=this._dimensionInfos;var B=[];var J={};H=H||[];for(var E=0;E<v.length;E++){var s=I[v[E]];var F=o[s.type];G[v[E]]=new F(z)}x=x||function(M,Q,N,P){var O=l.getDataItemValue(M);return l.converDataValue(m.isArray(O)?O[P]:O,I[Q])};for(var y=0;y<K.length;y++){var w=K[y];for(var C=0;C<v.length;C++){var D=v[C];var u=G[D];u[y]=x(w,D,y,C)}t.push(y)}for(var E=0;E<K.length;E++){var A="";if(!H[E]){H[E]=K[E].name;A=K[E].id}var L=H[E]||"";if(!A&&L){J[L]=J[L]||0;A=L;if(J[L]>0){A+="__ec__"+J[L]}J[L]++}A&&(B[E]=A)}this._nameList=H;this._idList=B};k.count=function(){return this.indices.length};k.get=function(t,z,w){var u=this._storage;var x=this.indices[z];if(x==null){return NaN}var y=u[t]&&u[t][x];if(w){var s=this._dimensionInfos[t];if(s&&s.stackable){var v=this.stackedOn;while(v){var A=v.get(t,z);if((y>=0&&A>0)||(y<=0&&A<0)){y+=A}v=v.stackedOn}}}return y};k.getValues=function(x,u,t){var v=[];if(!m.isArray(x)){t=u;u=x;x=this.dimensions}for(var w=0,s=x.length;w<s;w++){v.push(this.get(x[w],u,t))}return v};k.hasValue=function(t){var v=this.dimensions;var w=this._dimensionInfos;for(var u=0,s=v.length;u<s;u++){if(w[v[u]].type!=="ordinal"&&isNaN(this.get(v[u],t))){return false}}return true};k.getDataExtent=function(u,z){var x=this._storage[u];var v=this.getDimensionInfo(u);z=(v&&v.stackable)&&z;var y=(this._extent||(this._extent={}))[u+(!!z)];var B;if(y){return y}if(x){var s=Infinity;var A=-Infinity;for(var t=0,w=this.count();t<w;t++){B=this.get(u,t,z);B<s&&(s=B);B>A&&(A=B)}return(this._extent[u+z]=[s,A])}else{return[Infinity,-Infinity]}};k.getSum=function(y,t){var u=this._storage[y];var w=0;if(u){for(var v=0,s=this.count();v<s;v++){var x=this.get(y,v,t);if(!isNaN(x)){w+=x}}}return w};k.indexOf=function(x,w){var z=this._storage;var t=z[x];var y=this.indices;if(t){for(var v=0,s=y.length;v<s;v++){var u=y[v];if(t[u]===w){return v}}}return -1};k.indexOfName=function(u){var x=this.indices;var w=this._nameList;for(var v=0,s=x.length;v<s;v++){var t=x[v];if(w[t]===u){return v}}return -1};k.indexOfNearest=function(t,A,y){var v=this._storage;var x=v[t];if(x){var B=Number.MAX_VALUE;var C=-1;for(var s=0,u=this.count();s<u;s++){var z=A-this.get(t,s,y);var w=Math.abs(z);if(w<B||(w===B&&z>0)){B=w;C=s}}return C}return -1};k.getRawIndex=function(s){var t=this.indices[s];return t==null?-1:t};k.getRawDataItem=function(s){return this._rawData[this.getRawIndex(s)]};k.getName=function(s){return this._nameList[this.indices[s]]||""};k.getId=function(s){return this._idList[this.indices[s]]||(this.getRawIndex(s)+"")};function n(s){if(!m.isArray(s)){s=[s]}return s}k.each=function(s,v,y,t){if(typeof s==="function"){t=y;y=v;v=s;s=[]}s=m.map(n(s),this.getDimension,this);var z=[];var u=s.length;var A=this.indices;t=t||this;for(var x=0;x<A.length;x++){if(u===0){v.call(t,x)}else{if(u===1){v.call(t,this.get(s[0],x,y),x)}else{for(var w=0;w<u;w++){z[w]=this.get(s[w],x,y)}z[w]=x;v.apply(t,z)}}}};k.filterSelf=function(t,x,A,u){if(typeof t==="function"){u=A;A=x;x=t;t=[]}t=m.map(n(t),this.getDimension,this);var w=[];var B=[];var v=t.length;var C=this.indices;u=u||this;for(var z=0;z<C.length;z++){var s;if(v===1){s=x.call(u,this.get(t[0],z,A),z)}else{for(var y=0;y<v;y++){B[y]=this.get(t[y],z,A)}B[y]=z;s=x.apply(u,B)}if(s){w.push(C[z])}}this.indices=w;this._extent={};return this};k.mapArray=function(w,u,t,v){if(typeof w==="function"){v=t;t=u;u=w;w=[]}var s=[];this.each(w,function(){s.push(u&&u.apply(this,arguments))},t,v);return s};function f(t,u){var A=t.dimensions;var y=new a(m.map(A,t.getDimensionInfo,t),t.hostModel);p(y,t);var x=y._storage={};var z=t._storage;for(var v=0;v<A.length;v++){var w=A[v];var s=z[w];if(m.indexOf(u,w)>=0){x[w]=new s.constructor(z[w].length)}else{x[w]=z[w]}}return y}k.map=function(w,t,s,v){w=m.map(n(w),this.getDimension,this);var x=f(this,w);var y=x.indices=this.indices;var z=x._storage;var u=[];this.each(w,function(){var A=arguments[arguments.length-1];var E=t&&t.apply(this,arguments);if(E!=null){if(typeof E==="number"){u[0]=E;E=u}for(var B=0;B<E.length;B++){var D=w[B];var C=z[D];var F=y[A];if(C){C[F]=E[B]}}}},s,v);return x};k.downSample=function(H,J,G,w){var E=f(this,[H]);var F=this._storage;var t=E._storage;var s=this.indices;var v=E.indices=[];var I=[];var u=[];var A=Math.floor(1/J);var x=t[H];var D=this.count();for(var C=0;C<F[H].length;C++){t[H][C]=F[H][C]}for(var C=0;C<D;C+=A){if(A>D-C){A=D-C;I.length=A}for(var B=0;B<A;B++){var y=s[C+B];I[B]=x[y];u[B]=y}var z=G(I);var y=u[w(I,z)||0];x[y]=z;v.push(y)}return E};k.getItemModel=function(s){var t=this.hostModel;s=this.indices[s];return new j(this._rawData[s],t,t&&t.ecModel)};k.diff=function(t){var u=this._idList;var s=t&&t._idList;return new b(t?t.indices:[],this.indices,function(v){return s[v]||(v+"")},function(v){return u[v]||(v+"")})};k.getVisual=function(s){var t=this._visual;return t&&t[s]};k.setVisual=function(t,u){if(i(t)){for(var s in t){if(t.hasOwnProperty(s)){this.setVisual(s,t[s])}}return}this._visual=this._visual||{};this._visual[t]=u};k.setLayout=function(t,u){if(i(t)){for(var s in t){if(t.hasOwnProperty(s)){this.setLayout(s,t[s])}}return}this._layout[t]=u};k.getLayout=function(s){return this._layout[s]};k.getItemLayout=function(s){return this._itemLayouts[s]};k.setItemLayout=function(s,t,u){this._itemLayouts[s]=u?m.extend(this._itemLayouts[s]||{},t):t};k.clearItemLayouts=function(){this._itemLayouts.length=0};k.getItemVisual=function(s,u,t){var v=this._itemVisuals[s];var w=v&&v[u];if(w==null&&!t){return this.getVisual(u)}return w};k.setItemVisual=function(s,u,w){var v=this._itemVisuals[s]||{};this._itemVisuals[s]=v;if(i(u)){for(var t in u){if(u.hasOwnProperty(t)){v[t]=u[t]}}return}v[u]=w};var d=function(s){s.seriesIndex=this.seriesIndex;s.dataIndex=this.dataIndex;s.dataType=this.dataType};k.setItemGraphicEl=function(s,t){var u=this.hostModel;if(t){t.dataIndex=s;t.dataType=this.dataType;t.seriesIndex=u&&u.seriesIndex;if(t.type==="group"){t.traverse(d,t)}}this._graphicEls[s]=t};k.getItemGraphicEl=function(s){return this._graphicEls[s]};k.eachItemGraphicEl=function(s,t){m.each(this._graphicEls,function(v,u){if(v){s&&s.call(t,v,u)}})};k.cloneShallow=function(){var s=m.map(this.dimensions,this.getDimensionInfo,this);var t=new a(s,this.hostModel);t._storage=this._storage;p(t,this);t.indices=this.indices.slice();return t};k.wrapMethod=function(s,t){var u=this[s];if(typeof u!=="function"){return}this.__wrappedMethods=this.__wrappedMethods||[];this.__wrappedMethods.push(s);this[s]=function(){var v=u.apply(this,arguments);return t.apply(this,[v].concat(m.slice(arguments)))}};k.TRANSFERABLE_METHODS=["cloneShallow","downSample","map"];k.CHANGABLE_METHODS=["filterSelf"];return a});