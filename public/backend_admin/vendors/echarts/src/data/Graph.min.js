define(function(f){var b=f("zrender/core/util");var c=function(h){this._directed=h||false;this.nodes=[];this.edges=[];this._nodesMap={};this._edgesMap={};this.data;this.edgeData};var g=c.prototype;g.type="graph";g.isDirected=function(){return this._directed};g.addNode=function(k,h){k=k||(""+h);var j=this._nodesMap;if(j[k]){return}var i=new e(k,h);i.hostGraph=this;this.nodes.push(i);j[k]=i;return i};g.getNodeByIndex=function(h){var i=this.data.getRawIndex(h);return this.nodes[i]};g.getNodeById=function(h){return this._nodesMap[h]};g.addEdge=function(l,k,j){var n=this._nodesMap;var h=this._edgesMap;if(typeof l==="number"){l=this.nodes[l]}if(typeof k==="number"){k=this.nodes[k]}if(!(l instanceof e)){l=n[l]}if(!(k instanceof e)){k=n[k]}if(!l||!k){return}var i=l.id+"-"+k.id;if(h[i]){return}var m=new d(l,k,j);m.hostGraph=this;if(this._directed){l.outEdges.push(m);k.inEdges.push(m)}l.edges.push(m);if(l!==k){k.edges.push(m)}this.edges.push(m);h[i]=m;return m};g.getEdgeByIndex=function(h){var i=this.edgeData.getRawIndex(h);return this.edges[i]};g.getEdge=function(j,i){if(j instanceof e){j=j.id}if(i instanceof e){i=i.id}var h=this._edgesMap;if(this._directed){return h[j+"-"+i]}else{return h[j+"-"+i]||h[i+"-"+j]}};g.eachNode=function(j,m){var k=this.nodes;var h=k.length;for(var l=0;l<h;l++){if(k[l].dataIndex>=0){j.call(m,k[l],l)}}};g.eachEdge=function(j,m){var k=this.edges;var h=k.length;for(var l=0;l<h;l++){if(k[l].dataIndex>=0&&k[l].node1.dataIndex>=0&&k[l].node2.dataIndex>=0){j.call(m,k[l],l)}}};g.breadthFirstTraverse=function(l,k,r,h){if(!(k instanceof e)){k=this._nodesMap[k]}if(!k){return}var s=r==="out"?"outEdges":(r==="in"?"inEdges":"edges");for(var o=0;o<this.nodes.length;o++){this.nodes[o].__visited=false}if(l.call(h,k,null)){return}var p=[k];while(p.length){var j=p.shift();var n=j[s];for(var o=0;o<n.length;o++){var q=n[o];var m=q.node1===j?q.node2:q.node1;if(!m.__visited){if(l.call(m,m,j)){return}p.push(m);m.__visited=true}}}};g.update=function(){var n=this.data;var m=this.edgeData;var k=this.nodes;var j=this.edges;for(var l=0,h=k.length;l<h;l++){k[l].dataIndex=-1}for(var l=0,h=n.count();l<h;l++){k[n.getRawIndex(l)].dataIndex=l}m.filterSelf(function(i){var o=j[m.getRawIndex(i)];return o.node1.dataIndex>=0&&o.node2.dataIndex>=0});for(var l=0,h=j.length;l<h;l++){j[l].dataIndex=-1}for(var l=0,h=m.count();l<h;l++){j[m.getRawIndex(l)].dataIndex=l}};g.clone=function(){var l=new c(this._directed);var j=this.nodes;var h=this.edges;for(var k=0;k<j.length;k++){l.addNode(j[k].id,j[k].dataIndex)}for(var k=0;k<h.length;k++){var m=h[k];l.addEdge(m.node1.id,m.node2.id,m.dataIndex)}return l};function e(i,h){this.id=i==null?"":i;this.inEdges=[];this.outEdges=[];this.edges=[];this.hostGraph;this.dataIndex=h==null?-1:h}e.prototype={constructor:e,degree:function(){return this.edges.length},inDegree:function(){return this.inEdges.length},outDegree:function(){return this.outEdges.length},getModel:function(j){if(this.dataIndex<0){return}var i=this.hostGraph;var h=i.data.getItemModel(this.dataIndex);return h.getModel(j)}};function d(j,i,h){this.node1=j;this.node2=i;this.dataIndex=h==null?-1:h}d.prototype.getModel=function(j){if(this.dataIndex<0){return}var i=this.hostGraph;var h=i.edgeData.getItemModel(this.dataIndex);return h.getModel(j)};var a=function(i,h){return{getValue:function(k){var j=this[i][h];return j.get(j.getDimension(k||"value"),this.dataIndex)},setVisual:function(j,k){this.dataIndex>=0&&this[i][h].setItemVisual(this.dataIndex,j,k)},getVisual:function(k,j){return this[i][h].getItemVisual(this.dataIndex,k,j)},setLayout:function(j,k){this.dataIndex>=0&&this[i][h].setItemLayout(this.dataIndex,j,k)},getLayout:function(){return this[i][h].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[i][h].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[i][h].getRawIndex(this.dataIndex)}}};b.mixin(e,a("hostGraph","data"));b.mixin(d,a("hostGraph","edgeData"));c.Node=e;c.Edge=d;return c});