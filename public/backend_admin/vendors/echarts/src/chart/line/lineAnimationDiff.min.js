define(function(c){function a(e){return e>=0?1:-1}function b(i,k,n){var f=i.getBaseAxis();var p=i.getOtherAxis(f);var h=f.onZero?0:p.scale.getExtent()[0];var l=p.dim;var g=l==="x"||l==="radius"?1:0;var j;var m=k.stackedOn;var e=k.get(l,n);while(m&&a(m.get(l,n))===a(e)){j=m;break}var o=[];o[g]=k.get(f.dim,n);o[1-g]=j?j.get(l,n,true):h;return i.dataToPoint(o)}function d(g,f){var e=[];f.diff(g).add(function(h){e.push({cmd:"+",idx:h})}).update(function(i,h){e.push({cmd:"=",idx:h,idx1:i})}).remove(function(h){e.push({cmd:"-",idx:h})}).execute();return e}return function(F,o,y,n,C,E){var p=d(F,o);var q=[];var j=[];var h=[];var D=[];var x=[];var t=[];var f=[];var v=E.dimensions;for(var z=0;z<p.length;z++){var w=p[z];var B=true;switch(w.cmd){case"=":var A=F.getItemLayout(w.idx);var u=o.getItemLayout(w.idx1);if(isNaN(A[0])||isNaN(A[1])){A=u.slice()}q.push(A);j.push(u);h.push(y[w.idx]);D.push(n[w.idx1]);f.push(o.getRawIndex(w.idx1));break;case"+":var r=w.idx;q.push(C.dataToPoint([o.get(v[0],r,true),o.get(v[1],r,true)]));j.push(o.getItemLayout(r).slice());h.push(b(C,o,r));D.push(n[r]);f.push(o.getRawIndex(r));break;case"-":var r=w.idx;var m=F.getRawIndex(r);if(m!==r){q.push(F.getItemLayout(r));j.push(E.dataToPoint([F.get(v[0],r,true),F.get(v[1],r,true)]));h.push(y[r]);D.push(b(E,F,r));f.push(m)}else{B=false}}if(B){x.push(w);t.push(t.length)}}t.sort(function(G,i){return f[G]-f[i]});var s=[];var l=[];var k=[];var e=[];var g=[];for(var z=0;z<t.length;z++){var r=t[z];s[z]=q[r];l[z]=j[r];k[z]=h[r];e[z]=D[r];g[z]=x[r]}return{current:s,next:l,stackedOnCurrent:k,stackedOnNext:e,status:g}}});