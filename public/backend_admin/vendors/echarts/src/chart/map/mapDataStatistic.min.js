define(function(c){var a=c("zrender/core/util");function b(d,e){var g={};var h=["value"];for(var f=0;f<d.length;f++){d[f].each(h,function(k,i){var j=d[f].getName(i);g[j]=g[j]||[];if(!isNaN(k)){g[j].push(k)}})}return d[0].map(h,function(p,q){var j=d[0].getName(q);var m=0;var k=Infinity;var o=-Infinity;var n=g[j].length;for(var l=0;l<n;l++){k=Math.min(k,g[j][l]);o=Math.max(o,g[j][l]);m+=g[j][l]}var r;if(e==="min"){r=k}else{if(e==="max"){r=o}else{if(e==="average"){r=m/n}else{r=m}}}return n===0?NaN:r})}return function(d){var e={};d.eachSeriesByType("map",function(f){var g=f.get("map");e[g]=e[g]||[];e[g].push(f)});a.each(e,function(g,j){var h=b(a.map(g,function(i){return i.getData()}),g[0].get("mapValueCalculation"));g[0].seriesGroup=[];g[0].setData(h);for(var f=0;f<g.length;f++){g[f].seriesGroup=g;g[f].needsDrawMap=f===0}})}});