define(function(b){var a=b("zrender/core/util");var d=b("../../util/graphic");a.extend(b("../../model/Model").prototype,b("./barItemStyle"));function c(h,e){var g=h.width>0?1:-1;var f=h.height>0?1:-1;e=Math.min(e,Math.abs(h.width),Math.abs(h.height));h.x+=g*e/2;h.y+=f*e/2;h.width-=g*e;h.height-=f*e}return b("../../echarts").extendChartView({type:"bar",render:function(f,e,g){var h=f.get("coordinateSystem");if(h==="cartesian2d"){this._renderOnCartesian(f,e,g)}return this.group},_renderOnCartesian:function(f,k,l){var p=this.group;var h=f.getData();var i=this._data;var j=f.coordinateSystem;var e=j.getBaseAxis();var n=e.isHorizontal();var o=f.get("animation");var m=["itemStyle","normal","barBorderWidth"];function g(t,w){var v=h.getItemLayout(t);var q=h.getItemModel(t).get(m)||0;c(v,q);var u=new d.Rect({shape:a.extend({},v)});if(o){var s=u.shape;var r=n?"height":"width";var x={};s[r]=0;x[r]=v[r];d[w?"updateProps":"initProps"](u,{shape:x},f,t)}return u}h.diff(i).add(function(q){if(!h.hasValue(q)){return}var r=g(q);h.setItemGraphicEl(q,r);p.add(r)}).update(function(r,u){var t=i.getItemGraphicEl(u);if(!h.hasValue(r)){p.remove(t);return}if(!t){t=g(r,true)}var s=h.getItemLayout(r);var q=h.getItemModel(r).get(m)||0;c(s,q);d.updateProps(t,{shape:s},f,r);h.setItemGraphicEl(r,t);p.add(t)}).remove(function(q){var r=i.getItemGraphicEl(q);if(r){r.style.text="";d.updateProps(r,{shape:{width:0}},f,q,function(){p.remove(r)})}}).execute();this._updateStyle(f,h,n);this._data=h},_updateStyle:function(e,g,h){function f(l,j,i,m,k){d.setText(l,j,i);l.text=m;if(l.textPosition==="outside"){l.textPosition=k}}g.eachItemGraphicEl(function(p,r){var s=g.getItemModel(r);var k=g.getItemVisual(r,"color");var n=g.getItemVisual(r,"opacity");var m=g.getItemLayout(r);var l=s.getModel("itemStyle.normal");var i=s.getModel("itemStyle.emphasis").getBarItemStyle();p.setShape("r",l.get("barBorderRadius")||0);p.useStyle(a.defaults({fill:k,opacity:n},l.getBarItemStyle()));var q=h?(m.height>0?"bottom":"top"):(m.width>0?"left":"right");var t=s.getModel("label.normal");var o=s.getModel("label.emphasis");var j=p.style;if(t.get("show")){f(j,t,k,a.retrieve(e.getFormattedLabel(r,"normal"),e.getRawValue(r)),q)}else{j.text=""}if(o.get("show")){f(i,o,k,a.retrieve(e.getFormattedLabel(r,"emphasis"),e.getRawValue(r)),q)}else{i.text=""}d.setHoverStyle(p,i)})},remove:function(e,f){var g=this.group;if(e.get("animation")){if(this._data){this._data.eachItemGraphicEl(function(h){h.style.text="";d.updateProps(h,{shape:{width:0}},e,h.dataIndex,function(){g.remove(h)})})}}else{g.removeAll()}}})});