define(function(a){var b=a("zrender/core/vector");var c=b.scaleAndAdd;return function(f,k,d){var m=d.rect;var g=m.width;var o=m.height;var e=[m.x+g/2,m.y+o/2];var p=d.gravity==null?0.1:d.gravity;for(var l=0;l<f.length;l++){var h=f[l];if(!h.p){h.p=b.create(g*(Math.random()-0.5)+e[0],o*(Math.random()-0.5)+e[1])}h.pp=b.clone(h.p);h.edges=null}var j=0.6;return{warmUp:function(){j=0.5},setFixed:function(i){f[i].fixed=true},setUnfixed:function(i){f[i].fixed=false},step:function(r){var u=[];var E=f.length;for(var x=0;x<k.length;x++){var z=k[x];var A=z.n1;var y=z.n2;b.sub(u,y.p,A.p);var B=b.len(u)-z.d;var C=y.w/(A.w+y.w);b.normalize(u,u);!A.fixed&&c(A.p,A.p,u,C*B*j);!y.fixed&&c(y.p,y.p,u,-(1-C)*B*j)}for(var x=0;x<E;x++){var q=f[x];if(!q.fixed){b.sub(u,e,q.p);b.scaleAndAdd(q.p,q.p,u,p*j)}}for(var x=0;x<E;x++){var A=f[x];for(var s=x+1;s<E;s++){var y=f[s];b.sub(u,y.p,A.p);var B=b.len(u);if(B===0){b.set(u,Math.random()-0.5,Math.random()-0.5);B=1}var t=(A.rep+y.rep)/B/B;!A.fixed&&c(A.pp,A.pp,u,t);!y.fixed&&c(y.pp,y.pp,u,-t)}}var D=[];for(var x=0;x<E;x++){var q=f[x];if(!q.fixed){b.sub(D,q.p,q.pp);b.scaleAndAdd(q.p,q.p,D,j);b.copy(q.pp,q.p)}}j=j*0.992;r&&r(f,k,j<0.01)}}}});