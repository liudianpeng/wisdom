define(function(b){var e=b("../../util/graphic");var a=b("zrender/core/util");var c=e.extendShape({shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,cpx2:0,cpy2:0,extent:0},buildPath:function(f,g){var h=g.extent/2;f.moveTo(g.x1,g.y1-h);f.bezierCurveTo(g.cpx1,g.cpy1-h,g.cpx2,g.cpy2-h,g.x2,g.y2-h);f.lineTo(g.x2,g.y2+h);f.bezierCurveTo(g.cpx2,g.cpy2+h,g.cpx1,g.cpy1+h,g.x1,g.y1+h);f.closePath()}});return b("../../echarts").extendChartView({type:"sankey",_model:null,render:function(g,f,j){var k=g.getGraph();var m=this.group;var l=g.layoutInfo;var h=g.getData();var i=g.getData("edge");this._model=g;m.removeAll();m.position=[l.x,l.y];k.eachNode(function(t){var s=t.getLayout();var q=t.getModel();var u=q.getModel("label.normal");var o=u.getModel("textStyle");var n=q.getModel("label.emphasis");var p=n.getModel("textStyle");var r=new e.Rect({shape:{x:s.x,y:s.y,width:t.getLayout().dx,height:t.getLayout().dy},style:{text:u.get("show")?g.getFormattedLabel(t.dataIndex,"normal")||t.id:"",textFont:o.getFont(),textFill:o.getTextColor(),textPosition:u.get("position")}});r.setStyle(a.defaults({fill:t.getVisual("color")},q.getModel("itemStyle.normal").getItemStyle()));e.setHoverStyle(r,a.extend(t.getModel("itemStyle.emphasis"),{text:n.get("show")?g.getFormattedLabel(t.dataIndex,"emphasis")||t.id:"",textFont:p.getFont(),textFill:p.getTextColor(),textPosition:n.get("position")}));m.add(r);h.setItemGraphicEl(t.dataIndex,r);r.dataType="node"});k.eachEdge(function(p){var q=new c();q.dataIndex=p.dataIndex;q.seriesIndex=g.seriesIndex;q.dataType="edge";var z=p.getModel("lineStyle.normal");var v=z.get("curveness");var t=p.node1.getLayout();var B=p.node2.getLayout();var w=p.getLayout();q.shape.extent=Math.max(1,w.dy);var o=t.x+t.dx;var A=t.y+w.sy+w.dy/2;var n=B.x;var y=B.y+w.ty+w.dy/2;var x=o*(1-v)+n*v;var s=A;var u=o*v+n*(1-v);var r=y;q.setShape({x1:o,y1:A,x2:n,y2:y,cpx1:x,cpy1:s,cpx2:u,cpy2:r});q.setStyle(z.getItemStyle());e.setHoverStyle(q,p.getModel("lineStyle.emphasis").getItemStyle());m.add(q);i.setItemGraphicEl(p.dataIndex,q)});if(!this._data&&g.get("animation")){m.setClipPath(d(m.getBoundingRect(),g,function(){m.removeClipPath()}))}this._data=g.getData()}});function d(i,g,f){var h=new e.Rect({shape:{x:i.x-10,y:i.y-10,width:0,height:i.height+20}});e.initProps(h,{shape:{width:i.width+20,height:i.height+20}},g,f);return h}});