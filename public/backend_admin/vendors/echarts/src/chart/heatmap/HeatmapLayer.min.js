define(function(b){var d=256;var a=b("zrender/core/util");function c(){var e=a.createCanvas();this.canvas=e;this.blurSize=30;this.pointSize=20;this.maxOpacity=1;this.minOpacity=0;this._gradientPixels={}}c.prototype={update:function(K,B,z,E,f,e){var h=this._getBrush();var u=this._getGradient(K,f,"inRange");var l=this._getGradient(K,f,"outOfRange");var v=this.pointSize+this.blurSize;var j=this.canvas;var D=j.getContext("2d");var H=K.length;j.width=B;j.height=z;for(var G=0;G<H;++G){var A=K[G];var q=A[0];var o=A[1];var C=A[2];var k=E(C);D.globalAlpha=k;D.drawImage(h,q-v,o-v)}var I=D.getImageData(0,0,j.width,j.height);var w=I.data;var m=0;var n=w.length;var F=this.minOpacity;var J=this.maxOpacity;var s=J-F;while(m<n){var k=w[m+3]/256;var t=Math.floor(k*(d-1))*4;if(k>0){var g=e(k)?u:l;k>0&&(k=k*s+F);w[m++]=g[t];w[m++]=g[t+1];w[m++]=g[t+2];w[m++]=g[t+3]*k*256}else{m+=4}}D.putImageData(I,0,0);return j},_getBrush:function(){var g=this._brushCanvas||(this._brushCanvas=a.createCanvas());var f=this.pointSize+this.blurSize;var h=f*2;g.width=h;g.height=h;var e=g.getContext("2d");e.clearRect(0,0,h,h);e.shadowOffsetX=h;e.shadowBlur=this.blurSize;e.shadowColor="#000";e.beginPath();e.arc(-f,f,this.pointSize,0,Math.PI*2,true);e.closePath();e.fill();return g},_getGradient:function(l,h,k){var g=this._gradientPixels;var f=g[k]||(g[k]=new Uint8ClampedArray(256*4));var e=[];var m=0;for(var j=0;j<256;j++){h[k](j/255,true,e);f[m++]=e[0];f[m++]=e[1];f[m++]=e[2];f[m++]=e[3]}return f}};return c});