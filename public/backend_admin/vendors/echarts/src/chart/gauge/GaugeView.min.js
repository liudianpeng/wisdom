define(function(c){var h=c("./PointerPath");var a=c("../../util/graphic");var b=c("../../util/number");var e=b.parsePercent;function g(n,p){var k=n.get("center");var l=p.getWidth();var q=p.getHeight();var s=Math.min(l,q);var o=e(k[0],p.getWidth());var m=e(k[1],p.getHeight());var j=e(n.get("radius"),s/2);return{cx:o,cy:m,r:j}}function d(j,k){if(k){if(typeof k==="string"){j=k.replace("{value}",j)}else{if(typeof k==="function"){j=k(j)}}}return j}var i=Math.PI*2;var f=c("../../view/Chart").extend({type:"gauge",render:function(l,k,n){this.group.removeAll();var m=l.get("axisLine.lineStyle.color");var j=g(l,n);this._renderMain(l,k,n,m,j)},_renderMain:function(q,B,o,p,n){var m=this.group;var l=q.getModel("axisLine");var s=l.getModel("lineStyle");var z=q.get("clockwise");var w=-q.get("startAngle")/180*Math.PI;var u=-q.get("endAngle")/180*Math.PI;var r=(u-w)%i;var y=w;var t=s.get("width");for(var x=0;x<p.length;x++){var j=Math.min(Math.max(p[x][0],0),1);var u=w+r*j;var v=new a.Sector({shape:{startAngle:y,endAngle:u,cx:n.cx,cy:n.cy,clockwise:z,r0:n.r-t,r:n.r},silent:true});v.setStyle({fill:p[x][1]});v.setStyle(s.getLineStyle(["color","borderWidth","borderColor"]));m.add(v);y=u}var k=function(D){if(D<=0){return p[0][1]}for(var C=0;C<p.length;C++){if(p[C][0]>=D&&(C===0?0:p[C-1][0])<D){return p[C][1]}}return p[C-1][1]};if(!z){var A=w;w=u;u=A}this._renderTicks(q,B,o,k,n,w,u,z);this._renderPointer(q,B,o,k,n,w,u,z);this._renderTitle(q,B,o,k,n);this._renderDetail(q,B,o,k,n)},_renderTicks:function(H,T,E,m,A,K,I,N){var y=this.group;var l=A.cx;var k=A.cy;var G=A.r;var P=H.get("min");var x=H.get("max");var S=H.getModel("splitLine");var Q=H.getModel("axisTick");var z=H.getModel("axisLabel");var q=H.get("splitNumber");var o=Q.get("splitNumber");var M=e(S.get("length"),G);var B=e(Q.get("length"),G);var O=K;var t=(I-K)/q;var R=t/o;var F=S.getModel("lineStyle").getLineStyle();var s=Q.getModel("lineStyle").getLineStyle();var u=z.getModel("textStyle");for(var L=0;L<=q;L++){var p=Math.cos(O);var n=Math.sin(O);if(S.get("show")){var w=new a.Line({shape:{x1:p*G+l,y1:n*G+k,x2:p*(G-M)+l,y2:n*(G-M)+k},style:F,silent:true});if(F.stroke==="auto"){w.setStyle({stroke:m(L/q)})}y.add(w)}if(z.get("show")){var v=d(b.round(L/q*(x-P)+P),z.get("formatter"));var D=new a.Text({style:{text:v,x:p*(G-M-5)+l,y:n*(G-M-5)+k,fill:u.getTextColor(),textFont:u.getFont(),textVerticalAlign:n<-0.4?"top":(n>0.4?"bottom":"middle"),textAlign:p<-0.4?"left":(p>0.4?"right":"center")},silent:true});if(D.style.fill==="auto"){D.setStyle({fill:m(L/q)})}y.add(D)}if(Q.get("show")&&L!==q){for(var J=0;J<=o;J++){var p=Math.cos(O);var n=Math.sin(O);var C=new a.Line({shape:{x1:p*G+l,y1:n*G+k,x2:p*(G-B)+l,y2:n*(G-B)+k},silent:true,style:s});if(s.stroke==="auto"){C.setStyle({stroke:m((L+J/o)/q)})}y.add(C);O+=R}O-=R}else{O+=t}}},_renderPointer:function(l,p,q,v,m,r,k,j){var s=[+l.get("min"),+l.get("max")];var u=[r,k];if(!j){u=u.reverse()}var n=l.getData();var o=this._data;var t=this.group;n.diff(o).add(function(w){var x=new h({shape:{angle:r}});a.updateProps(x,{shape:{angle:b.linearMap(n.get("value",w),s,u,true)}},l);t.add(x);n.setItemGraphicEl(w,x)}).update(function(x,w){var y=o.getItemGraphicEl(w);a.updateProps(y,{shape:{angle:b.linearMap(n.get("value",x),s,u,true)}},l);t.add(y);n.setItemGraphicEl(x,y)}).remove(function(w){var x=o.getItemGraphicEl(w);t.remove(x)}).execute();n.eachItemGraphicEl(function(z,w){var y=n.getItemModel(w);var x=y.getModel("pointer");z.setShape({x:m.cx,y:m.cy,width:e(x.get("width"),m.r),r:e(x.get("length"),m.r)});z.useStyle(y.getModel("itemStyle.normal").getItemStyle());if(z.style.fill==="auto"){z.setStyle("fill",v((n.get("value",w)-s[0])/(s[1]-s[0])))}a.setHoverStyle(z,y.getModel("itemStyle.emphasis").getItemStyle())});this._data=n},_renderTitle:function(k,n,o,t,m){var j=k.getModel("title");if(j.get("show")){var q=j.getModel("textStyle");var l=j.get("offsetCenter");var r=m.cx+e(l[0],m.r);var p=m.cy+e(l[1],m.r);var s=new a.Text({style:{x:r,y:p,text:k.getData().getName(0),fill:q.getTextColor(),textFont:q.getFont(),textAlign:"center",textVerticalAlign:"middle"}});this.group.add(s)}},_renderDetail:function(l,n,o,z,m){var p=l.getModel("detail");var v=l.get("min");var A=l.get("max");if(p.get("show")){var s=p.getModel("textStyle");var k=p.get("offsetCenter");var t=m.cx+e(k[0],m.r);var r=m.cy+e(k[1],m.r);var j=e(p.get("width"),m.r);var w=e(p.get("height"),m.r);var u=l.getData().get("value",0);var q=new a.Rect({shape:{x:t-j/2,y:r-w/2,width:j,height:w},style:{text:d(u,p.get("formatter")),fill:p.get("backgroundColor"),textFill:s.getTextColor(),textFont:s.getFont()}});if(q.style.textFill==="auto"){q.setStyle("textFill",z(b.linearMap(u,[v,A],[0,1],true)))}q.setStyle(p.getItemStyle(["color"]));this.group.add(q)}}});return f});