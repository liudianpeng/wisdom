define(function(c){var f=c("../../model/Series");var e=c("../../data/Tree");var d=c("zrender/core/util");var b=c("../../model/Model");var a=c("../../util/format");var i=a.encodeHTML;var g=a.addCommas;return f.extend({type:"series.treemap",dependencies:["grid","polar"],_viewRoot:null,defaultOption:{left:"center",top:"middle",right:null,bottom:null,width:"80%",height:"80%",sort:true,clipWindow:"origin",squareRatio:0.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"â–?",visualDimension:0,zoomToNodeRatio:0.32*0.32,roam:true,nodeClick:"zoomToNode",animation:true,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:true,height:22,left:"center",top:"bottom",emptyItemWidth:25,itemStyle:{normal:{color:"rgba(0,0,0,0.7)",borderColor:"rgba(255,255,255,0.7)",borderWidth:1,shadowColor:"rgba(150,150,150,1)",shadowBlur:3,shadowOffsetX:0,shadowOffsetY:0,textStyle:{color:"#fff"}},emphasis:{textStyle:{}}}},label:{normal:{show:true,position:"inside",textStyle:{color:"#fff",ellipsis:true}}},itemStyle:{normal:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:"#fff",borderColorSaturation:null},emphasis:{}},color:"none",colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},getInitialData:function(n,k){var p=n.data||[];var q=n.name;q==null&&(q=n.name);var l={name:q,children:n.data};var m=(p[0]||{}).value;j(l,d.isArray(m)?m.length:-1);var o=n.levels||[];o=n.levels=h(o,k);return e.createTree(l,this,o).data},optionUpdated:function(){this.resetViewRoot()},formatTooltip:function(l){var o=this.getData();var n=this.getRawValue(l);var m=d.isArray(n)?g(n[0]):g(n);var k=o.getName(l);return i(k)+": "+m},getDataParams:function(m){var p=f.prototype.getDataParams.apply(this,arguments);var o=this.getData();var n=o.tree.getNodeByDataIndex(m);var l=p.treePathInfo=[];while(n){var k=n.dataIndex;l.push({name:n.name,dataIndex:k,value:this.getRawValue(k)});n=n.parentNode}l.reverse();return p},setLayoutInfo:function(k){this.layoutInfo=this.layoutInfo||{};d.extend(this.layoutInfo,k)},mapIdToIndex:function(m){var k=this._idIndexMap;if(!k){k=this._idIndexMap={};this._idIndexMapCount=0}var l=k[m];if(l==null){k[m]=l=this._idIndexMapCount++}return l},getViewRoot:function(){return this._viewRoot},resetViewRoot:function(l){l?(this._viewRoot=l):(l=this._viewRoot);var k=this.getData().tree.root;if(!l||(l!==k&&!k.contains(l))){this._viewRoot=k}}});function j(m,l){var n=0;d.each(m.children,function(p){j(p,l);var o=p.value;d.isArray(o)&&(o=o[0]);n+=o});var k=m.value;if(l>=0){if(!d.isArray(k)){m.value=new Array(l)}else{k=k[0]}}if(k==null||isNaN(k)){k=n}if(k<0){k=0}l>=0?(m.value[0]=k):(m.value=k)}function h(n,l){var m=l.get("color");if(!m){return}n=n||[];var k;d.each(n,function(r){var p=new b(r);var q=p.get("color");if(p.get("itemStyle.normal.color")||(q&&q!=="none")){k=true}});if(!k){var o=n[0]||(n[0]={});o.color=m.slice()}return n}});