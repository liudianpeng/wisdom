define(function(c){var b=c("../../util/number");var e=b.parsePercent;var d=c("./labelLayout");var a=c("zrender/core/util");var f=Math.PI*2;var g=Math.PI/180;return function(i,h,j){h.eachSeriesByType(i,function(x){var G=x.get("center");var o=x.get("radius");if(!a.isArray(o)){o=[0,o]}if(!a.isArray(G)){G=[G,G]}var A=j.getWidth();var u=j.getHeight();var t=Math.min(A,u);var m=e(G[0],A);var l=e(G[1],u);var D=e(o[0],t/2);var s=e(o[1],t/2);var H=x.getData();var C=-x.get("startAngle")*g;var B=x.get("minAngle")*g;var k=H.getSum("value");var w=Math.PI/(k||H.count())*2;var E=x.get("clockwise");var z=x.get("roseType");var p=H.getDataExtent("value");p[0]=0;var y=f;var n=0;var q=C;var v=E?1:-1;H.each("value",function(J,r){var K;if(z!=="area"){K=k===0?w:(J*w)}else{K=f/(H.count()||1)}if(K<B){K=B;y-=B}else{n+=J}var I=q+v*K;H.setItemLayout(r,{angle:K,startAngle:q,endAngle:I,clockwise:E,cx:m,cy:l,r0:D,r:z?b.linearMap(J,p,[D,s]):s});q=I},true);if(y<f){if(y<=0.001){var F=f/H.count();H.each(function(r){var I=H.getItemLayout(r);I.startAngle=C+v*r*F;I.endAngle=C+v*(r+1)*F})}else{w=y/n;q=C;H.each("value",function(J,r){var I=H.getItemLayout(r);var K=I.angle===B?B:J*w;I.startAngle=q;I.endAngle=q+v*K;q+=K})}}d(x,s,A,u)})}});