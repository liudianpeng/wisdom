define(function(c){var a=c("../../util/graphic");var f=c("zrender/core/util");function h(m,j,o,n){var p=j.getData();var l=this.dataIndex;var k=p.getName(l);var q=j.get("selectedOffset");n.dispatchAction({type:"pieToggleSelect",from:m,name:k,seriesId:j.id});p.each(function(r){i(p.getItemGraphicEl(r),p.getItemLayout(r),j.isSelected(p.getName(r)),q,o)})}function i(k,p,j,m,q){var l=(p.startAngle+p.endAngle)/2;var s=Math.cos(l);var r=Math.sin(l);var n=j?m:0;var o=[s*n,r*n];q?k.animate().when(200,{position:o}).start("bounceOut"):k.attr("position",o)}function e(o,l){a.Group.call(this);var n=new a.Sector({z2:2});var m=new a.Polyline();var p=new a.Text();this.add(n);this.add(m);this.add(p);this.updateData(o,l,true);function k(){m.ignore=m.hoverIgnore;p.ignore=p.hoverIgnore}function j(){m.ignore=m.normalIgnore;p.ignore=p.normalIgnore}this.on("emphasis",k).on("normal",j).on("mouseover",k).on("mouseout",j)}var d=e.prototype;function b(n,j,m,o,p){var k=o.getModel("textStyle");var l=p==="inside"||p==="inner";return{fill:k.getTextColor()||(l?"#fff":n.getItemVisual(j,"color")),opacity:n.getItemVisual(j,"opacity"),textFont:k.getFont(),text:f.retrieve(n.hostModel.getFormattedLabel(j,m),n.getName(j))}}d.updateData=function(n,r,q){var j=this.childAt(0);var k=n.hostModel;var u=n.getItemModel(r);var p=n.getItemLayout(r);var t=f.extend({},p);t.label=null;if(q){j.setShape(t);j.shape.endAngle=p.startAngle;a.updateProps(j,{shape:{endAngle:p.endAngle}},k,r)}else{a.updateProps(j,{shape:t},k,r)}var m=u.getModel("itemStyle");var s=n.getItemVisual(r,"color");j.useStyle(f.defaults({fill:s},m.getModel("normal").getItemStyle()));j.hoverStyle=m.getModel("emphasis").getItemStyle();i(this,n.getItemLayout(r),u.get("selected"),k.get("selectedOffset"),k.get("animation"));function l(){j.stopAnimation(true);j.animateTo({shape:{r:p.r+10}},300,"elasticOut")}function o(){j.stopAnimation(true);j.animateTo({shape:{r:p.r}},300,"elasticOut")}j.off("mouseover").off("mouseout").off("emphasis").off("normal");if(u.get("hoverAnimation")){j.on("mouseover",l).on("mouseout",o).on("emphasis",l).on("normal",o)}this._updateLabel(n,r);a.setHoverStyle(this)};d._updateLabel=function(p,t){var o=this.childAt(1);var l=this.childAt(2);var m=p.hostModel;var v=p.getItemModel(t);var s=p.getItemLayout(t);var x=s.label;var u=p.getItemVisual(t,"color");a.updateProps(o,{shape:{points:x.linePoints||[[x.x,x.y],[x.x,x.y],[x.x,x.y]]}},m,t);a.updateProps(l,{style:{x:x.x,y:x.y}},m,t);l.attr({style:{textVerticalAlign:x.verticalAlign,textAlign:x.textAlign,textFont:x.font},rotation:x.rotation,origin:[x.x,x.y],z2:10});var w=v.getModel("label.normal");var r=v.getModel("label.emphasis");var n=v.getModel("labelLine.normal");var k=v.getModel("labelLine.emphasis");var q=w.get("position")||r.get("position");l.setStyle(b(p,t,"normal",w,q));l.ignore=l.normalIgnore=!w.get("show");l.hoverIgnore=!r.get("show");o.ignore=o.normalIgnore=!n.get("show");o.hoverIgnore=!k.get("show");o.setStyle({stroke:u,opacity:p.getItemVisual(t,"opacity")});o.setStyle(n.getModel("lineStyle").getLineStyle());l.hoverStyle=b(p,t,"emphasis",r,q);o.hoverStyle=k.getModel("lineStyle").getLineStyle();var j=n.get("smooth");if(j&&j===true){j=0.4}o.setShape({smooth:j})};f.inherits(e,a.Group);var g=c("../../view/Chart").extend({type:"pie",init:function(){var j=new a.Group();this._sectorGroup=j},render:function(l,o,q,u){if(u&&(u.from===this.uid)){return}var m=l.getData();var n=this._data;var w=this.group;var p=o.get("animation");var x=!n;var k=f.curry(h,this.uid,l,p,q);var t=l.get("selectedMode");m.diff(n).add(function(r){var y=new e(m,r);if(x){y.eachChild(function(z){z.stopAnimation(true)})}t&&y.on("click",k);m.setItemGraphicEl(r,y);w.add(y)}).update(function(z,y){var r=n.getItemGraphicEl(y);r.updateData(m,z);r.off("click");t&&r.on("click",k);w.add(r);m.setItemGraphicEl(z,r)}).remove(function(r){var y=n.getItemGraphicEl(r);w.remove(y)}).execute();if(p&&x&&m.count()>0){var s=m.getItemLayout(0);var j=Math.max(q.getWidth(),q.getHeight())/2;var v=f.bind(w.removeClipPath,w);w.setClipPath(this._createClipPath(s.cx,s.cy,j,s.startAngle,s.clockwise,v,l))}this._data=m},_createClipPath:function(k,q,p,n,m,j,l){var o=new a.Sector({shape:{cx:k,cy:q,r0:0,r:p,startAngle:n,endAngle:n,clockwise:m}});a.initProps(o,{shape:{endAngle:n+(m?1:-1)*Math.PI*2}},l,j);return o}});return g});