define(function(b){var d=b("zrender/contain/text");function c(t,n,m,e,k,p,l){t.sort(function(r,i){return r.y-i.y});function q(y,i,x,w){for(var r=y;r<i;r++){t[r].y+=x;if(r>y&&r+1<i&&t[r+1].y>t[r].y+t[r].height){j(r,x/2);return}}j(i-1,x/2)}function j(i,w){for(var r=i;r>=0;r--){t[r].y-=w;if(r>0&&t[r].y>t[r-1].y+t[r-1].height){break}}}function v(H,I,E,C,w,A){var x=A>0?I?Number.MAX_VALUE:0:I?Number.MAX_VALUE:0;for(var G=0,B=H.length;G<B;G++){if(H[G].position==="center"){continue}var D=Math.abs(H[G].y-C);var z=H[G].len;var y=H[G].len2;var F=(D<w+z)?Math.sqrt((w+z+y)*(w+z+y)-D*D):Math.abs(H[G].x-E);if(I&&F>=x){F=x-10}if(!I&&F<=x){F=x+10}H[G].x=E+F*A;x=F}}var g=0;var u;var s=t.length;var f=[];var h=[];for(var o=0;o<s;o++){u=t[o].y-g;if(u<0){q(o,s,-u,k)}g=t[o].y+t[o].height}if(l-g<0){j(s-1,g-l)}for(var o=0;o<s;o++){if(t[o].y>=m){h.push(t[o])}else{f.push(t[o])}}v(f,false,n,m,e,k);v(h,true,n,m,e,k)}function a(n,j,h,e,m,g){var l=[];var f=[];for(var k=0;k<n.length;k++){if(n[k].x<j){l.push(n[k])}else{f.push(n[k])}}c(f,j,h,e,1,m,g);c(l,j,h,e,-1,m,g);for(var k=0;k<n.length;k++){var p=n[k].linePoints;if(p){var o=p[1][0]-p[2][0];if(n[k].x<j){p[2][0]=n[k].x+3}else{p[2][0]=n[k].x-3}p[1][1]=p[2][1]=n[k].y;p[1][0]=p[2][0]+o}}}return function(h,e,k,f){var j=h.getData();var l=[];var i;var g;var m=false;j.each(function(D){var M=j.getItemLayout(D);var I=j.getItemModel(D);var x=I.getModel("label.normal");var n=x.get("position")||I.get("label.emphasis.position");var G=I.getModel("labelLine.normal");var w=G.get("length");var q=G.get("length2");var y=(M.startAngle+M.endAngle)/2;var A=Math.cos(y);var z=Math.sin(y);var F;var E;var v;var t;i=M.cx;g=M.cy;var u=n==="inside"||n==="inner";if(n==="center"){F=M.cx;E=M.cy;t="center"}else{var L=(u?(M.r+M.r0)/2*A:M.r*A)+i;var s=(u?(M.r+M.r0)/2*z:M.r*z)+g;F=L+A*3;E=s+z*3;if(!u){var K=L+A*(w+e-M.r);var r=s+z*(w+e-M.r);var J=K+((A<0?-1:1)*q);var p=r;F=J+(A<0?-5:5);E=p;v=[[L,s],[K,r],[J,p]]}t=u?"center":(A>0?"left":"right")}var C=x.getModel("textStyle").getFont();var H=x.get("rotate")?(A<0?-y+Math.PI:-y):0;var B=h.getFormattedLabel(D,"normal")||j.getName(D);var o=d.getBoundingRect(B,C,t,"top");m=!!H;M.label={x:F,y:E,position:n,height:o.height,len:w,len2:q,linePoints:v,textAlign:t,verticalAlign:"middle",font:C,rotation:H};if(!u){l.push(M.label)}});if(!m&&h.get("avoidLabelOverlap")){a(l,i,g,e,k,f)}}});