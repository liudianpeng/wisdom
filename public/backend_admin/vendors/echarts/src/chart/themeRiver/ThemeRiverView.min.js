define(function(c){var d=c("../line/poly");var f=c("../../util/graphic");var a=c("zrender/core/util");var b=c("../../data/DataDiffer");return c("../../echarts").extendChartView({type:"themeRiver",init:function(){this._layers=[]},render:function(l,q,r){var o=l.getData();var h=l.getRawData();if(!o.count()){return}var t=this.group;var n=l.getLayerSeries();var k=o.getLayout("layoutInfo");var s=k.rect;var j=k.boundaryGap;t.position=[0,s.y+j[0]];function p(u){return u.name}var g=new b(this._layersSeries||[],n,p,p);var m={};g.add(a.bind(a.curry(i,"add"),this)).update(a.bind(a.curry(i,"update"),this)).remove(a.bind(a.curry(i,"remove"),this)).execute();function i(L,K,v){var O=this._layers;if(L==="remove"){t.remove(O[K]);return}var S=[];var Q=[];var M;var A=n[K].indices;for(var P=0;P<A.length;P++){var R=o.getItemLayout(A[P]);var G=R.x;var z=R.y0;var F=R.y;S.push([G,z]);Q.push([G,z+F]);M=h.getItemVisual(o.getRawIndex(A[P]),"color")}var H;var I;var B=o.getItemLayout(A[0]);var N=o.getItemModel(A[P-1]);var E=N.getModel("label.normal");var J=E.get("margin");if(L==="add"){var D=m[K]=new f.Group();H=new d.Polygon({shape:{points:S,stackedOnPoints:Q,smooth:0.4,stackedOnSmooth:0.4,smoothConstraint:false},z2:0});I=new f.Text({style:{x:B.x-J,y:B.y0+B.y/2}});D.add(H);D.add(I);t.add(D);H.setClipPath(e(H.getBoundingRect(),l,function(){H.removeClipPath()}))}else{var D=O[v];H=D.childAt(0);I=D.childAt(1);t.add(D);m[K]=D;f.updateProps(H,{shape:{points:S,stackedOnPoints:Q}},l);f.updateProps(I,{style:{x:B.x-J,y:B.y0+B.y/2}},l)}var u=N.getModel("itemStyle.emphasis");var w=N.getModel("itemStyle.nomral");var C=E.getModel("textStyle");I.setStyle({text:E.get("show")?l.getFormattedLabel(A[P-1],"normal")||o.getName(A[P-1]):"",textFont:C.getFont(),textAlign:E.get("textAlign"),textVerticalAlign:"middle"});H.setStyle(a.extend({fill:M},w.getItemStyle(["color"])));f.setHoverStyle(H,u.getItemStyle())}this._layersSeries=n;this._layers=m}});function e(j,h,g){var i=new f.Rect({shape:{x:j.x-10,y:j.y-10,width:0,height:j.height+20}});f.initProps(i,{shape:{width:j.width+20,height:j.height+20}},h,g);return i}});