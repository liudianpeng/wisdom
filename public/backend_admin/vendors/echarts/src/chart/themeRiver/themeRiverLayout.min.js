define(function(d){var b=d("zrender/core/util");var c=d("../../util/number");return function(f,g){f.eachSeriesByType("themeRiver",function(l){var m=l.getData();var o=l.coordinateSystem;var k={};var n=o.getRect();k.rect=n;var i=l.get("boundaryGap");var j=o.getAxis();k.boundaryGap=i;if(j.orient==="horizontal"){i[0]=c.parsePercent(i[0],n.height);i[1]=c.parsePercent(i[1],n.height);var p=n.height-i[0]-i[1];a(m,l,p)}else{i[0]=c.parsePercent(i[0],n.width);i[1]=c.parsePercent(i[1],n.width);var h=n.width-i[0]-i[1];a(m,l,h)}m.setLayout("layoutInfo",k)})};function a(q,k,u){if(!q.count()){return}var l=k.getLayerSeries();var t=b.map(l,function(i){return b.map(i.indices,function(j){return k.coordinateSystem.dataToPoint([q.get("time",j),q.get("value",j)])})});var f=e(t);var v=f.y0;var r=u/f.max;var g=l.length;var h=l[0].indices.length;var s;for(var o=0;o<h;++o){s=v[o]*r;q.setItemLayout(l[0].indices[o],{layerIndex:0,x:t[0][o][0],y0:s,y:t[0][o][1]*r});for(var p=1;p<g;++p){s+=t[p-1][o][1]*r;q.setItemLayout(l[p].indices[o],{layerIndex:p,x:t[p][o][0],y0:s,y:t[p][o][1]*r})}}}function e(q){var o=q.length;var f=q[0].length;var r=[];var u=[];var t=0;var v;var g={};for(var p=0;p<f;++p){for(var n=0,v=0;n<o;++n){v+=q[n][p][1]}if(v>t){t=v}r.push(v)}for(var m=0;m<f;++m){u[m]=(t-r[m])/2}t=0;for(var h=0;h<f;++h){var s=r[h]+u[h];if(s>t){t=s}}g.y0=u;g.max=t;return g}});