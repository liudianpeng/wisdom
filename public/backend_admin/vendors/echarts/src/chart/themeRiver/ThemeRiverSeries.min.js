define(function(d){var i=d("../../data/helper/completeDimensions");var f=d("../../model/Series");var j=d("../../data/List");var e=d("zrender/core/util");var b=d("../../util/format");var h=b.encodeHTML;var c=d("../../util/array/nest");var a=2;var g=f.extend({type:"series.themeRiver",dependencies:["singleAxis"],nameMap:null,init:function(k){g.superApply(this,"init",arguments);this.legendDataProvider=function(){return this._dataBeforeProcessed}},fixData:function(v){var r=v.length;var C=c().key(function(k){return k[2]}).entries(v);var x=e.map(C,function(k){return{name:k.key,dataList:k.values}});var u=x.length;var B=-1;var z=-1;for(var w=0;w<u;++w){var y=x[w].dataList.length;if(y>B){B=y;z=w}}for(var s=0;s<u;++s){if(s===z){continue}var m=x[s].name;for(var t=0;t<B;++t){var p=x[z].dataList[t][0];var o=x[s].dataList.length;var n=-1;for(var q=0;q<o;++q){var A=x[s].dataList[q][0];if(A===p){n=q;break}}if(n===-1){v[r]=[];v[r][0]=p;v[r][1]=0;v[r][2]=m;r++}}}return v},getInitialData:function(p,q){var k=[];var l=q.getComponent("singleAxis",this.option.singleAxisIndex);var u=l.get("type");k=[{name:"time",type:u==="category"?"ordinal":u==="time"?"time":"float"},{name:"value",type:"float"},{name:"name",type:"ordinal"}];var o=this.fixData(p.data);var m=[];var t=this.nameMap={};var r=0;for(var n=0;n<o.length;++n){m.push(o[n][a]);if(!t[o[n][a]]){t[o[n][a]]=r++}}i(k,o);var s=new j(k,this);s.initData(o,m);return s},coordDimToDataDim:function(k){var l={oneDim:["time"]};return l[k]},getLayerSeries:function(){var q=this.getData();var p=q.count();var r=[];for(var l=0;l<p;++l){r[l]=l}var o=c().key(function(s){return q.get("name",s)}).entries(r);var n=e.map(o,function(s){return{name:s.key,indices:s.values}});for(var k=0;k<n.length;++k){n[k].indices.sort(m)}function m(t,s){return q.get("time",t)-q.get("time",s)}return n},getAxisTooltipDataIndex:function(r,u,l){if(!e.isArray(r)){r=r?[r]:[]}var p=this.getData();if(l.orient==="horizontal"){u=u[0]}else{u=u[1]}var m=this.getLayerSeries();var v=[];var o=m.length;for(var q=0;q<o;++q){var t=Number.MAX_VALUE;var w=-1;var k=m[q].indices.length;for(var n=0;n<k;++n){var s=Math.abs(p.get(r[0],m[q].indices[n])-u);if(s<=t){t=s;w=m[q].indices[n]}}v.push(w)}return v},formatTooltip:function(s){var n=this.getData();var q=s.length;var l=n.get("time",s[0]);var t=this.coordinateSystem;var m=t.getAxis();if(m.scale.type==="time"){l=b.formatTime("yyyy-MM-dd",l)}var p=l+"<br />";for(var o=0;o<q;++o){var r=n.get("name",s[o]);var k=n.get("value",s[o]);if(isNaN(k)||k==null){k="-"}p+=h(r)+" : "+k+"<br />"}return p},defaultOption:{zlevel:0,z:2,coordinateSystem:"single",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{normal:{margin:4,textAlign:"right",show:true,position:"left",textStyle:{color:"#000",fontSize:11}},emphasis:{show:true}}}});return g});