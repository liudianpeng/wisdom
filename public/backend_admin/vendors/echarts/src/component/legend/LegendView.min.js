define(function(d){var e=d("zrender/core/util");var c=d("../../util/symbol");var a=d("../../util/graphic");var j=d("../helper/listComponent");var h=e.curry;var b="#ccc";function f(k,l){l.dispatchAction({type:"legendToggleSelect",name:k})}function g(l,k,m){l.get("legendHoverLink")&&m.dispatchAction({type:"highlight",seriesName:l.name,name:k})}function i(l,k,m){l.get("legendHoverLink")&&m.dispatchAction({type:"downplay",seriesName:l.name,name:k})}return d("../../echarts").extendComponentView({type:"legend",init:function(){this._symbolTypeStore={}},render:function(o,k,n){var q=this.group;q.removeAll();if(!o.get("show")){return}var p=o.get("selectedMode");var l=o.get("align");if(l==="auto"){l=(o.get("left")==="right"&&o.get("orient")==="vertical")?"right":"left"}var m={};e.each(o.getData(),function(u){var t=u.get("name");if(t===""||t==="\n"){q.add(new a.Group({newline:true}));return}var s=k.getSeriesByName(t)[0];if(m[t]){return}if(s){var w=s.getData();var r=w.getVisual("color");if(typeof r==="function"){r=r(s.getDataParams(0))}var v=w.getVisual("legendSymbol")||"roundRect";var x=w.getVisual("symbol");var y=this._createItem(t,u,o,v,x,l,r,p);y.on("click",h(f,t,n)).on("mouseover",h(g,s,"",n)).on("mouseout",h(i,s,"",n));m[t]=true}else{k.eachRawSeries(function(B){if(m[t]){return}if(B.legendDataProvider){var D=B.legendDataProvider();var z=D.indexOfName(t);if(z<0){return}var A=D.getItemVisual(z,"color");var C="roundRect";var E=this._createItem(t,u,o,C,null,l,A,p);E.on("click",h(f,t,n)).on("mouseover",h(g,B,t,n)).on("mouseout",h(i,B,t,n));m[t]=true}},this)}},this);j.layout(q,o,n);j.addBackground(q,o)},_createItem:function(C,y,k,l,r,o,x,B){var m=k.get("itemWidth");var w=k.get("itemHeight");var q=k.isSelected(C);var A=new a.Group();var p=y.getModel("textStyle");var v=y.get("icon");l=v||l;A.add(c.createSymbol(l,0,0,m,w,q?x:b));if(!v&&r&&((r!==l)||r=="none")){var t=w*0.8;if(r==="none"){r="circle"}A.add(c.createSymbol(r,(m-t)/2,(w-t)/2,t,t,q?x:b))}var u=o==="left"?m+5:-5;var n=o;var z=k.get("formatter");if(typeof z==="string"&&z){C=z.replace("{name}",C)}else{if(typeof z==="function"){C=z(C)}}var s=new a.Text({style:{text:C,x:u,y:w/2,fill:q?p.getTextColor():b,textFont:p.getFont(),textAlign:n,textVerticalAlign:"middle"}});A.add(s);A.add(new a.Rect({shape:A.getBoundingRect(),invisible:true}));A.eachChild(function(D){D.silent=!B});this.group.add(A);a.setHoverStyle(A);return A}})});