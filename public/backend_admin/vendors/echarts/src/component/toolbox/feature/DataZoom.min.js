define(function(e){var o=e("zrender/core/util");var d=e("../../../util/number");var i=e("../../helper/SelectController");var a=e("zrender/core/BoundingRect");var n=e("zrender/container/Group");var h=e("../../dataZoom/history");var f=e("../../helper/interactionMutex");var c=o.each;var r=d.asc;e("../../dataZoomSelect");var k="\0_ec_\0toolbox-dataZoom_";function l(t){this.model=t;this._controllerGroup;this._controller;this._isZoomActive}l.defaultOption={show:true,icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:{zoom:"区域缩放",back:"区域缩放还原"}};var m=l.prototype;m.render=function(v,t,u){g(v,t)};m.onclick=function(t,v,u){var w=this._controllerGroup;if(!this._controllerGroup){w=this._controllerGroup=new n();v.getZr().add(w)}p[u].call(this,w,this.model,t,v)};m.remove=function(t,u){this._disposeController();f.release("globalPan",u.getZr())};m.dispose=function(t,u){var v=u.getZr();f.release("globalPan",v);this._disposeController();this._controllerGroup&&v.remove(this._controllerGroup)};var p={zoom:function(y,x,t,u){var v=this._isZoomActive=!this._isZoomActive;var w=u.getZr();f[v?"take":"release"]("globalPan",w);x.setIconStatus("zoom",v?"emphasis":"normal");if(v){w.setDefaultCursorStyle("crosshair");this._createController(y,x,t,u)}else{w.setDefaultCursorStyle("default");this._disposeController()}},back:function(w,v,t,u){this._dispatchAction(h.pop(t),u)}};m._createController=function(x,w,t,v){var u=this._controller=new i("rect",v.getZr(),{lineWidth:3,stroke:"#333",fill:"rgba(0,0,0,0.2)"});u.on("selectEnd",o.bind(this._onSelected,this,u,w,t,v));u.enable(x,false)};m._disposeController=function(){var t=this._controller;if(t){t.off("selected");t.dispose()}};function b(u,t){var v=[{axisModel:u.getAxis("x").model,axisIndex:0},{axisModel:u.getAxis("y").model,axisIndex:0}];v.grid=u;t.eachComponent({mainType:"dataZoom",subType:"select"},function(w,x){if(s("xAxis",v[0].axisModel,w,t)){v[0].dataZoomModel=w}if(s("yAxis",v[1].axisModel,w,t)){v[1].dataZoomModel=w}});return v}function s(w,v,x,t){var u=x.get(w+"Index");return u!=null&&t.getComponent(w,u)===v}m._onSelected=function(w,z,u,y,t){if(!t.length){return}var v=t[0];w.update();var x={};u.eachComponent("grid",function(G,F){var B=G.coordinateSystem;var D=b(B,u);var A=j(v,D);if(A){var C=q(A,D,0,"x");var E=q(A,D,1,"y");C&&(x[C.dataZoomId]=C);E&&(x[E.dataZoomId]=E)}},this);h.push(u,x);this._dispatchAction(x,y)};function j(t,v){var u=v.grid;var x=new a(t[0][0],t[1][0],t[0][1]-t[0][0],t[1][1]-t[1][0]);if(!x.intersect(u.getRect())){return}var w=u.getCartesian(v[0].axisIndex,v[1].axisIndex);var z=w.pointToData([t[0][0],t[1][0]],true);var y=w.pointToData([t[0][1],t[1][1]],true);return[r([z[0],y[0]]),r([z[1],y[1]])]}function q(t,v,u,x){var w=v[u];var y=w.dataZoomModel;if(y){return{dataZoomId:y.id,startValue:t[u][0],endValue:t[u][1]}}}m._dispatchAction=function(t,v){var u=[];c(t,function(w){u.push(w)});u.length&&v.dispatchAction({type:"dataZoom",from:this.uid,batch:o.clone(u,true)})};function g(u,t){u.setIconStatus("back",h.count(t)>1?"emphasis":"normal")}e("../featureManager").register("dataZoom",l);e("../../../echarts").registerPreprocessor(function(v){if(!v){return}var x=v.dataZoom||(v.dataZoom=[]);if(!o.isArray(x)){v.dataZoom=x=[x]}var y=v.toolbox;if(y){if(o.isArray(y)){y=y[0]}if(y&&y.feature){var u=y.feature.dataZoom;t("xAxis",u);t("yAxis",u)}}function t(C,A){if(!A){return}var z=C+"Index";var B=A[z];if(B!=null&&!o.isArray(B)){B=B===false?[]:[B]}w(C,function(D,E){if(B!=null&&o.indexOf(B,E)===-1){return}var F={type:"select",$fromToolbox:true,id:k+C+E};F[z]=E;x.push(F)})}function w(B,z){var A=v[B];if(!o.isArray(A)){A=A?[A]:[]}c(A,z)}});return l});