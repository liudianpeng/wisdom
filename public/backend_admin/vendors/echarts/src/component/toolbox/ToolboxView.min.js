define(function(c){var i=c("./featureManager");var d=c("zrender/core/util");var a=c("../../util/graphic");var b=c("../../model/Model");var g=c("../../data/DataDiffer");var f=c("../helper/listComponent");var e=c("zrender/contain/text");return c("../../echarts").extendComponentView({type:"toolbox",render:function(p,m,n){var q=this.group;q.removeAll();if(!p.get("show")){return}var r=+p.get("itemSize");var s=p.get("feature")||{};var k=this._features||(this._features={});var l=[];d.each(s,function(u,t){l.push(t)});(new g(this._featureNames||[],l)).add(j).update(j).remove(d.curry(j,null)).execute();this._featureNames=l;function j(w,A){var u=l[w];var x=l[A];var z=s[u];var y=new b(z,p,p.ecModel);var v;if(u&&!x){if(h(u)){v={model:y,onclick:y.option.onclick,featureName:u}}else{var t=i.get(u);if(!t){return}v=new t(y)}k[u]=v}else{v=k[x];if(!v){return}v.model=y}if(!u&&x){v.dispose&&v.dispose(m,n);return}if(!y.get("show")||v.unusable){v.remove&&v.remove(m,n);return}o(y,v,u);y.setIconStatus=function(E,B){var D=this.option;var C=this.iconPaths;D.iconStatus=D.iconStatus||{};D.iconStatus[E]=B;C[E]&&C[E].trigger(B)};if(v.render){v.render(y,m,n)}}function o(z,B,A){var u=z.getModel("iconStyle");var y=B.getIcons?B.getIcons():z.get("icon");var v=z.get("title")||{};if(typeof y==="string"){var w=y;var x=v;y={};v={};y[A]=w;v[A]=x}var t=z.iconPaths={};d.each(y,function(D,H){var G=u.getModel("normal").getItemStyle();var E=u.getModel("emphasis").getItemStyle();var C={x:-r/2,y:-r/2,width:r,height:r};var F=D.indexOf("image://")===0?(C.image=D.slice(8),new a.Image({style:C})):a.makePath(D.replace("path://",""),{style:G,hoverStyle:E,rectHover:true},C,"center");a.setHoverStyle(F);if(p.get("showTitle")){F.__title=v[H];F.on("mouseover",function(){F.setStyle({text:v[H],textPosition:E.textPosition||"bottom",textFill:E.fill||E.stroke||"#000",textAlign:E.textAlign||"center"})}).on("mouseout",function(){F.setStyle({textFill:null})})}F.trigger(z.get("iconStatus."+H)||"normal");q.add(F);F.on("click",d.bind(B.onclick,B,m,n,H));t[H]=F})}f.layout(q,p,n);f.addBackground(q,p);q.eachChild(function(x){var u=x.__title;var z=x.hoverStyle;if(z&&u){var y=e.getBoundingRect(u,z.font);var t=x.position[0]+q.position[0];var A=x.position[1]+q.position[1]+r;var w=false;if(A+y.height>n.getHeight()){z.textPosition="top";w=true}var v=w?(-5-y.height):(r+8);if(t+y.width/2>n.getWidth()){z.textPosition=["100%",v];z.textAlign="right"}else{if(t-y.width/2<0){z.textPosition=[0,v];z.textAlign="left"}}}})},remove:function(j,k){d.each(this._features,function(l){l.remove&&l.remove(j,k)});this.group.removeAll()},dispose:function(j,k){d.each(this._features,function(l){l.dispose&&l.dispose(j,k)})}});function h(j){return j.indexOf("my")===0}});