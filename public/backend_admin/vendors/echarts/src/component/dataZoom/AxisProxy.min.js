define(function(e){var f=e("zrender/core/util");var d=e("../../util/number");var g=f.each;var h=d.asc;var c=function(m,l,n,k){this._dimName=m;this._axisIndex=l;this._valueWindow;this._percentWindow;this._dataExtent;this.ecModel=k;this._dataZoomModel=n};c.prototype={constructor:c,hostedBy:function(k){return this._dataZoomModel===k},getDataExtent:function(){return this._dataExtent.slice()},getDataValueWindow:function(){return this._valueWindow.slice()},getDataPercentWindow:function(){return this._percentWindow.slice()},getTargetSeriesModels:function(){var k=[];this.ecModel.eachSeries(function(l){if(this._axisIndex===l.get(this._dimName+"AxisIndex")){k.push(l)}},this);return k},getAxisModel:function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},getOtherAxisModel:function(){var m=this._dimName;var k=this.ecModel;var l=this.getAxisModel();var q=m==="x"||m==="y";var o;var n;if(q){n="gridIndex";o=m==="x"?"y":"x"}else{n="polarIndex";o=m==="angle"?"radius":"angle"}var p;k.eachComponent(o+"Axis",function(r){if((r.get(n)||0)===(l.get(n)||0)){p=r}});return p},reset:function(m){if(m!==this._dataZoomModel){return}var k=this._dataExtent=j(this._dimName,this.getTargetSeriesModels());var l=i(m.option,k,this);this._valueWindow=l.valueWindow;this._percentWindow=l.percentWindow;a(this)},restore:function(k){if(k!==this._dataZoomModel){return}this._valueWindow=this._percentWindow=null;a(this,true)},filterData:function(q){if(q!==this._dataZoomModel){return}var m=this._dimName;var l=this.getTargetSeriesModels();var p=q.get("filterMode");var n=this._valueWindow;var k=this.getOtherAxisModel();if(q.get("$fromToolbox")&&k&&k.get("type")==="category"){p="empty"}g(l,function(r){var s=r.getData();s&&g(r.coordDimToDataDim(m),function(t){if(p==="empty"){r.setData(s.map(t,function(u){return !o(u)?NaN:u}))}else{s.filterSelf(t,o)}})});function o(r){return r>=n[0]&&r<=n[1]}}};function j(l,k){var m=[Infinity,-Infinity];g(k,function(n){var o=n.getData();if(o){g(n.coordDimToDataDim(l),function(q){var p=o.getDataExtent(q);p[0]<m[0]&&(m[0]=p[0]);p[1]>m[1]&&(m[1]=p[1])})}},this);return m}function i(n,q,o){var m=o.getAxisModel();var r=m.axis.scale;var k=[0,100];var l=[n.start,n.end];var p=[];q=q.slice();b(q,m,r);g(["startValue","endValue"],function(s){p.push(n[s]!=null?r.parse(n[s]):null)});g([0,1],function(s){var u=p[s];var t=l[s];if(t!=null||u==null){if(t==null){t=k[s]}u=r.parse(d.linearMap(t,k,q,true))}else{t=d.linearMap(u,q,k,true)}p[s]=u;l[s]=t});return{valueWindow:h(p),percentWindow:h(l)}}function b(l,k,m){g(["min","max"],function(n,o){var p=k.get(n,true);if(p!=null&&(p+"").toLowerCase()!=="data"+n){l[o]=m.parse(p)}});if(!k.get("scale",true)){l[0]>0&&(l[0]=0);l[1]<0&&(l[1]=0)}return l}function a(k,l){var s=k.getAxisModel();var p=k._percentWindow;var o=k._valueWindow;if(!p){return}var m=l||(p[0]===0&&p[1]===100);var q=!l&&d.getPixelPrecision(o,[0,500]);var n=!l&&!(q<20&&q>=0);var r=l||m||n;s.setRange&&s.setRange(r?null:+o[0].toFixed(q),r?null:+o[1].toFixed(q))}return c});