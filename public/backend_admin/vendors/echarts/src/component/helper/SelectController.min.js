define(function(h){var d=h("zrender/mixin/Eventful");var r=h("zrender/core/util");var n=h("../../util/graphic");var A=r.bind;var b=r.each;var f=Math.min;var j=Math.max;var x=Math.pow;var w=10000;var l=2;var a=["mousedown","mousemove","mouseup"];function m(C,D,B){d.call(this);this.type=C;this.zr=D;this.opt=r.clone(B);this.group=new n.Group();this._containerRect=null;this._track=[];this._dragging;this._cover;this._disabled=true;this._handlers={mousedown:A(s,this),mousemove:A(y,this),mouseup:A(u,this)};b(a,function(E){this.zr.on(E,this._handlers[E])},this)}m.prototype={constructor:m,enable:function(B,C){this._disabled=false;i.call(this);this._containerRect=C!==false?(C||B.getBoundingRect()):null;B.add(this.group)},update:function(B){o.call(this,B&&r.clone(B))},disable:function(){this._disabled=true;i.call(this)},dispose:function(){this.disable();b(a,function(B){this.zr.off(B,this._handlers[B])},this)}};r.mixin(m,d);function z(B){B.traverse(function(C){C.z=w})}function c(B,D){var C=this.group.transformCoordToLocal(B,D);return !this._containerRect||this._containerRect.contain(C[0],C[1])}function g(B){var C=B.event;C.preventDefault&&C.preventDefault()}function s(C){if(this._disabled||(C.target&&C.target.draggable)){return}g(C);var B=C.offsetX;var D=C.offsetY;if(c.call(this,B,D)){this._dragging=true;this._track=[[B,D]]}}function y(B){if(!this._dragging||this._disabled){return}g(B);q.call(this,B)}function u(B){if(!this._dragging||this._disabled){return}g(B);q.call(this,B,true);this._dragging=false;this._track=[]}function q(E,D){var B=E.offsetX;var F=E.offsetY;if(c.call(this,B,F)){this._track.push([B,F]);var C=v.call(this)?t[this.type].getRanges.call(this):[];o.call(this,C);this.trigger("selected",r.clone(C));if(D){this.trigger("selectEnd",r.clone(C))}}}function v(){var C=this._track;if(!C.length){return false}var E=C[C.length-1];var G=C[0];var D=E[0]-G[0];var B=E[1]-G[1];var F=x(D*D+B*B,0.5);return F>l}function o(C){var B=t[this.type];if(C&&C.length){if(!this._cover){this._cover=B.create.call(this);this.group.add(this._cover)}B.update.call(this,C)}else{this.group.remove(this._cover);this._cover=null}z(this.group)}function i(){var C=this.group;var B=C.parent;if(B){B.remove(C)}}function k(){var B=this.opt;return new n.Rect({style:{stroke:B.stroke,fill:B.fill,lineWidth:B.lineWidth,opacity:B.opacity}})}function p(){return r.map(this._track,function(B){return this.group.transformCoordToLocal(B[0],B[1])},this)}function e(){var C=p.call(this);var B=C.length-1;B<0&&(B=0);return[C[0],C[B]]}var t={line:{create:k,getRanges:function(){var C=e.call(this);var D=f(C[0][0],C[1][0]);var B=j(C[0][0],C[1][0]);return[[D,B]]},update:function(B){var C=B[0];var D=this.opt.width;this._cover.setShape({x:C[0],y:-D/2,width:C[1]-C[0],height:D})}},rect:{create:k,getRanges:function(){var C=e.call(this);var D=[f(C[1][0],C[0][0]),f(C[1][1],C[0][1])];var B=[j(C[1][0],C[0][0]),j(C[1][1],C[0][1])];return[[[D[0],B[0]],[D[1],B[1]]]]},update:function(B){var C=B[0];this._cover.setShape({x:C[0][0],y:C[1][0],width:C[0][1]-C[0][0],height:C[1][1]-C[1][0]})}}};return m});