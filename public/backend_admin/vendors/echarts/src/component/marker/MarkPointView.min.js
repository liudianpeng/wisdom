define(function(f){var l=f("../../chart/helper/SymbolDraw");var g=f("zrender/core/util");var b=f("../../util/format");var m=f("../../util/model");var e=f("../../util/number");var h=b.addCommas;var i=b.encodeHTML;var k=f("../../data/List");var a=f("./markerHelper");function d(q,n,p){var o=n.coordinateSystem;q.each(function(t){var u=q.getItemModel(t);var s;var z=u.getShallow("x");var v=u.getShallow("y");if(z!=null&&v!=null){s=[e.parsePercent(z,p.getWidth()),e.parsePercent(v,p.getHeight())]}else{if(n.getMarkerPosition){s=n.getMarkerPosition(q.getValues(q.dimensions,t))}else{if(o){var r=q.get(o.dimensions[0],t);var w=q.get(o.dimensions[1],t);s=o.dataToPoint([r,w])}}}q.setItemLayout(t,s)})}var j={formatTooltip:function(o){var r=this.getData();var q=this.getRawValue(o);var p=g.isArray(q)?g.map(q,h).join(", "):h(q);var n=r.getName(o);return this.name+"<br />"+((n?i(n)+" : ":"")+p)},getData:function(){return this._data},setData:function(n){this._data=n}};g.defaults(j,m.dataFormatMixin);f("../../echarts").extendComponentView({type:"markPoint",init:function(){this._symbolDrawMap={}},render:function(r,n,q){var p=this._symbolDrawMap;for(var o in p){p[o].__keep=false}n.eachSeries(function(s){var t=s.markPointModel;t&&this._renderSeriesMP(s,t,q)},this);for(var o in p){if(!p[o].__keep){p[o].remove();this.group.remove(p[o].group)}}},updateLayout:function(p,n,o){n.eachSeries(function(q){var r=q.markPointModel;if(r){d(r.getData(),q,o);this._symbolDrawMap[q.name].updateLayout(r)}},this)},_renderSeriesMP:function(p,t,s){var q=p.coordinateSystem;var u=p.name;var o=p.getData();var v=this._symbolDrawMap;var n=v[u];if(!n){n=v[u]=new l()}var r=c(q,p,t);g.mixin(t,j);t.setData(r);d(t.getData(),p,s);r.each(function(w){var x=r.getItemModel(w);var y=x.getShallow("symbolSize");if(typeof y==="function"){y=y(t.getRawValue(w),t.getDataParams(w))}r.setItemVisual(w,{symbolSize:y,color:x.get("itemStyle.normal.color")||o.getVisual("color"),symbol:x.getShallow("symbol")})});n.updateData(r);this.group.add(n.group);r.eachItemGraphicEl(function(w){w.traverse(function(x){x.dataModel=t})});n.__keep=true}});function c(o,n,s){var p;if(o){p=g.map(o&&o.dimensions,function(t){var u=n.getData().getDimensionInfo(n.coordDimToDataDim(t)[0])||{};u.name=t;return u})}else{p=[{name:"value",type:"float"}]}var q=new k(p,s);var r=g.map(s.get("data"),g.curry(a.dataTransform,n));if(o){r=g.filter(r,g.curry(a.dataFilter,o))}q.initData(r,null,o?a.dimValueGetter:function(t){return t.value});return q}});