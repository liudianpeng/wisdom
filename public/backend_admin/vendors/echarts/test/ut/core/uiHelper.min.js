(function(b){var c=b.uiHelper={};var d="stack";var a=true;var g=document.createElement("div");g.setAttribute("id","failed-panel");var e=false;c.expectEqualCanvasContent=function(k,i,h){var j=this;window.require(["oldEcharts","newEcharts"],function(l,n){var m=i(l).toDataURL();var o=i(n).toDataURL();if(a||m!==o){j.addFailedCases(k,m,o)}expect(m).toEqual(o);h()})};c.expectEqualCanvasStack=function(j,i,h){window.require(["oldEcharts","newEcharts"],function(l,q){var k=i(l);var m=i(q);var p=k.toDataURL();var r=m.toDataURL();if(a||p!==r){c.addFailedCases(j,p,r)}var n=k.getContext("2d");var o=m.getContext("2d");expect(n.hash()).toEqual(o.hash());h()})};c.expectEqualCanvas=function(j,i,h){if(d==="content"){c.expectEqualCanvasContent(j,i,h)}else{if(d==="stack"){c.expectEqualCanvasStack(j,i,h)}else{console.error("Invalid equal canvas strategy!")}}};var f=function(k,j,i,h){it(j,function(l){window.require(["newEcharts"],function(o){var r=c.getRenderedCanvas(o,function(u){u.setOption(c.preprocessOption(i))});var q=c.getRenderedCanvas(o,function(u){u.setOption(c.preprocessOption(h))});var n=r.getContext("2d");var m=q.getContext("2d");var t=r.toDataURL();var s=q.toDataURL();var p=compare2=null;if(d==="content"){p=t;compare2=s}else{if(d==="stack"){p=n.hash();compare2=m.hash()}else{console.error("Invalid equal canvas strategy!")}}if(k){expect(p).toEqual(compare2)}else{expect(p).not.toEqual(compare2)}if(a||(p===compare2)^k){c.addFailedCases(j,t,s)}l()})})};c.expectEqualOption=function(j,i,h){f(true,j,i,h)};c.expectNotEqualOption=function(j,i,h){f(false,j,i,h)};c.getRenderedCanvas=function(k,j){var i=document.createElement("canvas");i.width=400;i.height=300;var h=k.init(i);j(h);return i};c.testOption=function(i,j){var h=function(l){var k=c.getRenderedCanvas(l,function(m){m.setOption(c.preprocessOption(j))});return k};it(i,function(k){if(d==="content"){c.expectEqualCanvasContent(i,h,k)}else{if(d==="stack"){c.expectEqualCanvasStack(i,h,k)}else{console.error("Invalid equal canvas strategy!")}}})};c.preprocessOption=function(h){if(typeof h.animation==="undefined"){h.animation=false}return h};c.testOptionSpec=function(k,i){for(var h=0,j=i.length;h<j;++h){(function(m,l){describe(m,function(){for(var p=0,n=l.length;p<n;++p){var o=k+" - "+m+": "+l[p].name;if(l[p].test==="equalOption"){c.expectEqualOption(o,l[p].option1,l[p].option2)}else{if(l[p].test==="notEqualOption"){c.expectNotEqualOption(o,l[p].option1,l[p].option2)}else{c.testOption(o,l[p].option)}}}})})(i[h].name,i[h].cases)}};c.addFailedCases=function(j,s,i){var q=document.createElement("div");var o=document.createElement("h6");o.innerHTML=j+". Here are old, new, and diff images.";q.appendChild(o);var h=document.createElement("img");h.src=s;h.setAttribute("title","Old Image");var m=document.createElement("img");m.src=i;m.setAttribute("title","New Image");q.appendChild(h);q.appendChild(m);var p=imagediff.diff(h,m);var k=document.createElement("canvas");k.width=h.width;k.height=h.height;var r=k.getContext("2d");r.putImageData(p,0,0);var l=document.createElement("img");l.src=k.toDataURL();l.setAttribute("title","Diff Image");q.appendChild(l);g.appendChild(q);if(!e){var n=document.getElementsByTagName("body")[0];n.appendChild(g);e=true}}})(window);