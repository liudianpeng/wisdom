describe("modelAndOptionMapping",function(){var b=window.utHelper;var f=b.prepare(["echarts/component/grid","echarts/chart/line","echarts/chart/pie","echarts/chart/bar","echarts/component/toolbox","echarts/component/dataZoom"]);function i(n,m){return k(n,m).getData().get("y",0)}function k(n,m){return n.getModel().getComponent("series",m)}function a(o,n,m){return o.getModel().getComponent(n,m)}function l(m){return c(m,"series")}function c(n,m){return n.getModel()._componentsMap[m].length}function d(n,m){return n._chartsMap[m.__viewId]}function e(m){return m._chartsViews.length}function j(o){var p=l(o);var q=[];for(var n=0;n<p;n++){var m=k(o,n);q.push({model:m,view:d(o,m)})}return q}function h(p,r,q,n){for(var o=0;o<r.length;o++){var m=r[o];expect(q[m].model===k(p,m)).toEqual(n)}}function g(p,r,q,n){for(var o=0;o<r.length;o++){var m=r[o];expect(q[m].view===d(p,k(p,m))).toEqual(n)}}describe("idNoNameNo",function(){f.createChart()("sameTypeNotMerge",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22]},{type:"line",data:[33]}]};var m=this.chart;m.setOption(n);var o=j(m);m.setOption(n,true);expect(e(m)).toEqual(3);expect(l(m)).toEqual(3);h(m,[0,1,2],o,false);g(m,[0,1,2],o,true)});f.createChart()("sameTypeMergeFull",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22]},{type:"line",data:[33]}]};var m=this.chart;m.setOption(n);var o=j(m);m.setOption({series:[{type:"line",data:[111]},{type:"line",data:[222]},{type:"line",data:[333]}]});expect(l(m)).toEqual(3);expect(e(m)).toEqual(3);expect(i(m,0)).toEqual(111);expect(i(m,1)).toEqual(222);expect(i(m,2)).toEqual(333);g(m,[0,1,2],o,true);h(m,[0,1,2],o,true)});f.createChart()("sameTypeMergePartial",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22]},{type:"line",data:[33]}]};var m=this.chart;m.setOption(n);var o=j(m);m.setOption({series:[{type:"line",data:[22222]}]});expect(l(m)).toEqual(3);expect(e(m)).toEqual(3);expect(i(m,0)).toEqual(22222);expect(i(m,1)).toEqual(22);expect(i(m,2)).toEqual(33);g(m,[0,1,2],o,true);h(m,[0,1,2],o,true)});f.createChart()("differentTypeMerge",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22]},{type:"line",data:[33]}]};var m=this.chart;m.setOption(n);var o=j(m);m.setOption({series:[{type:"line",data:[111]},{type:"bar",data:[222]},{type:"line",data:[333]}]});expect(l(m)).toEqual(3);expect(e(m)).toEqual(3);expect(i(m,0)).toEqual(111);expect(i(m,1)).toEqual(222);expect(i(m,2)).toEqual(333);expect(k(m,1).type==="series.bar").toEqual(true);h(m,[0,2],o,true);h(m,[1],o,false);g(m,[0,2],o,true);g(m,[1],o,false)})});describe("idSpecified",function(){f.createChart()("sameTypeNotMerge",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],id:20},{type:"line",data:[33],id:30},{type:"line",data:[44]},{type:"line",data:[55]}]};var m=this.chart;m.setOption(n);expect(l(m)).toEqual(5);expect(e(m)).toEqual(5);expect(i(m,0)).toEqual(11);expect(i(m,1)).toEqual(22);expect(i(m,2)).toEqual(33);expect(i(m,3)).toEqual(44);expect(i(m,4)).toEqual(55);var o=j(m);m.setOption(n,true);expect(e(m)).toEqual(5);expect(l(m)).toEqual(5);h(m,[0,1,2,3,4],o,false);g(m,[0,1,2,3,4],o,true)});f.createChart()("sameTypeMerge",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],id:20},{type:"line",data:[33],id:30},{type:"line",data:[44]},{type:"line",data:[55]}]};var m=this.chart;m.setOption(n);var o=j(m);m.setOption(n);expect(e(m)).toEqual(5);expect(l(m)).toEqual(5);h(m,[0,1,2,3,4],o,true);g(m,[0,1,2,3,4],o,true)});f.createChart()("differentTypeNotMerge",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],id:20},{type:"line",data:[33],id:30},{type:"line",data:[44]},{type:"line",data:[55]}]};var n=this.chart;n.setOption(o);var p=j(n);var m={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"bar",data:[22],id:20},{type:"line",data:[33],id:30},{type:"bar",data:[44]},{type:"line",data:[55]}]};n.setOption(m,true);expect(e(n)).toEqual(5);expect(l(n)).toEqual(5);h(n,[0,1,2,3,4],p,false);g(n,[0,2,4],p,true);g(n,[1,3],p,false)});f.createChart()("differentTypeMergeFull",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],id:20},{type:"line",data:[33],id:30,name:"a"},{type:"line",data:[44]},{type:"line",data:[55]}]};var n=this.chart;n.setOption(o);var p=j(n);var m={series:[{type:"line",data:[11]},{type:"bar",data:[22],id:20,name:"a"},{type:"line",data:[33],id:30},{type:"bar",data:[44]},{type:"line",data:[55]}]};n.setOption(m);expect(e(n)).toEqual(5);expect(l(n)).toEqual(5);h(n,[0,2,4],p,true);h(n,[1,3],p,false);g(n,[0,2,4],p,true);g(n,[1,3],p,false)});f.createChart()("differentTypeMergePartial1",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],id:20},{type:"line",data:[33]},{type:"line",data:[44],id:40},{type:"line",data:[55]}]};var n=this.chart;n.setOption(o);var p=j(n);var m={series:[{type:"bar",data:[444],id:40},{type:"line",data:[333]},{type:"line",data:[222],id:20}]};n.setOption(m);expect(e(n)).toEqual(5);expect(l(n)).toEqual(5);expect(i(n,0)).toEqual(333);expect(i(n,1)).toEqual(222);expect(i(n,2)).toEqual(33);expect(i(n,3)).toEqual(444);expect(i(n,4)).toEqual(55);h(n,[0,1,2,4],p,true);h(n,[3],p,false);g(n,[0,1,2,4],p,true);g(n,[3],p,false)});f.createChart()("differentTypeMergePartial2",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],id:20}]};var n=this.chart;n.setOption(o);var m={series:[{type:"bar",data:[444],id:40},{type:"line",data:[333]},{type:"line",data:[222],id:20},{type:"line",data:[111]}]};n.setOption(m);expect(e(n)).toEqual(4);expect(l(n)).toEqual(4);expect(i(n,0)).toEqual(333);expect(i(n,1)).toEqual(222);expect(i(n,2)).toEqual(444);expect(i(n,3)).toEqual(111)});f.createChart()("mergePartialDoNotMapToOtherId",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11],id:10},{type:"line",data:[22],id:20}]};var n=this.chart;n.setOption(o);var m={series:[{type:"bar",data:[444],id:40}]};n.setOption(m);expect(e(n)).toEqual(3);expect(l(n)).toEqual(3);expect(i(n,0)).toEqual(11);expect(i(n,1)).toEqual(22);expect(i(n,2)).toEqual(444)});f.createChart()("idDuplicate",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11],id:10},{type:"line",data:[22],id:10}]};var m=this.chart;expect(function(){m.setOption(n)}).toThrowError(/duplicate/)})});describe("noIdButNameExists",function(){f.createChart()("sameTypeNotMerge",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],name:"a"},{type:"line",data:[33],name:"b"},{type:"line",data:[44]},{type:"line",data:[55],name:"a"}]};var m=this.chart;m.setOption(n);expect(k(m,1)).not.toEqual(k(m,4));expect(l(m)).toEqual(5);expect(e(m)).toEqual(5);expect(i(m,0)).toEqual(11);expect(i(m,1)).toEqual(22);expect(i(m,2)).toEqual(33);expect(i(m,3)).toEqual(44);expect(i(m,4)).toEqual(55);var o=j(m);m.setOption(n,true);expect(e(m)).toEqual(5);expect(l(m)).toEqual(5);h(m,[0,1,2,3,4],o,false);g(m,[0,1,2,3,4],o,true)});f.createChart()("sameTypeMerge",function(){var n={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],name:"a"},{type:"line",data:[33],name:"b"},{type:"line",data:[44]},{type:"line",data:[55],name:"a"}]};var m=this.chart;m.setOption(n);var o=j(m);m.setOption(n);expect(e(m)).toEqual(5);expect(l(m)).toEqual(5);h(m,[0,1,2,3,4],o,true);g(m,[0,1,2,3,4],o,true)});f.createChart()("differentTypeNotMerge",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],name:"a"},{type:"line",data:[33],name:"b"},{type:"line",data:[44]},{type:"line",data:[55],name:"a"}]};var n=this.chart;n.setOption(o);var p=j(n);var m={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"bar",data:[22],name:"a"},{type:"line",data:[33],name:"b"},{type:"bar",data:[44]},{type:"line",data:[55],name:"a"}]};n.setOption(m,true);expect(e(n)).toEqual(5);expect(l(n)).toEqual(5);h(n,[0,1,2,3,4],p,false);g(n,[0,2,4],p,true);g(n,[1,3],p,false)});f.createChart()("differentTypeMergePartialOneMapTwo",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],name:"a"},{type:"line",data:[33]},{type:"line",data:[44],name:"b"},{type:"line",data:[55],name:"a"}]};var n=this.chart;n.setOption(o);var p=j(n);var m={series:[{type:"bar",data:[444],id:40},{type:"line",data:[333]},{type:"bar",data:[222],name:"a"}]};n.setOption(m);expect(e(n)).toEqual(6);expect(l(n)).toEqual(6);expect(i(n,0)).toEqual(333);expect(i(n,1)).toEqual(222);expect(i(n,2)).toEqual(33);expect(i(n,3)).toEqual(44);expect(i(n,4)).toEqual(55);expect(i(n,5)).toEqual(444);h(n,[0,2,3,4],p,true);h(n,[1],p,false);g(n,[0,2,3,4],p,true);g(n,[1],p,false)});f.createChart()("differentTypeMergePartialTwoMapOne",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22],name:"a"}]};var n=this.chart;n.setOption(o);var m={series:[{type:"bar",data:[444],name:"a"},{type:"line",data:[333]},{type:"line",data:[222],name:"a"},{type:"line",data:[111]}]};n.setOption(m);expect(e(n)).toEqual(4);expect(l(n)).toEqual(4);expect(i(n,0)).toEqual(333);expect(i(n,1)).toEqual(444);expect(i(n,2)).toEqual(222);expect(i(n,3)).toEqual(111)});f.createChart()("mergePartialCanMapToOtherName",function(){var o={xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11],name:10},{type:"line",data:[22],name:20}]};var n=this.chart;n.setOption(o);var m={series:[{type:"bar",data:[444],name:40},{type:"bar",data:[999],name:40},{type:"bar",data:[777],id:70}]};n.setOption(m);expect(e(n)).toEqual(3);expect(l(n)).toEqual(3);expect(i(n,0)).toEqual(444);expect(i(n,1)).toEqual(999);expect(i(n,2)).toEqual(777)})});describe("ohters",function(){f.createChart()("aBugCase",function(){var n={series:[{type:"pie",radius:["20%","25%"],center:["20%","20%"],avoidLabelOverlap:true,hoverAnimation:false,label:{normal:{show:true,position:"center",textStyle:{fontSize:"30",fontWeight:"bold"}},emphasis:{show:true}},data:[{value:135,name:"视频广告"},{value:1548}]}]};var m=this.chart;m.setOption(n);m.setOption({series:[{type:"pie",radius:["20%","25%"],center:["20%","20%"],avoidLabelOverlap:true,hoverAnimation:false,label:{normal:{show:true,position:"center",textStyle:{fontSize:"30",fontWeight:"bold"}}},data:[{value:135,name:"视频广告"},{value:1548}]},{type:"pie",radius:["20%","25%"],center:["60%","20%"],avoidLabelOverlap:true,hoverAnimation:false,label:{normal:{show:true,position:"center",textStyle:{fontSize:"30",fontWeight:"bold"}}},data:[{value:135,name:"视频广告"},{value:1548}]}]},true);expect(e(m)).toEqual(2);expect(l(m)).toEqual(2)});f.createChart()("color",function(){var n={backgroundColor:"rgba(1,1,1,1)",xAxis:{data:["a"]},yAxis:{},series:[{type:"line",data:[11]},{type:"line",data:[22]},{type:"line",data:[33]}]};var m=this.chart;m.setOption(n);expect(m._model.option.backgroundColor).toEqual("rgba(1,1,1,1)");m.setOption({backgroundColor:"#fff"},true);expect(m._model.option.backgroundColor).toEqual("#fff")});f.createChart()("innerId",function(){var n={xAxis:{data:["a"]},yAxis:{},toolbox:{feature:{dataZoom:{}}},dataZoom:[{type:"inside",id:"a"},{type:"slider",id:"b"}],series:[{type:"line",data:[11]},{type:"line",data:[22]}]};var m=this.chart;m.setOption(n);expect(c(m,"dataZoom")).toEqual(4);expect(a(m,"dataZoom",0).id).toEqual("a");expect(a(m,"dataZoom",1).id).toEqual("b");m.setOption({dataZoom:[{type:"slider",id:"c"},{type:"slider",name:"x"}]});expect(c(m,"dataZoom")).toEqual(5);expect(a(m,"dataZoom",0).id).toEqual("a");expect(a(m,"dataZoom",1).id).toEqual("b");expect(a(m,"dataZoom",4).id).toEqual("c")})})});