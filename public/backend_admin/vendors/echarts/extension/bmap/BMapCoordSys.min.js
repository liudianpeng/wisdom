define(function(b){var d=b("echarts");function e(f,g){this._bmap=f;this.dimensions=["lng","lat"];this._mapOffset=[0,0];this._api=g}e.prototype.dimensions=["lng","lat"];e.prototype.setMapOffset=function(f){this._mapOffset=f};e.prototype.getBMap=function(){return this._bmap};e.prototype.dataToPoint=function(i){var f=new BMap.Point(i[0],i[1]);var h=this._bmap.pointToOverlayPixel(f);var g=this._mapOffset;return[h.x-g[0],h.y-g[1]]};e.prototype.pointToData=function(g){var f=this._mapOffset;var g=this._bmap.overlayPixelToPoint({x:g[0]+f[0],y:g[1]+f[1]});return[g.lng,g.lat]};e.prototype.getViewRect=function(){var f=this._api;return new d.graphic.BoundingRect(0,0,f.getWidth(),f.getHeight())};e.prototype.getRoamTransform=function(){return d.matrix.create()};var a;e.dimensions=e.prototype.dimensions;function c(){function f(g){this._root=g}f.prototype=new BMap.Overlay();f.prototype.initialize=function(g){g.getPanes().labelPane.appendChild(this._root);return this._root};f.prototype.draw=function(){};return f}e.create=function(f,i){var h;var g=i.getDom();f.eachComponent("bmap",function(q){var o=i.getZr().painter.getViewportRoot();if(typeof BMap==="undefined"){throw new Error("BMap api is not loaded")}a=a||c();if(h){throw new Error("Only one bmap component can exist")}if(!q.__bmap){var p=g.querySelector(".ec-extension-bmap");if(p){o.style.left="0px";o.style.top="0px";g.removeChild(p)}p=document.createElement("div");p.style.cssText="width:100%;height:100%";p.classList.add("ec-extension-bmap");g.appendChild(p);var k=q.__bmap=new BMap.Map(p);var l=new a(o);k.addOverlay(l)}var k=q.__bmap;var j=q.get("center");var m=q.get("zoom");if(j&&m){var n=new BMap.Point(j[0],j[1]);k.centerAndZoom(n,m)}h=new e(k,i);h.setMapOffset(q.__mapOffset||[0,0]);q.coordinateSystem=h});f.eachSeries(function(j){if(j.get("coordinateSystem")==="bmap"){j.coordinateSystem=h}})};return e});