!(function(b){var a=function(d,c){this.init(b(d),c)};a.prototype={options:{url:null,handler:null,template:null,sort:{enabled:false,name:"sort",values:["id","date"],labels:["Identifier","Date"]},direction:{enabled:false,name:"direction",values:["desc","asc"],labels:["Descending","Ascending"]},filters:{ebabled:false,name:"filters",values:[],labels:[]}},init:function(c,d){this.$element=c;this.options=b.extend(true,{},this.options,d);this._xhrCache={};if(!this.options.url||!this.options.handler||!this.options.template){throw new Error("You must define a widget url, an ajax handler and a template")}this._initActions()._initFromDOM().fetch()},_initActions:function(){var c,d;this.$actions=b('<span class="uwidget-actions"></span>');if(this.options.sort.enabled){this.$sort=b('<select name="'+this.options.sort.name+'"></select>').on("change",false,b.proxy(this._updateActions,this));for(c=0;c<this.options.sort.values.length;c++){this.$sort.append('<option value="'+this.options.sort.values[c]+'">'+this.options.sort.labels[c]+"</option>")}this.$actions.append(this.$sort)}if(this.options.direction.enabled){this.$direction=b('<select name="'+this.options.direction.name+'"></select>').on("change",false,b.proxy(this._updateActions,this));for(c=0;c<this.options.direction.values.length;c++){this.$direction.append('<option value="'+this.options.direction.values[c]+'">'+this.options.direction.labels[c]+"</option>")}this.$actions.append(this.$direction)}if(this.options.filters.enabled){this.$filters=b('<span class="filters"></span>').on("change",false,b.proxy(this._updateActions,this));for(c=0;c<this.options.filters.values.length;c++){d=this.$element.data("filters")&&new RegExp(this.options.filters.labels[c],"i").test(this.$element.data("filters"));this.$filters.append(this.options.filters.labels[c]+' <input type="checkbox" name="filters[]" value="'+this.options.filters.values[c]+'" '+(d?"checked":"")+"/>")}this.$actions.append(this.$filters)}this.$container=b('<ul class="uwidget-container"></ul>');this.$info=b('<span class="uwidget-info"><a href="#" target="_blank">UWidget</a></span>');this.$element.append(this.$actions).append(this.$container).append(this.$info);this._updateActions();return this},_initFromDOM:function(){if(this.$element.data("width")){this.$element.css("width",this.$element.data("width"))}if(this.$element.data("height")){this.$element.css("height",this.$element.data("height"));this.$container.css("height",this.$element.height()-this.$actions.height()-this.$info.height())}return this},_updateActions:function(){if(this.options.sort.enabled){this.$element.data("sort",this.$sort.val())}if(this.options.direction.enabled){this.$element.data("direction",this.$direction.val())}if(this.options.filters.enabled){var c=[];this.$actions.find("input[type=checkbox]:checked").each(function(){c.push(b(this).val())});this.$element.data("filters",c.join(", "))}this.fetch()},getUrl:function(){var d=("function"===typeof this.options.url?this.options.url(this.options):this.options.url),c=["sort","direction","filters"],f="";d+=-1!==d.indexOf("?")?"&uwidget":"?uwidget";for(var e=0;e<c.length;e++){f=this.$element.data([c[e]]+"");if(this.options[c[e]].enabled&&f.length){d+="&"+this.options[c[e]].name+"="+f}}return d},fetch:function(){var d=this,c=d.getUrl();this.$element.removeClass("error").removeClass("fetched").addClass("fetching");if("undefined"!==typeof this._xhrCache[c]){return this._updateCollection.apply(this,this._xhrCache[c])}b.ajax(b.extend(true,{},{url:c},d.$element.data("remoteOptions"))).done(function(){d._updateCollection.apply(d,arguments);d._xhrCache[c]=arguments}).fail(function(){d.$container.addClass("error")}).always(function(){d.$container.removeClass("fetching")})},_updateCollection:function(d){this.$container.html("").addClass("fetched");d=this.options.handler.apply(this,arguments);for(var c=0;c<d.length;c++){this.$container.append(tmpl(this.options.template,d[c]))}}};b.fn.UWidget=function(c){return new a(this,c)};(function(){var d={};this.tmpl=function c(g,f){var e=!/\W/.test(g)?d[g]=d[g]||c(document.getElementById(g).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+g.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return f?e(f):e}})()})(window.jQuery);