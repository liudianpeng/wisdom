var transitionize=require("transitionize"),fastclick=require("fastclick"),classes=require("classes"),events=require("events");module.exports=Switchery;var defaults={color:"#64bd63",secondaryColor:"#dfdfdf",jackColor:"#fff",jackSecondaryColor:null,className:"switchery",disabled:false,disabledOpacity:0.5,speed:"0.4s",size:"default"};function Switchery(c,a){if(!(this instanceof Switchery)){return new Switchery(c,a)}this.element=c;this.options=a||{};for(var b in defaults){if(this.options[b]==null){this.options[b]=defaults[b]}}if(this.element!=null&&this.element.type=="checkbox"){this.init()}if(this.isDisabled()===true){this.disable()}}Switchery.prototype.hide=function(){this.element.style.display="none"};Switchery.prototype.show=function(){var a=this.create();this.insertAfter(this.element,a)};Switchery.prototype.create=function(){this.switcher=document.createElement("span");this.jack=document.createElement("small");this.switcher.appendChild(this.jack);this.switcher.className=this.options.className;this.events=events(this.switcher,this);return this.switcher};Switchery.prototype.insertAfter=function(a,b){a.parentNode.insertBefore(b,a.nextSibling)};Switchery.prototype.setPosition=function(b){var d=this.isChecked(),c=this.switcher,a=this.jack;if(b&&d){d=false}else{if(b&&!d){d=true}}if(d===true){this.element.checked=true;if(window.getComputedStyle){a.style.left=parseInt(window.getComputedStyle(c).width)-parseInt(window.getComputedStyle(a).width)+"px"}else{a.style.left=parseInt(c.currentStyle.width)-parseInt(a.currentStyle.width)+"px"}if(this.options.color){this.colorize()}this.setSpeed()}else{a.style.left=0;this.element.checked=false;this.switcher.style.boxShadow="inset 0 0 0 0 "+this.options.secondaryColor;this.switcher.style.borderColor=this.options.secondaryColor;this.switcher.style.backgroundColor=(this.options.secondaryColor!==defaults.secondaryColor)?this.options.secondaryColor:"#fff";this.jack.style.backgroundColor=(this.options.jackSecondaryColor!==this.options.jackColor)?this.options.jackSecondaryColor:this.options.jackColor;this.setSpeed()}};Switchery.prototype.setSpeed=function(){var b={},a={"background-color":this.options.speed,left:this.options.speed.replace(/[a-z]/,"")/2+"s"};if(this.isChecked()){b={border:this.options.speed,"box-shadow":this.options.speed,"background-color":this.options.speed.replace(/[a-z]/,"")*3+"s"}}else{b={border:this.options.speed,"box-shadow":this.options.speed}}transitionize(this.switcher,b);transitionize(this.jack,a)};Switchery.prototype.setSize=function(){var b="switchery-small",c="switchery-default",a="switchery-large";switch(this.options.size){case"small":classes(this.switcher).add(b);break;case"large":classes(this.switcher).add(a);break;default:classes(this.switcher).add(c);break}};Switchery.prototype.colorize=function(){var a=this.switcher.offsetHeight/2;this.switcher.style.backgroundColor=this.options.color;this.switcher.style.borderColor=this.options.color;this.switcher.style.boxShadow="inset 0 0 0 "+a+"px "+this.options.color;this.jack.style.backgroundColor=this.options.jackColor};Switchery.prototype.handleOnchange=function(b){if(document.dispatchEvent){var a=document.createEvent("HTMLEvents");a.initEvent("change",true,true);this.element.dispatchEvent(a)}else{this.element.fireEvent("onchange")}};Switchery.prototype.handleChange=function(){var a=this,b=this.element;if(b.addEventListener){b.addEventListener("change",function(){a.setPosition()})}else{b.attachEvent("onchange",function(){a.setPosition()})}};Switchery.prototype.handleClick=function(){var a=this.switcher;fastclick(a);this.events.bind("click","bindClick")};Switchery.prototype.bindClick=function(){var b=this.element.parentNode.tagName.toLowerCase(),a=(b==="label")?false:true;this.setPosition(a);this.handleOnchange(this.element.checked)};Switchery.prototype.markAsSwitched=function(){this.element.setAttribute("data-switchery",true)};Switchery.prototype.markedAsSwitched=function(){return this.element.getAttribute("data-switchery")};Switchery.prototype.init=function(){this.hide();this.show();this.setSize();this.setPosition();this.markAsSwitched();this.handleChange();this.handleClick()};Switchery.prototype.isChecked=function(){return this.element.checked};Switchery.prototype.isDisabled=function(){return this.options.disabled||this.element.disabled||this.element.readOnly};Switchery.prototype.destroy=function(){this.events.unbind()};Switchery.prototype.enable=function(){if(this.options.disabled){this.options.disabled=false}if(this.element.disabled){this.element.disabled=false}if(this.element.readOnly){this.element.readOnly=false}this.switcher.style.opacity=1;this.events.bind("click","bindClick")};Switchery.prototype.disable=function(){if(!this.options.disabled){this.options.disabled=true}if(!this.element.disabled){this.element.disabled=true}if(!this.element.readOnly){this.element.readOnly=true}this.switcher.style.opacity=this.options.disabledOpacity;this.destroy()};