"use strict";var support=require("./support");var compressions=require("./compressions");var nodeBuffer=require("./nodeBuffer");exports.string2binary=function(c){var a="";for(var b=0;b<c.length;b++){a+=String.fromCharCode(c.charCodeAt(b)&255)}return a};exports.arrayBuffer2Blob=function(a,f){exports.checkSupport("blob");f=f||"application/zip";try{return new Blob([a],{type:f})}catch(c){try{var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var b=new d();b.append(a);return b.getBlob(f)}catch(c){throw new Error("Bug : can't construct the Blob.")}}};function identity(a){return a}function stringToArrayLike(b,c){for(var a=0;a<b.length;++a){c[a]=b.charCodeAt(a)&255}return c}function arrayLikeToString(f){var l=65536;var m=[],d=f.length,j=exports.getTypeOf(f),b=0,a=true;try{switch(j){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,nodeBuffer(0));break}}catch(g){a=false}if(!a){var h="";for(var c=0;c<f.length;c++){h+=String.fromCharCode(f[c])}return h}while(b<d&&l>1){try{if(j==="array"||j==="nodebuffer"){m.push(String.fromCharCode.apply(null,f.slice(b,Math.min(b+l,d))))}else{m.push(String.fromCharCode.apply(null,f.subarray(b,Math.min(b+l,d))))}b+=l}catch(g){l=Math.floor(l/2)}}return m.join("")}exports.applyFromCharCode=arrayLikeToString;function arrayLikeToArrayLike(b,c){for(var a=0;a<b.length;a++){c[a]=b[a]}return c}var transform={};transform.string={string:identity,array:function(a){return stringToArrayLike(a,new Array(a.length))},arraybuffer:function(a){return transform.string["uint8array"](a).buffer},uint8array:function(a){return stringToArrayLike(a,new Uint8Array(a.length))},nodebuffer:function(a){return stringToArrayLike(a,nodeBuffer(a.length))}};transform.array={string:arrayLikeToString,array:identity,arraybuffer:function(a){return(new Uint8Array(a)).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return nodeBuffer(a)}};transform.arraybuffer={string:function(a){return arrayLikeToString(new Uint8Array(a))},array:function(a){return arrayLikeToArrayLike(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:identity,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return nodeBuffer(new Uint8Array(a))}};transform.uint8array={string:arrayLikeToString,array:function(a){return arrayLikeToArrayLike(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:identity,nodebuffer:function(a){return nodeBuffer(a)}};transform.nodebuffer={string:arrayLikeToString,array:function(a){return arrayLikeToArrayLike(a,new Array(a.length))},arraybuffer:function(a){return transform.nodebuffer["uint8array"](a).buffer},uint8array:function(a){return arrayLikeToArrayLike(a,new Uint8Array(a.length))},nodebuffer:identity};exports.transformTo=function(d,b){if(!b){b=""}if(!d){return b}exports.checkSupport(d);var c=exports.getTypeOf(b);var a=transform[c][d](b);return a};exports.getTypeOf=function(a){if(typeof a==="string"){return"string"}if(Object.prototype.toString.call(a)==="[object Array]"){return"array"}if(support.nodebuffer&&nodeBuffer.test(a)){return"nodebuffer"}if(support.uint8array&&a instanceof Uint8Array){return"uint8array"}if(support.arraybuffer&&a instanceof ArrayBuffer){return"arraybuffer"}};exports.checkSupport=function(b){var a=support[b.toLowerCase()];if(!a){throw new Error(b+" is not supported by this browser")}};exports.MAX_VALUE_16BITS=65535;exports.MAX_VALUE_32BITS=-1;exports.pretty=function(d){var b="",c,a;for(a=0;a<(d||"").length;a++){c=d.charCodeAt(a);b+="\\x"+(c<16?"0":"")+c.toString(16).toUpperCase()}return b};exports.findCompression=function(a){for(var b in compressions){if(!compressions.hasOwnProperty(b)){continue}if(compressions[b].magic===a){return compressions[b]}}return null};exports.isRegExp=function(a){return Object.prototype.toString.call(a)==="[object RegExp]"};exports.extend=function(){var b={},c,a;for(c=0;c<arguments.length;c++){for(a in arguments[c]){if(arguments[c].hasOwnProperty(a)&&typeof b[a]==="undefined"){b[a]=arguments[c][a]}}}return b};