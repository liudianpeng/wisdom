module("Data adaptor - Tokenizer");test("triggers the select event",function(b){b.expect(2);var e=require("select2/data/select");var k=require("select2/data/tokenizer");var f=require("select2/data/tags");var j=require("select2/options");var i=require("select2/utils");var h=require("jquery");var a=i.Decorate(i.Decorate(e,f),k);var d=h("#qunit-fixture .single");var m=new j({tags:true,tokenSeparators:[","]});var c=new MockContainer();c.dropdown=c.selection={};var l=h("<div></div>");var g=new a(d,m);g.bind(c,l);g.on("select",function(){b.ok(true,"The select event should be triggered")});g.query({term:"first,second"},function(){b.ok(true,"The callback should have succeeded")})});test("createTag can return null",function(b){b.expect(3);var e=require("select2/data/select");var k=require("select2/data/tokenizer");var f=require("select2/data/tags");var j=require("select2/options");var i=require("select2/utils");var h=require("jquery");var a=i.Decorate(i.Decorate(e,f),k);var d=h("#qunit-fixture .single");var m=new j({tags:true,tokenSeparators:[","],createTag:function(){b.ok(true,"createTag should have been called");return null}});var c=new MockContainer();c.dropdown=c.selection={};var l=h("<div></div>");var g=new a(d,m);g.bind(c,l);g.on("select",function(n){if(n.data==null){b.ok(false,"Null data should never be selected")}});g.query({term:"first,second"},function(){b.ok(true,"The callback should have succeeded")})});test("createTag returning null does not cut the term",function(b){b.expect(4);var e=require("select2/data/select");var k=require("select2/data/tokenizer");var f=require("select2/data/tags");var j=require("select2/options");var i=require("select2/utils");var h=require("jquery");var a=i.Decorate(i.Decorate(e,f),k);var d=h("#qunit-fixture .single");var m=new j({tags:true,tokenSeparators:[",",'"'],createTag:function(p){var n=p.term;if(n.length===0){return null}if(n==='"'){return null}if(n[0]==='"'&&n[n.length-1]!=='"'){return null}var o=n.substr(1,n.length-2);return{id:n,text:o}}});var c=new MockContainer();c.dropdown=c.selection={};var l=h("<div></div>");var g=new a(d,m);g.bind(c,l);g.on("select",function(n){b.ok(n.data,"Data should not be null");b.equal(n.data.id,'"first, second"',"The id should have the quotes");b.equal(n.data.text,"first, second","The text should not have the quotes")});g.query({term:'"first, second",abc'},function(){b.ok(true,"The callback should have succeeded")})});test("works with multiple tokens given",function(b){b.expect(4);var e=require("select2/data/select");var k=require("select2/data/tokenizer");var f=require("select2/data/tags");var j=require("select2/options");var i=require("select2/utils");var h=require("jquery");var a=i.Decorate(i.Decorate(e,f),k);var d=h("#qunit-fixture .multiple");var m=new j({tags:true,tokenSeparators:[","]});var c=new MockContainer();c.dropdown=c.selection={};var l=h("<div></div>");var g=new a(d,m);g.bind(c,l);g.on("select",function(){b.ok(true,"The select event should be triggered")});g.query({term:"first,second,third"},function(){b.ok(true,"The callback should have succeeded")});b.equal(d.children("option").length,3,"The two new tags should have been created")});