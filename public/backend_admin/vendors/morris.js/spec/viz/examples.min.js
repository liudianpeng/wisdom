var webpage=require("webpage"),fs=require("fs");var html_path=fs.absolute("test.html");var examples=[];function run_example(b){if(b>=examples.length){phantom.exit(0);return}var a=examples[b];var c=0;var d=webpage.create();d.viewportSize={width:500,height:300};d.clipRect={width:500,height:300};d.onAlert=function(g){var f=JSON.parse(g);if(f.fn=="snapshot"){d.render("output/"+a.name+c+".png");c+=1}else{if(f.fn=="mousemove"){d.sendEvent("mousemove",f.x,f.y)}}};d.open(html_path,function(e){if(e=="fail"){console.log("Failed to load test page: "+a.name);phantom.exit(1)}else{d.evaluate(a.runner)}d.close();run_example(b+1)})}exports.def=function(a,b){examples.push({name:a,runner:b})};exports.run=function(){if(fs.isDirectory("output")){fs.list("output").forEach(function(a){if(a!="."&&a!=".."){fs.remove("output/"+a)}})}else{fs.makeDirectory("output")}run_example(0)};