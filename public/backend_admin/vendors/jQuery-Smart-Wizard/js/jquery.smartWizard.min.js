function SmartWizard(e,i){this.target=e;this.options=i;this.curStepIdx=i.selected;this.steps=$(e).children("ul").children("li").children("a");this.contentWidth=0;this.msgBox=$('<div class="msgBox"><div class="content"></div><a href="#" class="close">X</a></div>');this.elmStepContainer=$("<div></div>").addClass("stepContainer");this.loader=$("<div>Loading</div>").addClass("loader");this.buttons={next:$("<a>"+i.labelNext+"</a>").attr("href","#").addClass("buttonNext"),previous:$("<a>"+i.labelPrevious+"</a>").attr("href","#").addClass("buttonPrevious"),finish:$("<a>"+i.labelFinish+"</a>").attr("href","#").addClass("buttonFinish")};var f=function(l){var j=$("<div></div>").addClass("actionBar");j.append(l.msgBox);$(".close",l.msgBox).click(function(){l.msgBox.fadeOut("normal");return false});var k=l.target.children("div");l.target.children("ul").addClass("anchor");k.addClass("content");if(l.options.errorSteps&&l.options.errorSteps.length>0){$.each(l.options.errorSteps,function(m,o){l.setError({stepnum:o,iserror:true})})}l.elmStepContainer.append(k);j.append(l.loader);l.target.append(l.elmStepContainer);j.append(l.buttons.finish).append(l.buttons.next).append(l.buttons.previous);l.target.append(j);this.contentWidth=l.elmStepContainer.width();$(l.buttons.next).click(function(){l.goForward();return false});$(l.buttons.previous).click(function(){l.goBackward();return false});$(l.buttons.finish).click(function(){if(!$(this).hasClass("buttonDisabled")){if($.isFunction(l.options.onFinish)){var m={fromStep:l.curStepIdx+1};if(!l.options.onFinish.call(this,$(l.steps),m)){return false}}else{var n=l.target.parents("form");if(n&&n.length){n.submit()}}}return false});$(l.steps).bind("click",function(o){if(l.steps.index(this)==l.curStepIdx){return false}var n=l.steps.index(this);var m=l.steps.eq(n).attr("isDone")-0;if(m==1){d(l,n)}return false});if(l.options.keyNavigation){$(document).keyup(function(m){if(m.which==39){l.goForward()}else{if(m.which==37){l.goBackward()}}})}b(l);d(l,l.curStepIdx)};var b=function(j){if(!j.options.enableAllSteps){$(j.steps,j.target).removeClass("selected").removeClass("done").addClass("disabled");$(j.steps,j.target).attr("isDone",0)}else{$(j.steps,j.target).removeClass("selected").removeClass("disabled").addClass("done");$(j.steps,j.target).attr("isDone",1)}$(j.steps,j.target).each(function(k){$($(this).attr("href").replace(/^.+#/,"#"),j.target).hide();$(this).attr("rel",k+1)})};var h=function(k,j){return $($(j,k.target).attr("href").replace(/^.+#/,"#"),k.target)};var d=function(p,l){var m=p.steps.eq(l);var q=p.options.contentURL;var k=p.options.contentURLData;var j=m.data("hasContent");var o=l+1;if(q&&q.length>0){if(p.options.contentCache&&j){a(p,l)}else{var n={url:q,type:"POST",data:({step_number:o}),dataType:"text",beforeSend:function(){p.loader.show()},error:function(){p.loader.hide()},success:function(r){p.loader.hide();if(r&&r.length>0){m.data("hasContent",true);h(p,m).html(r);a(p,l)}}};if(k){n=$.extend(n,k(o))}$.ajax(n)}}else{a(p,l)}};var a=function(o,q){var m=o.steps.eq(q);var k=o.steps.eq(o.curStepIdx);if(q!=o.curStepIdx){if($.isFunction(o.options.onLeaveStep)){var j={fromStep:o.curStepIdx+1,toStep:q+1};if(!o.options.onLeaveStep.call(o,$(k),j)){return false}}}o.elmStepContainer.height(h(o,m).outerHeight());var r=o.curStepIdx;o.curStepIdx=q;if(o.options.transitionEffect=="slide"){h(o,k).slideUp("fast",function(s){h(o,m).slideDown("fast");c(o,k,m)})}else{if(o.options.transitionEffect=="fade"){h(o,k).fadeOut("fast",function(s){h(o,m).fadeIn("fast");c(o,k,m)})}else{if(o.options.transitionEffect=="slideleft"){var l=0;var p=null;var l=null;var n=0;if(q>r){p=o.contentWidth+10;nextElmLeft2=0;n=0-h(o,k).outerWidth()}else{p=0-h(o,m).outerWidth()+20;nextElmLeft2=0;n=10+h(o,k).outerWidth()}if(q==r){p=$($(m,o.target).attr("href"),o.target).outerWidth()+20;nextElmLeft2=0;n=0-$($(k,o.target).attr("href"),o.target).outerWidth()}else{$($(k,o.target).attr("href"),o.target).animate({left:n},"fast",function(s){$($(k,o.target).attr("href"),o.target).hide()})}h(o,m).css("left",p).show().animate({left:nextElmLeft2},"fast",function(s){c(o,k,m)})}else{h(o,k).hide();h(o,m).show();c(o,k,m)}}}return true};var c=function(n,l,m){$(l,n.target).removeClass("selected");$(l,n.target).addClass("done");$(m,n.target).removeClass("disabled");$(m,n.target).removeClass("done");$(m,n.target).addClass("selected");$(m,n.target).attr("isDone",1);g(n);if($.isFunction(n.options.onShowStep)){var k={fromStep:parseInt($(l).attr("rel")),toStep:parseInt($(m).attr("rel"))};if(!n.options.onShowStep.call(this,$(m),k)){return false}}if(n.options.noForwardJumping){for(var j=n.curStepIdx+2;j<=n.steps.length;j++){n.disableStep(j)}}};var g=function(j){if(!j.options.cycleSteps){if(0>=j.curStepIdx){$(j.buttons.previous).addClass("buttonDisabled");if(j.options.hideButtonsOnDisabled){$(j.buttons.previous).hide()}}else{$(j.buttons.previous).removeClass("buttonDisabled");if(j.options.hideButtonsOnDisabled){$(j.buttons.previous).show()}}if((j.steps.length-1)<=j.curStepIdx){$(j.buttons.next).addClass("buttonDisabled");if(j.options.hideButtonsOnDisabled){$(j.buttons.next).hide()}}else{$(j.buttons.next).removeClass("buttonDisabled");if(j.options.hideButtonsOnDisabled){$(j.buttons.next).show()}}}if(!j.steps.hasClass("disabled")||j.options.enableFinishButton){$(j.buttons.finish).removeClass("buttonDisabled");if(j.options.hideButtonsOnDisabled){$(j.buttons.finish).show()}}else{$(j.buttons.finish).addClass("buttonDisabled");if(j.options.hideButtonsOnDisabled){$(j.buttons.finish).hide()}}};SmartWizard.prototype.goForward=function(){var j=this.curStepIdx+1;if(this.steps.length<=j){if(!this.options.cycleSteps){return false}j=0}d(this,j)};SmartWizard.prototype.goBackward=function(){var j=this.curStepIdx-1;if(0>j){if(!this.options.cycleSteps){return false}j=this.steps.length-1}d(this,j)};SmartWizard.prototype.goToStep=function(k){var j=k-1;if(j>=0&&j<this.steps.length){d(this,j)}};SmartWizard.prototype.enableStep=function(l){var j=l-1;if(j==this.curStepIdx||j<0||j>=this.steps.length){return false}var k=this.steps.eq(j);$(k,this.target).attr("isDone",1);$(k,this.target).removeClass("disabled").removeClass("selected").addClass("done")};SmartWizard.prototype.disableStep=function(l){var j=l-1;if(j==this.curStepIdx||j<0||j>=this.steps.length){return false}var k=this.steps.eq(j);$(k,this.target).attr("isDone",0);$(k,this.target).removeClass("done").removeClass("selected").addClass("disabled")};SmartWizard.prototype.currentStep=function(){return this.curStepIdx+1};SmartWizard.prototype.showMessage=function(j){$(".content",this.msgBox).html(j);this.msgBox.show()};SmartWizard.prototype.hideMessage=function(){this.msgBox.fadeOut("normal")};SmartWizard.prototype.showError=function(j){this.setError(j,true)};SmartWizard.prototype.hideError=function(j){this.setError(j,false)};SmartWizard.prototype.setError=function(j,k){if(typeof j=="object"){k=j.iserror;j=j.stepnum}if(k){$(this.steps.eq(j-1),this.target).addClass("error")}else{$(this.steps.eq(j-1),this.target).removeClass("error")}};SmartWizard.prototype.fixHeight=function(){var j=0;var k=this.steps.eq(this.curStepIdx);var l=h(this,k);l.children().each(function(){j+=$(this).outerHeight()});l.height(j+5);this.elmStepContainer.height(j+20)};f(this)}(function(a){a.fn.smartWizard=function(e){var b=arguments;var d=undefined;var c=this.each(function(){var g=a(this).data("smartWizard");if(typeof e=="object"||!e||!g){var f=a.extend({},a.fn.smartWizard.defaults,e||{});if(!g){g=new SmartWizard(a(this),f);a(this).data("smartWizard",g)}}else{if(typeof SmartWizard.prototype[e]=="function"){d=SmartWizard.prototype[e].apply(g,Array.prototype.slice.call(b,1));return d}else{a.error("Method "+e+" does not exist on jQuery.smartWizard")}}});if(d===undefined){return c}else{return d}};a.fn.smartWizard.defaults={selected:0,keyNavigation:true,enableAllSteps:false,transitionEffect:"fade",contentURL:null,contentCache:true,cycleSteps:false,enableFinishButton:false,hideButtonsOnDisabled:false,errorSteps:[],labelNext:"Next",labelPrevious:"Previous",labelFinish:"Finish",noForwardJumping:false,onLeaveStep:null,onShowStep:null,onFinish:null}})(jQuery);