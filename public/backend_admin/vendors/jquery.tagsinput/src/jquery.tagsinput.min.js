(function(d){var a=new Array();var c=new Array();d.fn.doAutosize=function(j){var g=d(this).data("minwidth"),q=d(this).data("maxwidth"),l="",p=d(this),k=d("#"+d(this).data("tester_id"));if(l===(l=p.val())){return}var f=l.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");k.html(f);var n=k.width(),m=(n+j.comfortZone)>=g?n+j.comfortZone:g,h=p.width(),e=(m<h&&m>=g)||(m>g&&m<q);if(e){p.width(m)}};d.fn.resetAutosize=function(g){var j=d(this).data("minwidth")||g.minInputWidth||d(this).width(),k=d(this).data("maxwidth")||g.maxInputWidth||(d(this).closest(".tagsinput").width()-g.inputPadding),l="",f=d(this),h=d("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),letterSpacing:f.css("letterSpacing"),whiteSpace:"nowrap"}),e=d(this).attr("id")+"_autosize_tester";if(!d("#"+e).length>0){h.attr("id",e);h.appendTo("body")}f.data("minwidth",j);f.data("maxwidth",k);f.data("tester_id",e);f.css("width",j)};d.fn.addTag=function(f,e){e=jQuery.extend({focus:false,callback:true},e);this.each(function(){var l=d(this).attr("id");var g=d(this).val().split(a[l]);if(g[0]==""){g=new Array()}f=jQuery.trim(f);if(e.unique){var h=d(this).tagExist(f);if(h==true){d("#"+l+"_tag").addClass("not_valid")}}else{var h=false}if(f!=""&&h!=true){d("<span>").addClass("tag").append(d("<span>").text(f).append("&nbsp;&nbsp;"),d("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return d("#"+l).removeTag(escape(f))})).insertBefore("#"+l+"_addTag");g.push(f);d("#"+l+"_tag").val("");if(e.focus){d("#"+l+"_tag").focus()}else{d("#"+l+"_tag").blur()}d.fn.tagsInput.updateTagsField(this,g);if(e.callback&&c[l]&&c[l]["onAddTag"]){var k=c[l]["onAddTag"];k.call(this,f)}if(c[l]&&c[l]["onChange"]){var j=g.length;var k=c[l]["onChange"];k.call(this,d(this),g[j-1])}}});return false};d.fn.removeTag=function(e){e=unescape(e);this.each(function(){var j=d(this).attr("id");var g=d(this).val().split(a[j]);d("#"+j+"_tagsinput .tag").remove();str="";for(i=0;i<g.length;i++){if(g[i]!=e){str=str+a[j]+g[i]}}d.fn.tagsInput.importTags(this,str);if(c[j]&&c[j]["onRemoveTag"]){var h=c[j]["onRemoveTag"];h.call(this,e)}});return false};d.fn.tagExist=function(f){var g=d(this).attr("id");var e=d(this).val().split(a[g]);return(jQuery.inArray(f,e)>=0)};d.fn.importTags=function(e){var f=d(this).attr("id");d("#"+f+"_tagsinput .tag").remove();d.fn.tagsInput.importTags(this,e)};d.fn.tagsInput=function(e){var g=jQuery.extend({interactive:true,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:false},hide:true,delimiter:",",unique:true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2},e);var f=0;this.each(function(){if(typeof d(this).attr("data-tagsinput-init")!=="undefined"){return}d(this).attr("data-tagsinput-init",true);if(g.hide){d(this).hide()}var k=d(this).attr("id");if(!k||a[d(this).attr("id")]){k=d(this).attr("id","tags"+new Date().getTime()+(f++)).attr("id")}var j=jQuery.extend({pid:k,real_input:"#"+k,holder:"#"+k+"_tagsinput",input_wrapper:"#"+k+"_addTag",fake_input:"#"+k+"_tag"},g);a[k]=j.delimiter;if(g.onAddTag||g.onRemoveTag||g.onChange){c[k]=new Array();c[k]["onAddTag"]=g.onAddTag;c[k]["onRemoveTag"]=g.onRemoveTag;c[k]["onChange"]=g.onChange}var h='<div id="'+k+'_tagsinput" class="tagsinput"><div id="'+k+'_addTag">';if(g.interactive){h=h+'<input id="'+k+'_tag" value="" data-default="'+g.defaultText+'" />'}h=h+'</div><div class="tags_clear"></div></div>';d(h).insertAfter(this);d(j.holder).css("width",g.width);d(j.holder).css("min-height",g.height);d(j.holder).css("height",g.height);if(d(j.real_input).val()!=""){d.fn.tagsInput.importTags(d(j.real_input),d(j.real_input).val())}if(g.interactive){d(j.fake_input).val(d(j.fake_input).attr("data-default"));d(j.fake_input).css("color",g.placeholderColor);d(j.fake_input).resetAutosize(g);d(j.holder).bind("click",j,function(l){d(l.data.fake_input).focus()});d(j.fake_input).bind("focus",j,function(l){if(d(l.data.fake_input).val()==d(l.data.fake_input).attr("data-default")){d(l.data.fake_input).val("")}d(l.data.fake_input).css("color","#000000")});if(g.autocomplete_url!=undefined){autocomplete_options={source:g.autocomplete_url};for(attrname in g.autocomplete){autocomplete_options[attrname]=g.autocomplete[attrname]}if(jQuery.Autocompleter!==undefined){d(j.fake_input).autocomplete(g.autocomplete_url,g.autocomplete);d(j.fake_input).bind("result",j,function(l,n,m){if(n){d("#"+k).addTag(n[0]+"",{focus:true,unique:(g.unique)})}})}else{if(jQuery.ui.autocomplete!==undefined){d(j.fake_input).autocomplete(autocomplete_options);d(j.fake_input).bind("autocompleteselect",j,function(l,m){d(l.data.real_input).addTag(m.item.value,{focus:true,unique:(g.unique)});return false})}}}else{d(j.fake_input).bind("blur",j,function(l){var m=d(this).attr("data-default");if(d(l.data.fake_input).val()!=""&&d(l.data.fake_input).val()!=m){if((l.data.minChars<=d(l.data.fake_input).val().length)&&(!l.data.maxChars||(l.data.maxChars>=d(l.data.fake_input).val().length))){d(l.data.real_input).addTag(d(l.data.fake_input).val(),{focus:true,unique:(g.unique)})}}else{d(l.data.fake_input).val(d(l.data.fake_input).attr("data-default"));d(l.data.fake_input).css("color",g.placeholderColor)}return false})}d(j.fake_input).bind("keypress",j,function(l){if(b(l)){l.preventDefault();if((l.data.minChars<=d(l.data.fake_input).val().length)&&(!l.data.maxChars||(l.data.maxChars>=d(l.data.fake_input).val().length))){d(l.data.real_input).addTag(d(l.data.fake_input).val(),{focus:true,unique:(g.unique)})}d(l.data.fake_input).resetAutosize(g);return false}else{if(l.data.autosize){d(l.data.fake_input).doAutosize(g)}}});j.removeWithBackspace&&d(j.fake_input).bind("keydown",function(m){if(m.keyCode==8&&d(this).val()==""){m.preventDefault();var l=d(this).closest(".tagsinput").find(".tag:last").text();var n=d(this).attr("id").replace(/_tag$/,"");l=l.replace(/[\s]+x$/,"");d("#"+n).removeTag(escape(l));d(this).trigger("focus")}});d(j.fake_input).blur();if(j.unique){d(j.fake_input).keydown(function(l){if(l.keyCode==8||String.fromCharCode(l.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){d(this).removeClass("not_valid")}})}}});return this};d.fn.tagsInput.updateTagsField=function(f,e){var g=d(f).attr("id");d(f).val(e.join(a[g]))};d.fn.tagsInput.importTags=function(h,j){d(h).val("");var k=d(h).attr("id");var e=j.split(a[k]);for(i=0;i<e.length;i++){d(h).addTag(e[i],{focus:false,callback:false})}if(c[k]&&c[k]["onChange"]){var g=c[k]["onChange"];g.call(h,h,e[i])}};var b=function(e){var f=false;if(e.which==13){return true}if(typeof e.data.delimiter==="string"){if(e.which==e.data.delimiter.charCodeAt(0)){f=true}}else{d.each(e.data.delimiter,function(h,g){if(e.which==g.charCodeAt(0)){f=true}})}return f}})(jQuery);